[{"content":"å‰è¨€ è®¾æƒ³ä¸€ä¸ªåœºæ™¯ï¼š\nä½ ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå¬ç€æ”’åŠ²çš„å°æ›²ï¼Œå†™ç€ä¼˜é›…çš„ä»£ç ï¼ŒåŠ ç­åŠ ç‚¹ç»ˆäºå†™å®Œäº†è¿­ä»£ä¸­åˆ†é…çš„æ¨¡å—éœ€æ±‚ã€‚ç„¶åä½ è·Ÿåˆ«çš„åŒäº‹ä¸€è”è°ƒï¼Œå´å‘ç°å„ç§é—®é¢˜ã€‚\nä½ è·ŸåŒäº‹Aè¯´ï¼šâ€œä½ å¾—åœ¨è¿™ç§æƒ…å†µä¸‹ç»™æˆ‘æ•°æ®Aã€‚â€œ\nåŒäº‹Aä¸€è„¸æ‡µé€¼ï¼šâ€œè¿™ç§æƒ…å†µéœ€æ±‚ä¹Ÿæ²¡å†™å•Šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä¹Ÿæ²¡æœ‰æ•°æ®Aå•Šï¼â€œ\nç„¶åä½ å’ŒåŒäº‹Aä¸€èµ·é¡ºç€ä¸šåŠ¡æµç¨‹ï¼Œæ‰¾åˆ°äº†è´Ÿè´£ä¸Šå±‚æ¨¡å—çš„åŒäº‹Bã€‚\nåŒäº‹Bä¸€è„¸æ‡µé€¼ï¼šâ€œè¿™ä¸ªè¿­ä»£ä¸­æˆ‘æ²¡æœ‰è¿™ä¸ªæ¨¡å—çš„å¼€å‘éœ€æ±‚å•Šï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä¹Ÿæ²¡æœ‰æ•°æ®Aå•Šï¼â€\nç„¶åä½ å’ŒåŒäº‹Aã€åŒäº‹Bä¸€èµ·é¡ºç€ä¸šåŠ¡æµç¨‹ï¼Œæ‰¾åˆ°äº†è´Ÿè´£ä¸Šå±‚æ¨¡å—çš„\u0026hellip;\u0026hellip;\næœ€åï¼Œä½ å’ŒåŒäº‹ABC\u0026hellip;ä¸€èµ·æ‰¾åˆ°äº†äº§å“ï¼Œäº§å“ä¸€è„¸æ‡µé€¼ï¼šâ€œé‚£æ²¡åŠæ³•ï¼Œå°±æ”¹éœ€æ±‚å§\u0026hellip;\u0026hellip;â€\nä½ çœ¼çœ‹ç€æ‰€å‰©æ— å‡ çš„è¿­ä»£æ—¶é—´ï¼Œç”Ÿæ— å¯æ‹åœ°æå‡ºæ‰‹æœºï¼Œå‘ä¸ªå¾®ä¿¡å–æ¶ˆäº†è¿™å‘¨æœ«çš„ç›¸äº²\u0026hellip;\nä¸çŸ¥é“ç¨‹åºå‘˜xdmæœ‰æ²¡æœ‰ç»å†è¿‡è¿™æ ·çš„åœºæ™¯ï¼Œå¦‚æœå„ä½ç¨‹åºå‘˜xdæ²¡æœ‰ç»å†è¿‡è¿™æ ·çš„åœºæ™¯ï¼Œé‚£çœŸçš„æ˜¯æ­å–œä½ äº†ï¼Œä¸”è¡Œä¸”çæƒœï¼ä»æ¯•ä¸šåå‚åŠ å·¥ä½œå¼€å§‹ï¼Œæˆ‘æ˜¯çœŸçš„ç»å†å¤ªå¤šäº†ï¼Œå¤ªç—›äº†ï¼\næˆ‘ä¹‹åä¸æ–­å­¦ä¹ å„ç§æ–¹æ³•ï¼Œå°è¯•å»ç ´è§£è¿™æ ·çš„å›°å±€ã€‚è™½ç„¶è¯´ï¼Œå·¥ä½œä¸­çš„é—®é¢˜å¾ˆå¤šï¼Œä½†æ˜¯èƒ½è§£å†³ä¸€ä¸ªæ˜¯ä¸€ä¸ªï¼Œåé¢å†æ…¢æ…¢è·Ÿå„ä½åˆ†äº«å…¶ä»–é—®é¢˜ä¸­æˆ‘çš„è§£å†³æ–¹æ¡ˆã€‚\næ‰€ä»¥ï¼Œæœ¬ç¯‡æ–‡ç« å°†åˆ†äº«ä¸€æ³¢å…³äºè¿™ç±»é—®é¢˜æˆ‘çš„è§£å†³æ–¹æ¡ˆã€‚è°¨ä»£è¡¨ä¸ªäººä¸»è§‚è§‚ç‚¹ã€‚\nç—›ç‚¹ éœ€æ±‚æ˜¯ç”¨æˆ·çš„ç—›ç‚¹ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œæ˜¯ç¨‹åºå‘˜çš„ç—›ç‚¹\u0026hellip;\né‚£ä¹ˆï¼Œä»”ç»†åˆ†æä¸€ä¸‹ï¼Œè¿™ä¸ªåœºæ™¯ä¸‹çš„ç—›ç‚¹ï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘è®¤ä¸ºæ˜¯å¦‚ä¸‹ä¸¤ç‚¹ï¼š\näº§å“ç»™åˆ°çš„éœ€æ±‚æ— æ³•è‡ªæ´½ï¼Œä¸”åœºæ™¯è¦†ç›–ä¸å¤Ÿ å¼€å‘å›¢é˜Ÿçš„æŠ€æœ¯è¯„å®¡å’ŒæŠ€æœ¯æ–‡æ¡£ä¸åˆ°ä½ å¼€å‘å„è‡ªæŒ‰ç…§æ¨¡å—å¼€å‘ï¼Œå¿½ç•¥å¤–éƒ¨ç¯å¢ƒï¼Œä»…ä»…å½“å„è‡ªå¼€å‘å®Œæˆåè”è°ƒæ—¶å€™æ‰ä¼šç»„è£…åº”ç”¨ï¼Œå‘ç°é—®é¢˜ å½“ç„¶ï¼Œå¯èƒ½æœ‰ç¨‹åºå‘˜xdä¼šç–‘é—®ï¼šè¿™ç§é—®é¢˜ä¸æ˜¯é ä¸¥è°¨çš„å¼€å‘æµç¨‹å°±å¯ä»¥é¿å…å—ï¼Ÿ\nç†è®ºä¸Šæ¥è¯´æ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯ä»¥æˆ‘ä¸ªäººç»å†è€Œè¨€ï¼Œä¸ç®¡æ˜¯å¤§å›¢é˜Ÿè¿˜æ˜¯å°å›¢é˜Ÿï¼Œæ€»æœ‰å¾ˆå¤šä¸ç¨³å®šçš„å› ç´ ï¼Œæ¯”å¦‚è¯´è¿­ä»£å‘¨æœŸã€åä½œæµç¨‹çš„è§„èŒƒæ€§ç­‰ç­‰ã€‚\nç‰¹åˆ«æ˜¯åœ¨åˆ›ä¸šå›¢é˜Ÿï¼Œæˆ–è€…æœ‰äº›é¡¹ç›®ç‰¹åˆ«ç€æ€¥çš„æ—¶å€™ï¼Œç»å¸¸æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´ç»™åˆ°å›¢é˜Ÿçš„å„ä¸ªè§’è‰²å»å……åˆ†å‡†å¤‡çš„ï¼Œç”šè‡³ä¸ºäº†èµ¶æ—¶é—´ï¼Œä¼šç²¾ç®€ä¸€äº›ç¯èŠ‚ç”šè‡³ç›´æ¥å»æ‰ã€‚è¿™ç§æ—¶å€™å‡ºç°è¿™ç§é—®é¢˜å¯¼è‡´æ”¹éœ€æ±‚ï¼Œå¾€å¾€æ˜¯éå¸¸å¯æ€•çš„ï¼Œåæœä¹Ÿå¾€å¾€æ˜¯å¼€å‘å›¢é˜ŸåŠ ç­ã€‚\nè§£å†³æ–¹æ¡ˆ æˆ‘ç›®å‰å‘ç°ä¸”å®è·µåæ•ˆæœè¾ƒå¥½çš„æ–¹æ¡ˆï¼Œå°±æ˜¯â€œæ›³å…‰å¼¹å¼å¼€å‘â€ã€‚\nä»€ä¹ˆæ˜¯æ›³å…‰å¼¹ ç»å¸¸å…³æ³¨å†›äº‹çš„å°ä¼™ä¼´å„¿ï¼Œåº”è¯¥äº†è§£ï¼Œæ›³å…‰å¼¹æ˜¯ä¸€ç§è¿ç”¨äºå†›äº‹åœºæ™¯çš„ç‰¹æ®Šå­å¼¹ã€‚\næˆ‘ä»¬éƒ½çŸ¥é“æ­¦å™¨å‘å°„æ—¶éœ€è¦ç„å‡†ï¼Œæ¯”å¦‚æªå°±é€šè¿‡ç…§é—¨å’Œå‡†æ˜Ÿæ¥ç„å‡†ï¼Œè€Œå¦å…‹å’Œè£…ç”²è½¦ä»¥åŠé£æœºéƒ½æœ‰ä¸“ç”¨çš„ç„å‡†å…·ï¼Œéå¸¸å¤æ‚ã€‚å¯¹äºè½»æ­¦å™¨æ¥è¯´ï¼Œä¸€èˆ¬æ”»å‡»è·ç¦»éƒ½æ¯”è¾ƒè¿‘ï¼Œä½¿ç”¨è‡ªå¸¦çš„æœºæ¢°ç„å‡†å…·æˆ–è€…å¤–åŠ çš„å…‰å­¦ç„å‡†é•œéƒ½è¶³å¤Ÿï¼Œä½†æ˜¯åœ¨è·ç¦»ç¨è¿œçš„æ—¶å€™ç„å‡†é•œæ˜¾ç„¶ä¸å¤Ÿã€‚è€Œå¯¹äºé£æœºå’Œæˆ˜æ–—æœºæ¥è®²ï¼Œåœ¨ç©ºä¸­é£è¡Œæ—¶é£è¡Œå§¿æ€å˜åŒ–å¤šæ ·ï¼Œæœ‰æ—¶å€™è¿›æ”»çš„æ—¶é—´å¾ˆçŸ­ï¼Œéœ€è¦å¿«é€Ÿå°„å‡»å¹¶ä¸”è°ƒæ•´å¼¹é“ï¼Œè¿™æ—¶å€™å°±éœ€è¦å¯ä»¥å‘å…‰çš„æ›³å…‰å¼¹ã€‚\næ›³å…‰å¼¹æ­£å¦‚å…¶åï¼Œå¯ä»¥å‘å…‰è€Œä¸”æŒ‡ç¤ºå¼¹é“ã€‚æ›³å…‰å¼¹çš„ç»“æ„æ¯”ä¸€èˆ¬å­å¼¹æ›´åŠ å¤æ‚ã€‚å­å¼¹çš„å¼¹å£³éƒ¨åˆ†å’Œä¸€èˆ¬å­å¼¹ä¸€æ ·ï¼Œå‰åŠéƒ¨åˆ†æ˜¯é’¢å¿ƒæˆ–è€…é“…å¿ƒçš„å¼¹å¤´ï¼Œä½†æ˜¯åœ¨åéƒ¨æœ‰ä¸€ä¸ªç©ºè…”ï¼Œä¸€èˆ¬ç§°ä½œæ›³å…‰ç®¡ï¼Œé‡Œé¢å¡«å……ç€æ›³å…‰å‰‚ã€‚æ›³å…‰å‰‚çš„æˆåˆ†è¿˜æ¯”è¾ƒå¤æ‚ï¼Œä¸€èˆ¬æ¥è¯´ä¸»è¦æˆåˆ†æ˜¯é•ç²‰å’Œé“é•åˆé‡‘ç²‰ï¼Œç”¨æ¥ç‡ƒçƒ§ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ç¡é…¸é”¶ã€‚è¿™æ ·ä¸€æ¥ï¼Œç‡ƒçƒ§çš„æ—¶å€™ç¡é…¸é”¶å°±ä¼šå‘å‡ºçº¢å…‰ã€‚å¤§å®¶å¹³æ—¶çœ‹åˆ°çš„å¾ˆå¤šæ›³å…‰å¼¹è¿˜æœ‰é»„å…‰å’Œç»¿å…‰ï¼ŒåŠ å…¥é’ ç›å°±ä¼šå‘å‡ºé»„å…‰ï¼Œè€ŒåŠ å…¥é“œç›å°±ä¼šå‘å‡ºç»¿å…‰ã€‚é™¤æ­¤ä¹‹å¤–è¿˜åœ¨è¡¨é¢åŠ å…¥ä¸€å±‚è¿‡æ°§åŒ–é’¡ï¼Œä»¥ä¿è¯æ›³å…‰å‰‚è¢«ç‚¹ç‡ƒã€‚\nå¯¹äºæœºæªæ‰‹æ¥è¯´ï¼Œå¦‚æœå°„å‡»è·ç¦»è¾ƒè¿œï¼Œè‡ªç„¶ä¸èƒ½é€‰æ‹©è¿‡äºç²¾ç¡®çš„è®¾è®¡æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½é ç„å‡†å…·æ¥å°„å‡»ã€‚è€Œä¸€èˆ¬çš„æœºæªä¸»è¦èµ·å‹åˆ¶å’Œé¢æ€ä¼¤ä½œç”¨ï¼ŒåŠ å…¥æ›³å…‰å¼¹å°±æ˜¯æœºæªæ‰‹æ›´åŠ å¿«é€Ÿæ–¹ä¾¿çš„æ§åˆ¶å¼¹é“ï¼Œéšæ—¶å˜åŒ–æ”»å‡»çš„æ–¹å‘ã€‚å¦‚æœæ²¡æœ‰æ›³å…‰å¼¹çš„è¯ï¼Œå°„æ‰‹æ ¹æœ¬æ— æ³•å‘ç°è‡ªå·±çš„å­å¼¹å¼¹é“ï¼Œä¹Ÿå°±å¾ˆéš¾å»è°ƒæ•´å¼¹é“ã€‚æ¯•ç«Ÿæªæ¢°å°„å‡»æ¸©åº¦å‡é«˜ä¹‹åï¼Œå¼¹é“ä¼šæœ‰æ‰€å˜åŒ–ï¼Œä¸åŒçš„å¼¹è¯ä¸åŒçš„æªç®¡ä¹Ÿéƒ½ä¼šæ”¹å˜å­å¼¹çš„å¼¹é“ï¼Œå¦‚æœä»…ä»…ä¾é æªæ¢°è‡ªèº«çš„ç„å‡†å…·å»è°ƒæ•´åè€Œä¼šé€‚å¾—å…¶åï¼Œè€Œæ›³å…‰å¼¹å°±å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚\nåœ¨å¼€å‘ä¸­çš„ä½œç”¨ ç†è§£æ›³å…‰å¼¹æœ¬èº«åœ¨å†›äº‹ä¸­çš„ä½œç”¨åï¼Œæˆ‘ä»¬å†æ¥çœ‹æ›³å…‰å¼¹å¼å¼€å‘å¦‚ä½•åœ¨å¼€å‘ä¸­èµ·ä½œç”¨ã€‚\nå¼€å‘å›¢é˜Ÿåœ¨æ¥æ‰‹åˆ°äº§å“ç»™åˆ°çš„ä¸šåŠ¡éœ€æ±‚åï¼Œç‰¹åˆ«æ˜¯æ„å»ºä¸€äº›ä»¥å‰ä»æœªåšè¿‡çš„ä¸œè¥¿æ—¶ï¼Œå¯¹è¿™ä¸ªäº§å“/åŠŸèƒ½çš„æœ€ç»ˆæˆæ•ˆæ˜¯æ¨¡ç³Šçš„ã€‚\nç¨‹åºå‘˜å°±åƒå¦å…‹ä¸Šçš„æœºæªæ‰‹ä¸€æ ·ï¼Œåœ¨å°è¯•åœ¨é»‘æš—ä¸­å‡»ä¸­ç›®æ ‡ã€‚ä½†æ˜¯å¦‚æœåƒæ–‡ç« ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œå¤§å®¶å…ˆåŸ‹å¤´å†™è‡ªå·±çš„æ¨¡å—ï¼Œç„¶åå†è”è°ƒï¼Œæœ€ç»ˆå‘ç°é—®é¢˜ï¼Œæ„Ÿè§‰å°±åƒä¸€ä¸Šæˆ˜åœºï¼Œå¤§å®¶éƒ½æœç€å„è‡ªç†è§£çš„æ–¹å‘æ‹¼å‘½æ¸…ç©ºå¼¹å¤¹ï¼Œå‡»ä¸­ç›®æ ‡çš„å¯¥å¯¥æ— å‡ ï¼Œæœ€åå—ä¼¤çš„è¿˜æ˜¯è‡ªå·±ã€‚\næ‰€ä»¥ï¼Œæ­¤æ—¶ï¼Œå°±éœ€è¦å…ˆä½¿ç”¨å‡ é¢—æ›³å…‰å¼¹ï¼Œå»å‡»ä¸­ç›®æ ‡ï¼Œåœ¨é»‘æš—ä¸­åˆ’å‡ºè½¨è¿¹ï¼Œå¼€å‘å›¢é˜Ÿå†è°ƒæ•´æ–¹å‘ï¼Œå¯¹ç€ç›®æ ‡é›†ä¸­ç«åŠ›ã€‚\nå¦‚ä½•åº”ç”¨ éå¸¸ç®€å•ï¼æ­¥éª¤å¦‚ä¸‹ï¼š\næ‰¾å‡ºçº§åˆ«æœ€é«˜çš„éœ€æ±‚ ä»¥å®Œæˆæœ€åŸºç¡€çš„å®Œæ•´åŠŸèƒ½ä¸ºç›®æ ‡ï¼Œä»å‰ç«¯åˆ°éƒ¨ç½²ï¼Œå¼€å‘ä¸€ä¸ªå¯ä»¥è¿è¡Œçš„éª¨æ¶ æœ€åä¸Šç›¸å…³éœ€æ±‚çš„æµ‹è¯•æ¡ˆä¾‹ è¿™æ ·ï¼Œå°„å‡ºä¸€é¢—æ›³å…‰å¼¹ï¼Œç©¿é€å®¢æˆ·ç«¯ã€åç«¯ã€æ•°æ®åº“ã€è¿ç»´ã€æµ‹è¯•ç­‰ä¸åŒå±‚é¢ã€‚ä¸€æ—¦å‡»ä¸­ç›®æ ‡â€”â€”å³ç¬¦åˆç”¨æˆ·éœ€æ±‚ï¼Œåç»­çš„ä»»åŠ¡ä¾¿å¤§éƒ½æ˜¯æ¬ç –çš„æ´»å„¿ï¼Œå»ä¸°å¯Œè¿™ä¸ªéª¨æ¶ã€‚\næ›³å…‰å¼¹å¹¶ä¸æ˜¯æ€»èƒ½å‡»ä¸­ç›®æ ‡çš„ï¼Œä¸­é€”è‹¥æ˜¯å‘ç°æœªèƒ½å‡»ä¸­ç›®æ ‡ï¼Œä¾¿å¯åœ¨å‰æœŸä»¥æå°æˆæœ¬å»è°ƒæ•´æ›³å…‰å¼¹çš„æ–¹å‘ï¼Œç»§ç»­å‘å°„æ›³å…‰å¼¹ã€‚\nå¦‚æœä½ è¦é—®ï¼Œä»€ä¹ˆæ˜¯â€œæœ€åŸºç¡€çš„å®Œæ•´åŠŸèƒ½â€ï¼Œé‚£ä¹ˆå¯ä»¥è¿™ä¹ˆè¯´ï¼Œé‚£ä¹ˆä¸¾ä¸ªä¾‹å­ï¼šå‰ç«¯ä¸è¦ä»»ä½•æ ·å¼ï¼Œç›´æ¥èƒ½å¤Ÿæ»¡è¶³æ¯”å¦‚è¡¨å•åŠŸèƒ½å³å¯ï¼Œåç«¯ä¸ç”¨ä»»ä½•æ ¡éªŒï¼Œèƒ½å¤Ÿå¤„ç†å’Œä¼ é€’æ•°æ®å³å¯ã€‚\næ€»ç»“ ä¸ºäº†è§£å†³æ–‡ç« å¼€å¤´çš„é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨æ›³å…‰å¼¹å¼å¼€å‘ï¼Œå…ˆå¼€å‘ä¸€ä¸ªéª¨æ¶ï¼Œç¡®è®¤æ»¡è¶³éœ€æ±‚åï¼Œå³å¯ç»§ç»­ä¸°å¯Œéª¨æ¶ï¼Œå®Œæˆäº§å“ã€‚\nä½œä¸ºå›¢é˜Ÿçš„ä¸€å‘˜ï¼Œå›¢é˜Ÿçš„æ¯ä¸€ä¸ªè§’è‰²éƒ½å¾ˆé‡è¦ï¼Œç¨‹åºå‘˜è·Ÿäº§å“ä¹Ÿæ˜¯éœ€è¦ç´§å¯†åä½œï¼Œäº’å¸®äº’åŠ©ï¼Œæ‰èƒ½ä½¿å¾—äº§å“æ›´å¥½ï¼Œä¹Ÿä½¿å¾—ä¸šç»©æ›´å¥½ã€‚\n","date":"2023-12-05T15:56:29Z","image":"https://hunterji.com/zh-cn/posts/%E7%A8%8B%E5%BA%8F%E5%91%98%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E4%B8%9A%E5%8A%A1%E9%9C%80%E6%B1%82/cover_hu3359176830913878668.png","permalink":"https://hunterji.com/zh-cn/posts/%E7%A8%8B%E5%BA%8F%E5%91%98%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E4%B8%9A%E5%8A%A1%E9%9C%80%E6%B1%82/","title":"ç¨‹åºå‘˜å¦‚ä½•å¿«é€ŸéªŒè¯ä¸šåŠ¡éœ€æ±‚?"},{"content":"å‰è¨€ åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ã€Šä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(ä¸‰)â€”â€”Rustä¸JSäº¤äº’ã€‹ä¸­ï¼Œè®²è¿°äº†Rustä¸JSçš„äº¤äº’ï¼ŒåŒ…æ‹¬Rustä¸JSçš„å‡½æ•°ç›¸äº’è°ƒç”¨ï¼Œæ¯”è¾ƒç‚¸è£‚çš„åŠŸèƒ½å°±æ˜¯ä½¿ç”¨JSè°ƒç”¨Rustçš„structï¼ŒJSæœ¬èº«è¿structéƒ½æ²¡æœ‰ï¼Œå±…ç„¶å¯ä»¥è°ƒç”¨Rustçš„structï¼Œè¿™å¯¹äºRustå¼€å‘è€…çš„å¼€å‘ä½“éªŒè€Œè¨€ï¼Œæ˜¯çœŸçš„å¾ˆæ£’ï¼\nåŸºäºå‰é¢çš„ç³»åˆ—æ–‡ç« ï¼Œå·²ç»è¶³ä»¥ä½¿ç”¨Rustå¼€å‘ä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½äº†ã€‚\nä½†æ˜¯ï¼Œåœ¨å‰ç«¯å¼•å…¥wasmæ–‡ä»¶æ—¶ï¼Œè¿˜æ˜¯å¯èƒ½å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚wasmæ–‡ä»¶è¾ƒå¤§ï¼Œå¯¼è‡´ç½‘é¡µè®¿é—®æ—¶é—´è¾ƒé•¿ï¼Œç”¨æˆ·ä½“éªŒè¾ƒå·®ã€‚æœ¬ç¯‡æ–‡ç« å°†ä¼šé€šè¿‡å¤šç§é€”å¾„æ¥å‡å°‘Rustç¼–è¯‘wasmæ–‡ä»¶çš„ä½“ç§¯ï¼Œä»¥å‡å°‘å‰ç«¯åŠ è½½wasmæ–‡ä»¶çš„æ—¶é—´ã€‚\næ›¾ç»ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä¸€ç›´ç”¨Goå¼€å‘WebAssemblyï¼Œå…¶ç¼–è¯‘åçš„wasmæ–‡ä»¶ä½“ç§¯è¿˜æ˜¯è¾ƒå¤§çš„ï¼Œä¸ºäº†å‡å°‘wasmæ–‡ä»¶çš„ä½“ç§¯çœŸæ˜¯ç…è´¹è‹¦å¿ƒï¼Œ1xMBå¤§å°çš„wasmæ–‡ä»¶çœŸçš„æ˜¯å¤ªç—›äº†\u0026hellip;\u0026hellip;ä½†æ˜¯ä½“ç§¯ä¼˜åŒ–å¾€å¾€éƒ½ä¼šæŒ‡å‘ä¸€æ¡â€œå……æ»¡é­…æƒ‘çš„ä¸å½’è·¯â€â€”â€”æ¢æˆRustå¼€å‘ğŸ˜†ï¼å¦‚æœä½ å·²ç»åœ¨ç”¨Rustå¼€å‘WebAssemblyäº†ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œå¯¹Goè€Œè¨€ï¼Œåœ¨wasmä½“ç§¯ä¸Šï¼Œä½ å·²ç»èµ¢åœ¨èµ·è·‘çº¿ä¸Šäº†ã€‚\nç¯å¢ƒ Rust 1.70.0 wasm-bindgen 0.2.87 æŸ¥çœ‹ä½“ç§¯ åœ¨çœŸæ­£å»å‡å°‘ä½“ç§¯å‰ï¼Œæˆ‘ä»¬éœ€è¦æ¥å…ˆçœ‹ä¸€ä¸‹ï¼Œå½“å‰æƒ…å†µä¸‹ä½“ç§¯æ˜¯å¤šå°‘ï¼Œæ–¹ä¾¿åç»­å¯¹æ¯”å‰åä½“ç§¯ã€‚\næŸ¥çœ‹ä½“ç§¯çš„æ–¹å¼æœ‰å¤šç§ï¼Œè¿™é‡Œæ¨èå‡ ä¸ªï¼Œï¼ˆLinuxå’ŒMacOSï¼‰ä½¿ç”¨å…¶ä¸€å³å¯ã€‚\nls å¯ä»¥ä½¿ç”¨ls -læˆ–è€…llï¼š\n1 2 $ ll pkg/hello_wasm_bg.wasm -rw-r--r-- 1 kuari staff 23K Jul 20 21:52 pkg/hello_wasm_bg.wasm stat 1 2 $ stat pkg/hello_wasm_bg.wasm 16777222 142141572 -rw-r--r-- 1 kuari staff 0 23347 \u0026#34;Jul 20 21:52:53 2023\u0026#34; \u0026#34;Jul 20 21:52:01 2023\u0026#34; \u0026#34;Jul 20 21:52:01 2023\u0026#34; \u0026#34;Jul 20 21:52:01 2023\u0026#34; 4096 48 0 pkg/hello_wasm_bg.wasm wc 1 2 $ wc -c pkg/hello_wasm_bg.wasm 23347 pkg/hello_wasm_bg.wasm ä»¥wcä¸ºä¾‹ï¼Œå½“å‰è¯¥wasmæ–‡ä»¶ä½“ç§¯ä¸º23347bã€‚\nä»£ç å±‚é¢ Link-Time Optimization (LTO) æ˜¯æŒ‡åœ¨ç¨‹åºé“¾æ¥æ—¶è¿›è¡Œçš„ä¸€ç§è¿‡ç¨‹é—´ä¼˜åŒ–ï¼ˆinterprocedural optimizationï¼‰ã€‚å®ƒå…è®¸ç¼–è¯‘å™¨åœ¨é“¾æ¥é˜¶æ®µå¯¹å¤šä¸ªç¼–è¯‘å•å…ƒè¿›è¡Œä¼˜åŒ–ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€å¯é æ€§å’Œå®‰å…¨æ€§ã€‚\nä»ä»£ç å±‚é¢ä¼˜åŒ–ï¼Œä¸»è¦æ˜¯åˆ©ç”¨LTOï¼ˆLink-Time Optimizationï¼‰ã€‚\nä»£ç å†… åœ¨Cargo.tomlä¸­å¼€å¯LTOï¼š\n1 2 [profile.release] lto = true å¼€å¯LTOè™½ç„¶èƒ½å¤Ÿå‡å°‘ç¼–è¯‘åçš„ä½“ç§¯ï¼Œä½†æ˜¯ä¹Ÿä¼šå¢åŠ ç¼–è¯‘æ—¶é—´ã€‚\nLTOå¼€å¯åï¼Œé»˜è®¤æ˜¯åœ¨å‡å°‘ä¸€å®šç¨‹åº¦çš„ç¼–è¯‘ä½“ç§¯çš„æƒ…å†µä¸‹ï¼Œè¦ç¡®ä¿ç¼–è¯‘çš„æ—¶é—´ã€‚å¦‚æœä½ çš„éœ€æ±‚å°±æ˜¯æ›´å°çš„ä½“ç§¯ï¼Œè€Œä¸æ˜¯è¾ƒçŸ­çš„æ—¶é—´ï¼Œé‚£ä¹ˆï¼Œå¯ä»¥é€šè¿‡æ‰‹åŠ¨æŒ‡å®šç¼–è¯‘ç­‰çº§æ¥è®©LTOä½œå‡ºæ”¹å˜ã€‚\nåœ¨ä»£ç å†…å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ç­‰çº§ï¼š\nsï¼šé»˜è®¤çš„ LTO ç­‰çº§ã€‚å®ƒä¼šè¿›è¡Œæœ€åŸºæœ¬çš„ LTO ä¼˜åŒ–ï¼ŒåŒ…æ‹¬å†…è”å‡½æ•°ã€å‡½æ•°é‡å†™ã€æ•°æ®é‡æ’ç­‰ zï¼šæœ€é«˜çº§çš„ LTO ç­‰çº§ã€‚å®ƒä¼šè¿›è¡Œæ›´å¤æ‚çš„ LTO ä¼˜åŒ–ï¼ŒåŒ…æ‹¬æ­»ä»£ç æ¶ˆé™¤ã€å†…å­˜åˆ†é…ä¼˜åŒ–ã€å®‰å…¨æ€§ä¼˜åŒ–ç­‰ é‚£ä¹ˆå¯ä»¥åœ¨Cargo.tomlä¸­è¿™ä¹ˆé…ç½®ï¼š\n1 2 3 [profile.release] lto = true opt-level = \u0026#39;z\u0026#39; åŸå§‹çš„æ–‡ä»¶ä½“ç§¯æ˜¯23347bï¼Œç°åœ¨ç¼–è¯‘åçœ‹ä¸€ä¸‹ä½“ç§¯ï¼š\n1 2 $ wc -c pkg/hello_wasm_bg.wasm 19879 pkg/hello_wasm_bg.wasm å¾ˆæ˜æ˜¾æ˜¯å‡å°‘ä½“ç§¯ï¼ä½†æ˜¯ï¼Œä½¿ç”¨zç­‰çº§å¹¶ä¸ä»£è¡¨ä¸€å®šæ¯æ¬¡ä½“ç§¯éƒ½ä¼šæ¯”så°çš„ï¼Œæœ‰æ—¶å€™sä¹Ÿä¼šæ¯”zå°ï¼Œè¿™éœ€è¦è§†ä»£ç æƒ…å†µè€Œå®šã€‚\nä»£ç å¤– åœ¨ä»£ç å¤–ï¼Œå¯ä»¥ä½¿ç”¨wasm-optæ¥è¿›è¡Œä¼˜åŒ–ï¼Œå…¶å¯ä»¥å¯¹ WebAssembly æ¨¡å—è¿›è¡Œå¤šæ–¹é¢çš„ä¼˜åŒ–ï¼Œå½“ç„¶æœ¬ç¯‡æ–‡ç« ä¸­é‡ç‚¹åœ¨ä½“ç§¯æ–¹é¢ï¼ˆæŒ–ä¸ªå‘ï¼Œåé¢å†è¯¦èŠ/ç‹—å¤´ï¼‰ã€‚å¹¶ä¸”wasm-optå¯ä»¥å¯¹æ‰€æœ‰ç¬¦åˆWebAssemblyè§„èŒƒçš„wasmæ–‡ä»¶è¿›è¡Œä¼˜åŒ–ï¼Œæ‰€ä»¥ï¼Œå°±ç®—ä½ ä¸æ˜¯Rustå†™çš„ï¼Œé‚£ä¹Ÿå¯ä»¥ç”¨å…¶è¿›è¡Œä¼˜åŒ–ã€‚ï¼ˆæƒ³æƒ³æˆ‘æ›¾ç»Goå†™çš„wasmï¼Œä¹Ÿæ˜¯æœ‰å¤šä¸€ä¸ªæ³•å­å¯ä»¥ä¼˜åŒ–ä¸€æŠŠäº†\u0026hellip;\u0026hellip;ï¼‰\né¦–å…ˆï¼Œæ¥çœ‹ä¸€ä¸‹wasm-optçš„åŸºæœ¬ä¼˜åŒ–å‚æ•°ï¼š\n-oï¼šæŒ‡å®šä¼˜åŒ–åçš„æ¨¡å—è¾“å‡ºæ–‡ä»¶ -Oï¼šå¯ç”¨é»˜è®¤ä¼˜åŒ–ï¼Œç­‰åŒäº-Oså‚æ•° -O0ï¼šä¸è¿›è¡Œä»»ä½•ä¼˜åŒ– -O1ï¼šè¿›è¡Œä¸€äº›åŸºæœ¬çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚å†…è”å‡½æ•°ä¼˜åŒ–å’Œæ­»ä»£ç æ¶ˆé™¤ä¼˜åŒ– -O2ï¼šè¿›è¡Œæ›´ä¸ºå½»åº•çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚å‡½æ•°é‡å†™ã€æ•°æ®é‡æ’ã€å†…å­˜åˆ†é…ä¼˜åŒ–ç­‰ -O3ï¼šè¿›è¡Œæœ€ä¸ºå½»åº•çš„ä¼˜åŒ–ï¼ŒåŒ…æ‹¬ä¸€äº›å¯èƒ½å½±å“ç¨‹åºåŠŸèƒ½çš„ä¼˜åŒ– -O4ï¼šä¸ -O3 ç›¸åŒï¼Œä½†ä¼šå¯ç”¨æ›´ä¸ºæ¿€è¿›çš„ä¼˜åŒ– -Osï¼šä¼˜åŒ–ç›®æ ‡æ˜¯å‡å°ä»£ç å¤§å°ï¼Œä¼šè¿›è¡Œä¸€äº›å¯èƒ½å½±å“æ€§èƒ½çš„ä¼˜åŒ– -Ozï¼šä¸ -Os ç›¸åŒï¼Œä½†ä¼šå¯ç”¨æ›´ä¸ºæ¿€è¿›çš„ä¼˜åŒ– åŸºäºæœ¬ç¯‡æ–‡ç« ä¸»é¢˜ï¼Œæ­¤å¤„å°†ä½¿ç”¨-Oså’Œ-Ozä¸¤ç§å‚æ•°ï¼Œå…¶äºä¸Šè¿°\u0026quot;ä»£ç å†…\u0026quot;çš„ç­‰çº§æ˜¯å¯¹åº”çš„ã€‚\næ­¤å¤„ä»¥åŸå§‹wasmæ–‡ä»¶ï¼Œä»¥-Ozå‚æ•°æ¥æ‰§è¡Œä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹å¯¹æ¯”æ•ˆæœï¼š\n1 2 $ wc -c pkg/output.wasm 23194 pkg/output.wasm å†ä»¥ä¸Šè¿°å¼€å¯â€œä»£ç å†…â€œLTOç¼–è¯‘åçš„wasmæ–‡ä»¶ï¼Œä»¥wasm-optæ‰§è¡Œä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹å¯¹æ¯”æ•ˆæœï¼š\n1 2 $ wc -c pkg/output.wasm 19871 pkg/output.wasm æ€»ä½“è€Œè¨€ï¼Œwasmæ–‡ä»¶çš„ä½“ç§¯è¶Šæ¥è¶Šå°ã€‚åªæ˜¯å½“å‰æˆ‘è¿™é‡Œçš„æ¡ˆä¾‹ï¼Œæ˜¯æ²¿ç”¨ç³»åˆ—æ–‡ç« å†…å®¹çš„ä»£ç ï¼Œæ²¡æœ‰ä»€ä¹ˆå®é™…æ€§å¤æ‚ä»£ç ï¼Œå†è€…æœ¬èº«ä½“ç§¯å·²ç»å¾ˆå°äº†ï¼Œæ‰€ä»¥ä¸ä¼šç‰¹åˆ«æœ‰æ•ˆæœã€‚\nç½‘ç»œå±‚é¢ ç½‘ç»œå±‚é¢çš„è¯ï¼Œå°±æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„åœ¨ç½‘ç»œä¼ è¾“æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çº¦å®šç›¸åŒçš„å‹ç¼©ç®—æ³•ï¼Œç„¶åæœåŠ¡ç«¯ç»™å‡ºæ—¶è¿›è¡Œå‹ç¼©ï¼Œå®¢æˆ·ç«¯æ¥æ”¶æ—¶è¿›è¡Œè§£å‹ã€‚ç½‘ç»œå±‚é¢å¯ä»¥å¯¹ä¼ è¾“æŠ¥æ–‡è¿›è¡Œå‹ç¼©ï¼Œä½†ä¸ä¸¢å¤±ä¿¡æ¯ã€‚\næ¯”å¦‚å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰çš„gzipå‹ç¼©ç®—æ³•ï¼Œä¸è¿‡ï¼Œå‹ç¼©ç®—æ³•æœ‰å¥½å‡ ç§ï¼š\ngzip compress deflate br å…¶ä¸­gzipä¹Ÿæ˜¯å‹ç¼©ç‡æœ€é«˜çš„äº†ï¼Œæ­¤å¤„å°±ä»¥gzipä¸ºä¾‹ã€‚\nåœ¨ç½‘ç»œå±‚é¢ï¼Œå°†wasmæ–‡ä»¶ä»¥gzipå‹ç¼©ï¼Œå‡å°‘å…¶åœ¨ä¼ è¾“æ—¶çš„ä½“ç§¯ã€‚è™½ç„¶å‡å°‘äº†ä¼ è¾“æ—¶çš„ä½“ç§¯ï¼Œä½†æ˜¯æµè§ˆå™¨åœ¨æ‹¿åˆ°å‹ç¼©åçš„æ•°æ®ï¼Œéœ€è¦æ¶ˆè€—ä¸€å®šæ€§èƒ½æ¥è§£å¯†ã€‚\nå¼€å¯GZIP å¼€å¯GZIPå…¶å®ç®€å•ï¼Œåªè¦å‰åç«¯çº¦å®šå¥½éƒ½ç”¨gzipå°±è¡Œäº†ã€‚\né¦–å…ˆï¼Œå‰ç«¯è¯·æ±‚wasmæ–‡ä»¶æ—¶ï¼Œéœ€è¦åœ¨request headerä¸­æ”¾å…¥æµè§ˆå™¨æ”¯æŒçš„å‹ç¼©æ¨¡å¼ï¼š\n1 Accept-Encoding: gzip, deflate æ¥ç€ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åå°±å¯ä»¥ç»™å‡ºæœåŠ¡ç«¯ä¹Ÿæ”¯æŒçš„å‹ç¼©æ¨¡å¼ï¼Œå¹¶å‘Šè¯‰æµè§ˆå™¨æœåŠ¡ç«¯å°†ä¼šç”¨ä»€ä¹ˆå‹ç¼©æ¨¡å¼ã€‚\nè·Ÿæµè§ˆå™¨é€šä¿¡çš„æ–¹å¼å°±æ˜¯å°†ä¿¡æ¯å¡åˆ°respone headeré‡Œé¢ï¼š\n1 Content-Encoding: gzip è¿™æ ·å°±å¼€å¯GZIPäº†ã€‚\nç„¶åï¼Œå°±æ˜¯æµè§ˆå™¨æ¥æ”¶åˆ°responseçš„bodyå’Œheaderï¼ŒçŸ¥é“åç«¯ä½¿ç”¨gzipå‹ç¼©çš„ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šè‡ªåŠ¨ç”¨gzipæ¥è§£å‹ï¼Œæ‹¿åˆ°å®Œæ•´çš„æ•°æ®äº†ã€‚\næœåŠ¡ç«¯æ”¯æŒ æˆ–è®¸ä½ ä¼šæƒ³é—®ï¼Œæµè§ˆå™¨èƒ½è‡ªåŠ¨è§£å¯†ï¼Œé‚£æœåŠ¡ç«¯æ€ä¹ˆè‡ªåŠ¨åŠ å¯†å‘¢ï¼Ÿè¦åç«¯å†™ä»£ç è®©æ–‡ä»¶åŠ å¯†å—ï¼Ÿ\né‚£å½“ç„¶ä¸æ˜¯äº†ï¼Œç›´æ¥è®©http serveræ¥å®Œæˆè¿™ä¸ªæ“ä½œã€‚æ­¤å¤„ä»¥è€³ç†Ÿèƒ½è¯¦çš„Nginxä¸ºä¾‹ã€‚\næœ€ç®€å•çš„å°±æ˜¯ä¸€è¡Œé…ç½®å¼€å¯gzipäº†ï¼š\n1 gzip on; ä¹Ÿå¯ä»¥æŒ‡å®šgzipçš„ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚å¯ä»¥åŠ å¯†çš„ç±»å‹ã€æœ€å°åŠ å¯†é•¿åº¦ç­‰ç­‰ï¼š\n1 2 3 4 5 gzip on; gzip_types text/plain application/xml; gzip_proxied no-cache no-store private expired auth; gzip_min_length 1000; ... æ›´å¤šçš„http serveré…ç½®ï¼Œå¯ä»¥å»å„è‡ªå®˜æ–¹æ–‡æ¡£æŸ¥é˜…ã€‚\nç‰©ç†å±‚é¢ ä½ å¯èƒ½ä¼šæƒŠå¥‡ï¼Œä»€ä¹ˆç‰©ç†å±‚é¢ï¼Ÿï¼\næ²¡é”™ï¼ŒçœŸå°±æ˜¯ç‰©ç†å±‚é¢â€”â€”ç›´æ¥å¯¹wasmæ–‡ä»¶è¿›è¡Œgzipç‰©ç†å‹ç¼©ï¼å“ˆå“ˆï¼Œè¿™ä¸ªæ–¹æ³•ä¹ŸçœŸæ˜¯ç»äº†ï¼Œæˆ‘ä¹‹å‰åœ¨Goå¼€å‘wasmæ—¶ï¼Œå¯»æ‰¾å‡å°‘ä½“ç§¯çš„æ—¶å€™å‘ç°çš„ï¼Œå¦‚æœä½ çš„wasmå·²ç»ä¼˜åŒ–å¾—ç©·é€”æœ«è·¯äº†ï¼Œä¸å¦¨å¤§èƒ†è¯•è¯•è¿™ä¸ªæ–¹æ¡ˆã€‚ğŸ˜†\nè¿˜è®°å¾—ä¸Šé¢ç« èŠ‚â€œç½‘ç»œå±‚é¢â€œä¸­ï¼Œæœ‰ä¸ªé—®é¢˜å°±æ˜¯æ˜¯å¦éœ€è¦æ‰‹åŠ¨å‹ç¼©ï¼Œé‚£ä¹ˆè¿™é‡Œå°±æ˜¯å…¨ç¨‹æ‰‹åŠ¨å‹ç¼©å’Œè§£å‹ç¼©äº†ï¼Œå“ˆå“ˆã€‚\nç‰©ç†å‹ç¼© é¦–å…ˆï¼Œæ˜¯å¯¹wasmæ–‡ä»¶è¿›è¡Œç‰©ç†å±‚é¢çš„gzipå‹ç¼©ï¼Œæ­¤å¤„å…ˆä½¿ç”¨åŸå§‹çš„wasmï¼ˆ23347bï¼‰ï¼š\n1 gzip -c pkg/hello_wasm_bg.wasm \u0026gt; pkg/output.gz ç„¶åï¼Œçœ‹ä¸€ä¸‹å…¶ä½“ç§¯ï¼š\n1 2 $ wc -c pkg/output.gz 10403 pkg/output.gz æ•ˆæœå“ç¾¤ï¼Œä»23347bå‡å°‘åˆ°äº†10403bï¼\nç„¶åæ¥æŠŠä¸Šè¿°â€œä»£ç å±‚é¢â€çš„ä¼˜åŒ–æ¥ä¸€éï¼Œçœ‹ä¸€ä¸‹æœ€åçš„ä½“ç§¯ï¼š\n1 2 $ wc -c pkg/output.gz 9237 pkg/output.gz æ•ˆæœæ›´åŠ å“ç¾¤äº†ï¼Œä»19871bå‡å°‘åˆ°äº†9237bäº†ï¼\næ‰€ä»¥ï¼Œæ­¤å¤„å°±æ˜¯å¯¹wasmæ–‡ä»¶è¿›è¡Œç‰©ç†å‹ç¼©å¹¶å­˜å‚¨ï¼Œç„¶åæµè§ˆå™¨è¯·æ±‚æ—¶ï¼Œç›´æ¥è¯·æ±‚åˆ°.gzæ–‡ä»¶ã€‚\nç‰©ç†è§£å‹ æµè§ˆå™¨æ‹¿åˆ°.gzæ–‡ä»¶åï¼Œéœ€è¦ç‰©ç†è§£å‹ã€‚\nè¿™é‡Œæ¨èä½¿ç”¨pakoè¿™ä¸ªå‰ç«¯åº“ï¼Œå¯¹.gzæ–‡ä»¶è¿›è¡Œè§£å‹ï¼š\n1 2 3 4 5 6 7 8 9 async function gunzipWasm() { const res = await fetch(\u0026#34;target.gz\u0026#34;) let buffer = await pako.ungzip(await res.arrayBuffer()) // A fetched response might be decompressed twice on Firefox. // See https://bugzilla.mozilla.org/show_bug.cgi?id=610679 if (buffer[0] === 0x1F \u0026amp;\u0026amp; buffer[1] === 0x8B) {buffer = pako.ungzip(buffer)} return buffer } ä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚\nBUFFå åŠ  æ­¤å¤„ç›´æ¥å°†ä¸Šè¿°æ‰€æœ‰æ–¹æ³•éƒ½ç”¨èµ·æ¥ï¼Œç›´æ¥å åŠ buffï¼Œæ¥çœ‹çœ‹å½“å‰ï¼ˆæœ¬ç³»åˆ—æ–‡ç« ç§¯ç´¯çš„ï¼‰è¿™ä¸ªæ¡ˆä¾‹èƒ½å‡å°‘å¤šå°‘ä½“ç§¯ã€‚åœ¨â€œç‰©ç†å±‚é¢â€ç« èŠ‚ä¸­ï¼Œå·²ç»ç´¯åŠ é™¤äº†â€œç½‘ç»œå±‚é¢â€çš„buffäº†ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨å…¶ç»“æœã€‚è€Œâ€œç½‘ç»œå±‚é¢â€ç« èŠ‚ä¸­ï¼Œä»¥gzipæ¥å‹ç¼©ï¼Œå°†gzipçš„å‹ç¼©ç‡ä»¥40%æ¥ä¼°ç®—ã€‚\né‚£ä¹ˆæœ€ç»ˆè¯¥æ¡ˆä¾‹çš„wasmä½“ç§¯å°†åœ¨5542bï¼Œå‹ç¼©ç‡å¤§çº¦åœ¨77%ï¼\nå½“ç„¶ï¼Œè¿˜è¦ç®—ä¸Šä¸€ä¸ªåˆå§‹çš„è¯­è¨€buffâ€”â€”Rustï¼Œä½¿ç”¨Rustæœ¬èº«å°±å·²ç»å¯¼è‡´wasmæ–‡ä»¶ä½“ç§¯å¾ˆå°äº†ã€‚\næ€»ç»“ æœ¬ç‰‡æ–‡ç« ä¸­ï¼Œä»ä»£ç å±‚é¢ã€ç½‘ç»œå±‚é¢ã€ç‰©ç†å±‚é¢å…±ä¸‰ä¸ªå±‚é¢ä»‹ç»äº†å¯¹wasmæ–‡ä»¶çš„ä½“ç§¯ä¼˜åŒ–æ–¹æ¡ˆï¼Œå…¶ä¸­å…±æœ‰å››ä¸ªæ–¹æ¡ˆã€‚\næœ€åï¼Œå½“å‰ï¼ˆæœ¬ç³»åˆ—æ–‡ç« ç§¯ç´¯çš„ï¼‰è¯¥æ¡ˆä¾‹å åŠ äº†æ‰€æœ‰buffä¹‹åï¼Œèƒ½å¤Ÿå‡å°‘77%çš„ä½“ç§¯ï¼ŒçœŸçš„æ„Ÿè§‰æŒºæ£’çš„äº†ï¼Œå“ˆå“ˆã€‚\nå¸Œæœ›èƒ½å¤Ÿå¯¹å„ä½æœ‰æ‰€å¸®åŠ©ã€‚\n","date":"2023-10-26T23:51:13Z","image":"https://hunterji.com/zh-cn/posts/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E5%9B%9B%E6%9B%B4%E5%B0%8F%E6%9B%B4%E5%B0%8F%E7%9A%84wasm%E6%96%87%E4%BB%B6%E4%BD%93%E7%A7%AF/cover_hu6437590238652352065.jpg","permalink":"https://hunterji.com/zh-cn/posts/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E5%9B%9B%E6%9B%B4%E5%B0%8F%E6%9B%B4%E5%B0%8F%E7%9A%84wasm%E6%96%87%E4%BB%B6%E4%BD%93%E7%A7%AF/","title":"ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(å››)â€”â€”æ›´å°æ›´å°çš„wasmæ–‡ä»¶ä½“ç§¯"},{"content":"å‰è¨€ åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ã€Šä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(äºŒ)â€”â€”DOMå’Œç±»å‹è½¬æ¢ã€‹ä¸­ï¼Œæè¿°äº†ä½¿ç”¨Rustæ“ä½œDOMï¼Œå¹¶å®ç°Rustä¸JSç±»å‹è½¬æ¢çš„å¤šç§æ–¹æ³•ã€‚\nåœ¨å¼€å‘ Web åº”ç”¨ç¨‹åºæ—¶ï¼Œä½¿ç”¨ Rust ç¼–å†™çš„ Wasm æ¨¡å—å¯ä»¥æä¾›æ›´é«˜çš„æ€§èƒ½å’Œæ›´å¥½çš„å®‰å…¨æ€§ã€‚ä½†æ˜¯ï¼Œä¸ºäº†ä¸ç°æœ‰çš„ JavaScript ä»£ç é›†æˆï¼Œå¿…é¡»å®ç° Rust ä¸ JS ä¹‹é—´çš„äº¤äº’ã€‚Rust ä¸ JS äº¤äº’çš„ä¸»è¦ç›®çš„æ˜¯å°†ä¸¤ç§è¯­è¨€çš„ä¼˜åŠ¿ç»“åˆèµ·æ¥ï¼Œä»¥å®ç°æ›´å¥½çš„ Web åº”ç”¨ç¨‹åºã€‚\nåŸºäºä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼ŒRustä¸JSçš„ç±»å‹è½¬æ¢çš„å¤šç§æ–¹æ³•ï¼Œæœ¬ç¯‡æ–‡ç« ç»§ç»­æ·±å…¥Rustä¸JSçš„äº¤äº’ã€‚\né¦–å…ˆï¼ŒRustä¸JSçš„ç±»å‹è½¬æ¢ï¼Œå¯ä»¥å®ç°å˜é‡çš„ä¼ é€’ï¼Œé‚£ä¹ˆå˜é‡æ˜¯è¦ç”¨åœ¨å“ªé‡Œå‘¢ï¼Ÿé‚£å¿…ç„¶æ˜¯å‡½æ•°äº†ï¼\næ‰€ä»¥ï¼Œæœ¬ç¯‡æ–‡ç« æ¥è®²è¿°ä¸€ä¸‹Rustä¸JSçš„å‡½æ•°ç›¸äº’è°ƒç”¨ï¼ŒåŸºäºæ­¤ï¼Œå¯ä»¥å®ç°å¤§é‡æ—¥å¸¸åŠŸèƒ½å¼€å‘ã€‚\nå¹¶ä¸”ï¼Œè¿˜å°†ä¼šè®²è¿°ä¸€ä¸‹ï¼Œå¦‚ä½•å¯¼å‡ºRustçš„structç»™JSè°ƒç”¨ã€‚\næ˜¯çš„ï¼Œæ²¡é”™ï¼Œåœ¨JSè°ƒç”¨Rustçš„structï¼ä¸€å¼€å§‹çœ‹åˆ°è¿™ä¸ªåŠŸèƒ½çš„æ—¶å€™ï¼Œæˆ‘çš„è„‘å­æ˜¯æœ‰ç‚¹ç‚¸è£‚çš„\u0026hellip;\u0026hellip;ğŸ˜³\næœ¬ç¯‡æ–‡ç« ä¸­ï¼Œå°†åŸºäºä¸Šä¸€ç¯‡æ–‡ç« ä¸­åˆ›å»ºçš„é¡¹ç›®æ¥ç»§ç»­å¼€å‘ã€‚\næºç ï¼šgithub.com/Kuari/hello-wasm\nç¯å¢ƒ Rust 1.70.0 wasm-bindgen 0.2.87 å‡½æ•°çš„ç›¸äº’è°ƒç”¨ JSè°ƒç”¨Rustå‡½æ•° å…¶å®ï¼Œåœ¨æœ¬ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ä¸­ï¼Œå°±æ˜¯ä½¿ç”¨çš„JSè°ƒç”¨Rustå‡½æ•°ä½œä¸ºæ¡ˆä¾‹æ¥æ¼”ç¤ºçš„ï¼Œè¿™é‡Œä¾ç„¶ä»¥æ­¤ä¸ºä¾‹ï¼Œä¸»è¦è®²ä¸€ä¸‹è¦ç‚¹ã€‚\né¦–å…ˆï¼Œå£°æ˜ä¸€ä¸ªRustå‡½æ•°ï¼š\n1 2 3 4 5 6 use wasm_bindgen::prelude::*; #[wasm_bindgen] pub fn add(a: i32, b: i32) -\u0026gt; i32 { a + b } æ­¤å¤„éœ€è¦æ³¨æ„çš„è¦ç‚¹å¦‚ä¸‹ï¼š\nå¼•å…¥wasm_bindgen å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨pubå£°æ˜ åœ¨å‡½æ•°ä¸Šä½¿ç”¨#[wasm_bindgen]å®æ¥å°†Rustå‡½æ•°å¯¼å‡ºä¸ºWebAssemblyæ¨¡å—çš„å‡½æ•° æ¥ç€ï¼Œç¼–è¯‘æˆwasmæ–‡ä»¶ï¼š\n1 wasm-pack build --target web ç„¶åï¼Œåœ¨JSä¸­è°ƒç”¨è¯¥å‡½æ•°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; import init, { add } from \u0026#39;./pkg/hello_wasm.js\u0026#39;; const run = async () =\u0026gt; { await init(); const result = add(1, 2); console.log(`the result from rust is: ${result}`); } run(); \u0026lt;/script\u0026gt; æœ€åï¼Œå¯åŠ¨http serverï¼Œåœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­å¯ä»¥çœ‹åˆ°the result from rust is: 3ï¼Œè¡¨æ˜è°ƒç”¨æˆåŠŸï¼\nRustè°ƒç”¨JSå‡½æ•° ###1 æŒ‡å®šJSå¯¹è±¡\nåœ¨Rustä¸­è°ƒç”¨JSå‡½æ•°ï¼Œéœ€è¦è¿›è¡ŒæŒ‡å®šJSå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¾—æ˜ç¡®å‘Šè¯‰Rustï¼Œè¿™ä¸ªJSå‡½æ•°æ˜¯ä»JSå“ªå„¿æ‹¿æ¥çš„ç”¨çš„ã€‚\nä¸»è¦åœ¨äºä¸‹é¢ä¸¤ä¸ªæ–¹å¼ï¼š\njs_namespace: æ˜¯ä¸€ä¸ªå¯é€‰çš„å±æ€§ï¼Œç”¨äºæŒ‡å®šä¸€ä¸ªJavaScriptå‘½åç©ºé—´ï¼Œå…¶ä¸­åŒ…å«å°†è¦åœ¨wasmæ¨¡å—ä¸­å¯¼å‡ºçš„å‡½æ•°ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šjs_namespaceï¼Œåˆ™æ‰€æœ‰çš„å¯¼å‡ºå‡½æ•°å°†è¢«æ”¾ç½®åœ¨å…¨å±€å‘½åç©ºé—´ä¸‹ã€‚ js_name: æ˜¯å¦ä¸€ä¸ªå¯é€‰å±æ€§ï¼Œå®ƒç”¨äºæŒ‡å®šJavaScriptä¸­çš„å‡½æ•°åç§°ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šjs_nameï¼Œåˆ™å¯¼å‡ºå‡½æ•°çš„åç§°å°†ä¸Rustä¸­çš„å‡½æ•°åç§°ç›¸åŒã€‚ ###2 JSåŸç”Ÿå‡½æ•°\nå¯¹äºä¸€äº›JSåŸç”Ÿå‡½æ•°ï¼Œåœ¨Rustä¸­ï¼Œéœ€è¦å»å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è®²çš„console.log()å‡½æ•°ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—å¥½éº»çƒ¦å•Šï¼\né‚£ä¹ˆï¼Œä½ æƒ³ç›´æ¥åœ¨Rustä¸­è°ƒç”¨JSåŸç”Ÿå‡½æ•°å—ï¼Ÿï¼\næ­¤å¤„ï¼Œå°±ä»¥console.log()å‡½æ•°ä¸ºä¾‹ï¼Œç›´æ¥åœ¨Rustä¸­å¼•å…¥å¹¶è°ƒç”¨ï¼Œå…å»æ›¿ä»£æ–¹æ¡ˆçš„çƒ¦æ¼ã€‚\né¦–å…ˆï¼Œç»™å‡ºRustä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 #[wasm_bindgen] extern \u0026#34;C\u0026#34; { #[wasm_bindgen(js_namespace = console)] fn log(message: \u0026amp;str); } #[wasm_bindgen] pub fn call_js_func() { log(\u0026#34;hello, javascript!\u0026#34;); } å¦‚ä¸Šä»£ç ä¸­ï¼Œcall_js_funcå‡½æ•°ï¼Œé¡¾åæ€ä¹‰ï¼Œæ­¤å¤„æ˜¯è°ƒç”¨äº†jså‡½æ•°ï¼Œå¹¶ä¼ å…¥å‚æ•°hello, javascript!ã€‚\né‚£ä¹ˆï¼Œcall_js_funcå‡½æ•°ä¸Šæ–¹çš„ä»£ç ï¼Œæˆ‘ä»¬æ¥ä¸€æ­¥æ­¥è§£æä¸€ä¸‹ï¼š\nç¬¬ä¸€è¡Œä»£ç #[wasm_bindgen]æ˜¯Rustçš„å±æ€§ï¼Œå®ƒå‘Šè¯‰ç¼–è¯‘å™¨å°†å‡½æ•°å¯¼å‡ºä¸ºWebAssemblyæ¨¡å— extern \u0026quot;C\u0026quot;æ˜¯Cè¯­è¨€è°ƒç”¨çº¦å®šï¼Œå®ƒå‘Šè¯‰Rustç¼–è¯‘å™¨å°†å‡½æ•°å¯¼å‡ºä¸ºCè¯­è¨€å‡½æ•° #[wasm_bindgen(js_namespace = console)]å‘Šè¯‰ç¼–è¯‘å™¨å°†å‡½æ•°ç»‘å®šåˆ°JavaScriptä¸­çš„consoleå¯¹è±¡ fn log(message: \u0026amp;str)æ˜¯ä¸€ä¸ªRustå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œå¹¶å°†å…¶æ‰“å°åˆ°JavaScriptä¸­çš„consoleå¯¹è±¡ä¸­ æ­¤å¤„ä¸JSäº¤äº’çš„å…³é”®æ˜¯js_namespaceã€‚åœ¨Rustä¸­ï¼Œjs_namespaceæ˜¯ç”¨äºæŒ‡å®šJavaScriptå‘½åç©ºé—´çš„å±æ€§ã€‚åœ¨WebAssemblyä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒå°†å‡½æ•°ç»‘å®šåˆ°JavaScriptä¸­çš„å¯¹è±¡ä¸Šã€‚\nåœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ#[wasm_bindgen(js_namespace = console)]å‘Šè¯‰ç¼–è¯‘å™¨å°†å‡½æ•°ç»‘å®šåˆ°JavaScriptä¸­çš„consoleå¯¹è±¡ã€‚è¿™æ„å‘³ç€åœ¨JSä¸­ä½¿ç”¨console.log()å‡½æ•°æ¥è°ƒç”¨Rustä¸­çš„log()å‡½æ•°ã€‚\nå› æ­¤ï¼Œç±»ä¼¼çš„åŸç”Ÿå‡½æ•°ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•æ¥å®ç°è°ƒç”¨ã€‚\næœ€åï¼Œæˆ‘ä»¬åœ¨JSä¸­è°ƒç”¨ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; import init, { call_js_func } from \u0026#39;./pkg/hello_wasm.js\u0026#39;; const run = async () =\u0026gt; { await init(); call_js_func(); } run(); \u0026lt;/script\u0026gt; å¯ä»¥åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­çœ‹åˆ°hello, javascript!ã€‚å¦™å•Šï¼\nå…¶å®å¯¹äºconsole.log()è€Œè¨€ï¼Œè¿˜æœ‰å¦ä¸€ç§è°ƒç”¨æ–¹å¼ï¼Œé‚£å°±æ˜¯ä½¿ç”¨js_namespaceå’Œjs_nameåŒæ—¶æŒ‡å®šã€‚\næˆ–è®¸ï¼Œä½ ä¼šé—®ï¼Œè¿™æœ‰ä»€ä¹ˆä¸åŒå—ï¼Ÿæ˜¯çš„ï¼Œè¿™æœ‰äº›ä¸åŒã€‚\nä¸çŸ¥é“ä½ æ˜¯å¦å‘ç°ï¼Œå½“å‰è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼ŒæŒ‡å®šäº†js_namespaceä¸ºconsoleï¼Œä½†æ˜¯çœŸå®æ‰§è¡Œçš„å‡½æ•°æ˜¯log()ï¼Œé‚£ä¹ˆè¿™ä¸ªlogå‡½æ•°çš„æŒ‡å®šï¼Œå…¶å®æ˜¯ä½“ç°åœ¨Rustä¸­åŒæ ·çš„å‡½æ•°ålogã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥æ¡ˆä¾‹çš„log()å°±æ˜¯console.log()ä¸­çš„log()ã€‚\næˆ‘ä»¬æ¥æ¢ä¸ªåå­—çœ‹çœ‹ï¼Œå°†åŸæ¥çš„log()æ¢æˆlog2()ï¼š\n1 2 3 4 5 6 7 8 9 10 #[wasm_bindgen] extern \u0026#34;C\u0026#34; { #[wasm_bindgen(js_namespace = console)] fn log2(message: \u0026amp;str); } #[wasm_bindgen] pub fn call_js_func() { log2(\u0026#34;hello, javascript!\u0026#34;) } ç„¶åç¼–è¯‘åå»æ§åˆ¶å°çœ‹çœ‹ï¼Œå°±ä¼šçœ‹åˆ°æŠ¥é”™ï¼š\n1 TypeError: console.log2 is not a function å› æ­¤ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨js_namespaceå’Œjs_nameç»“åˆçš„æ–¹å¼ï¼Œåœ¨æ­¤å¤„æ˜¯å¯ä»¥è¿›è¡Œè‡ªå®šä¹‰å‡½æ•°åçš„ã€‚\nçœ‹ä¸€ä¸‹Rustä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 #[wasm_bindgen] extern \u0026#34;C\u0026#34; { #[wasm_bindgen(js_namespace = console)] fn log(message: \u0026amp;str); #[wasm_bindgen(js_namespace = console, js_name = log)] fn log_str(message: \u0026amp;str); } #[wasm_bindgen] pub fn call_js_func() { log_str(\u0026#34;hello, javascript!\u0026#34;) } æ­¤å¤„ï¼Œé‡æ–°å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°log_strï¼Œä½†æ˜¯å…¶æŒ‡å®šäº†js_namespace = consoleå’Œjs_name = logï¼Œé‚£ä¹ˆæ­¤å¤„ï¼Œå°±å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„å‡½æ•°åã€‚\nç›´æ¥ç¼–è¯‘åï¼Œåœ¨æ§åˆ¶å°çœ‹ä¸€ä¸‹ï¼Œå¯ä»¥ç›´æ¥çœ‹åˆ°æ­£å¸¸è¾“å‡ºï¼šhello, javascript!ã€‚\næ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šjs_nameï¼Œåˆ™ Rust å‡½æ•°åç§°å°†ç”¨ä½œ JS å‡½æ•°åç§°ã€‚\n###3 è‡ªå®šä¹‰JSå‡½æ•°\nåœ¨ä¸€å®šåœºæ™¯ä¸‹ï¼Œéœ€è¦ä½¿ç”¨Rustè°ƒç”¨JSå‡½æ•°ï¼Œæ¯”å¦‚å¯¹äºä¸€äº›å¯¹äºJSè€Œè¨€æ›´æœ‰ä¼˜åŠ¿çš„åœºæ™¯â€”â€”ç”¨JSæ“ä½œDOMï¼Œç”¨Rustè®¡ç®—ã€‚\né¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶index.jsï¼Œå†™å…¥ä¸€ä¸ªå‡½æ•°ï¼š\n1 2 3 export function addIt(m, n) { return m + n; }; å½“å‰çš„æ–‡ä»¶ç»“æ„å…³ç³»å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 . â”œâ”€â”€ Cargo.lock â”œâ”€â”€ Cargo.toml â”œâ”€â”€ README.md â”œâ”€â”€ index.html â”œâ”€â”€ index.js â”œâ”€â”€ pkg â”‚Â â”œâ”€â”€ README.md â”‚Â â”œâ”€â”€ hello_wasm.d.ts â”‚Â â”œâ”€â”€ hello_wasm.js â”‚Â â”œâ”€â”€ hello_wasm_bg.wasm â”‚Â â”œâ”€â”€ hello_wasm_bg.wasm.d.ts â”‚Â â””â”€â”€ package.json â”œâ”€â”€ src â”‚Â â””â”€â”€ lib.rs â””â”€â”€ target â”œâ”€â”€ CACHEDIR.TAG â”œâ”€â”€ debug â”œâ”€â”€ release â””â”€â”€ wasm32-unknown-unknown å…¶ä¸­ï¼Œindex.jså’Œlib.rsï¼Œä»¥åŠhello_wasm_bg.wasméƒ½æ˜¯ä¸åœ¨åŒä¸€çº§åˆ«çš„ï¼Œindex.jséƒ½åœ¨å…¶å®ƒä¸¤ä¸ªæ–‡ä»¶çš„ä¸Šä¸€çº§ã€‚è®°ä½è¿™ä¸ªæœºæ„å…³ç³»ï¼\nç„¶åï¼Œåœ¨lib.rsä¸­ï¼ŒæŒ‡å®šå‡½æ•°ï¼š\n1 2 3 4 ##./index.js\u0026#34;)] extern \u0026#34;C\u0026#34; { fn addIt(m: i32, n: i32) -\u0026gt; i32; } å…¶ä¸­ï¼Œraw_module = \u0026quot;../index.js\u0026quot;çš„æ„æ€æ˜¯ï¼ŒæŒ‡å®šå¯¹åº”çš„index.jsæ–‡ä»¶ï¼Œå¤§å®¶åº”è¯¥æ¸…æ¥šï¼Œæ­¤å¤„æŒ‡å®šçš„æ˜¯åˆšåˆšåˆ›å»ºçš„index.jsã€‚raw_moduleçš„ä½œç”¨å°±æ˜¯ç”¨æ¥æŒ‡å®šjsæ–‡ä»¶çš„ã€‚\nè¿™æ®µä»£ç åœ¨å‰ç«¯ï¼Œå¯ä»¥ç­‰åŒäºï¼š\n1 import { addIt } from \u0026#39;../index.js\u0026#39; è¿™æ ·åœ¨å‰ç«¯éƒ½ä¸ç”¨å¼•å…¥äº†ï¼Œç›´æ¥åœ¨Rustä¸­å¼•å…¥äº†ï¼Œæ„Ÿè§‰è¿˜æœ‰ç‚¹å¥‡å¦™çš„ã€‚\næ¥ç€ï¼Œåœ¨Rustè°ƒç”¨è¯¥å‡½æ•°ï¼š\n1 2 3 4 #[wasm_bindgen] pub fn call_js_func() -\u0026gt; i32 { addIt(1, 2) } æœ€åï¼Œåœ¨å‰ç«¯è°ƒç”¨ï¼Œç¼–è¯‘åï¼Œåœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­å¯ä»¥çœ‹åˆ°è¾“å‡ºç»“æœäº†ï¼\næ€»ç»“ä¸€ä¸‹ï¼Œè¿™é‡Œæœ‰å‡ ä¸ªæ³¨æ„ç‚¹ï¼š\nJSçš„å‡½æ•°å¿…é¡»è¦exportï¼Œå¦åˆ™å°†æ— æ³•è°ƒç”¨ï¼› raw_moduleåªèƒ½ç”¨æ¥æŒ‡å®šç›¸å¯¹è·¯å¾„ï¼Œå¹¶ä¸”ï¼Œå¤§å®¶å¯ä»¥åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­æ³¨æ„åˆ°ï¼Œæ­¤å¤„çš„../çš„ç›¸å¯¹è·¯å¾„ï¼Œå…¶å®æ˜¯ä»¥wasmæ–‡ä»¶è€Œè¨€çš„ç›¸å¯¹è·¯å¾„ï¼Œè¿™é‡Œä¸€å®šè¦æ³¨æ„å‘€ï¼ JSè°ƒç”¨Rustçš„struct ç°åœ¨ï¼Œæ¥ç‚¹ç‚¸è£‚çš„ï¼ŒJSè°ƒç”¨Rustçš„structï¼Ÿï¼\nJSä¸­è¿structéƒ½æ²¡æœ‰ï¼Œè¿™ç©æ„å„¿å¯¼å‡ºæ¥ä¼šæ˜¯ä»€ä¹ˆæ ·ï¼Œå¾—æ€ä¹ˆåœ¨JSä¸­è°ƒç”¨å‘¢ï¼Ÿï¼\né¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªstructï¼Œå¹¶ä¸”å£°æ˜å‡ ä¸ªæ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #[wasm_bindgen] pub struct User { name: String, age: u32 } #[wasm_bindgen] impl User { #[wasm_bindgen(constructor)] pub fn new(name: String, age: u32) -\u0026gt; User { User { name, age } } pub fn print_user(\u0026amp;self) { log(format!(\u0026#34;name is : {}, age is : {}\u0026#34;, self.name, self.age).as_str()); } pub fn set_age(\u0026amp;mut self, age: u32) { self.age = age; } } æ­¤å¤„ï¼Œå£°æ˜äº†ä¸€ä¸ªstructåä¸ºUserï¼ŒåŒ…å«nameå’Œageä¸¤ä¸ªå­—æ®µï¼Œå¹¶å£°æ˜äº†newã€print_userå’Œset_ageæ–¹æ³•ã€‚\nå…¶ä¸­è¿˜æœ‰ä¸€ä¸ªæœªè§è¿‡çš„#[wasm_bindgen(constructor)]ï¼Œconstructorç”¨äºæŒ‡ç¤ºè¢«ç»‘å®šçš„å‡½æ•°å®é™…ä¸Šåº”è¯¥è½¬æ¢ä¸ºè°ƒç”¨ JavaScript ä¸­çš„ new è¿ç®—ç¬¦ã€‚æˆ–è®¸ä½ è¿˜ä¸å¤ªæ¸…æ™°ï¼Œç»§ç»­çœ‹ä¸‹å»ï¼Œä½ å°±ä¼šæ˜ç™½äº†ã€‚\næ¥ç€ï¼Œåœ¨JSä¸­è°ƒç”¨è¿™ä¸ªstructï¼Œå’Œå…¶æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; function addIt2(m, n) { return m + n; }; import init, { User } from \u0026#39;./pkg/hello_wasm.js\u0026#39;; const run = async () =\u0026gt; { await init(); const user = new User(\u0026#39;kuari\u0026#39;, 20); user.set_age(21); user.print_user(); } run(); \u0026lt;/script\u0026gt; å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„ç”¨æ³•å°±å¾ˆç†Ÿæ‚‰äº†ï¼\nå¤§æ¦‚æƒ³ä¸€ä¸‹ï¼Œåœ¨Rustä¸­è¦å¦‚ä½•è°ƒç”¨ï¼Ÿä¹Ÿå°±æ˜¯ç›´æ¥newä¸€ä¸ªâ€”â€”User::new('kuari', 20)ã€‚\næ­¤å¤„åœ¨JSä¸­ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå…ˆnewä¸€ä¸ªï¼\nç„¶åå¾ˆè‡ªç„¶åœ°è°ƒç”¨structçš„æ–¹æ³•ã€‚\nç¼–è¯‘åï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°è¾“å‡ºï¼šname is : kuari, age is : 21ã€‚\nå…¶å®ï¼Œæˆ–è®¸å¤§å®¶ä¼šå¾ˆå¥½å¥‡ï¼Œèµ·ç æˆ‘æ˜¯éå¸¸å¥½å¥‡çš„ï¼ŒRustçš„structåœ¨JSä¸­åˆ°åº•æ˜¯ä¸€ä¸ªæ€æ ·çš„å­˜åœ¨å‘¢ï¼Ÿ\nè¿™é‡Œç›´æ¥æ·»åŠ ä¸€ä¸ªconsole.log(user)ï¼Œå°±å¯ä»¥åœ¨è¾“å‡ºçœ‹åˆ°ã€‚é‚£ä¹ˆåˆ°åº•åœ¨JSä¸­æ˜¯ä¸€ä¸ªæ€æ ·çš„å­˜åœ¨å‘¢ï¼Ÿè¯·å„ä½åŠ¨æ‰‹æ‰“å°ä¸€ä¸‹çœ‹çœ‹å§ï¼:P\næ€»ç»“ æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œä¸»è¦è®²è¿°äº†Rustä¸JSçš„äº¤äº’ï¼Œä½“ç°åœ¨Rustä¸JSçš„ç›¸äº’è°ƒç”¨ï¼Œè¿™æ˜¯å»ºç«‹åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ç±»å‹è½¬æ¢çš„åŸºç¡€ä¸Šçš„ã€‚\nRustä¸JSçš„å‡½æ•°ç›¸äº’è°ƒç”¨çš„å­¦ä¹ æˆæœ¬è¿˜æ˜¯è¾ƒå¤§çš„ï¼Œè€Œä¸”å¯¹æ¯”Goå†™wasmï¼ŒRustçš„é¢—ç²’åº¦æ˜¯éå¸¸ç»†çš„ï¼Œå‡ ä¹å¯ä»¥è¯´æ˜¯éšå¿ƒæ‰€æ¬²äº†ã€‚\næ¯”è¾ƒç‚¸è£‚çš„å°±æ˜¯Rustçš„structå¯¼å‡ºç»™JSç”¨ï¼Œè¿™å¯¹äºRustä¸JSçš„äº¤äº’è€Œè¨€ï¼Œè¿˜æ˜¯éå¸¸æ£’çš„ä½“éªŒã€‚\n","date":"2023-06-27T00:11:12Z","image":"https://hunterji.com/zh-cn/posts/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E4%B8%89rust%E4%B8%8Ejs%E4%BA%A4%E4%BA%92/cover_hu6437590238652352065.jpg","permalink":"https://hunterji.com/zh-cn/posts/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E4%B8%89rust%E4%B8%8Ejs%E4%BA%A4%E4%BA%92/","title":"ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(ä¸‰)â€”â€”Rustä¸JSäº¤äº’"},{"content":"å‰è¨€ åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ã€Šä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(ä¸€)â€”â€”å¿«é€Ÿå¼€å§‹ã€‹ä¸­ï¼Œæè¿°äº†å¦‚ä½•åˆ›å»ºé¡¹ç›®å’Œå¿«é€Ÿç”Ÿæˆwasmå¹¶åœ¨å‰ç«¯ä¸­ä½¿ç”¨ï¼Œè¿ˆå‡ºäº†æ•´èŠ±æ´»å„¿çš„ç¬¬ä¸€æ­¥ã€‚\nåœ¨å¼€å‘ Web åº”ç”¨ç¨‹åºæ—¶ï¼Œä½¿ç”¨ Rust ç¼–å†™çš„ Wasm æ¨¡å—å¯ä»¥æä¾›æ›´é«˜çš„æ€§èƒ½å’Œæ›´å¥½çš„å®‰å…¨æ€§ã€‚ä½†æ˜¯ï¼Œä¸ºäº†ä¸ç°æœ‰çš„ JavaScript ä»£ç é›†æˆï¼Œå¿…é¡»å®ç° Rust ä¸ JS ä¹‹é—´çš„äº¤äº’ã€‚Rust ä¸ JS äº¤äº’çš„ä¸»è¦ç›®çš„æ˜¯å°†ä¸¤ç§è¯­è¨€çš„ä¼˜åŠ¿ç»“åˆèµ·æ¥ï¼Œä»¥å®ç°æ›´å¥½çš„ Web åº”ç”¨ç¨‹åºã€‚\næœ¬ç¯‡æ–‡ç« ä¸­ï¼Œå°†åŸºäºä¸Šä¸€ç¯‡æ–‡ç« ä¸­åˆ›å»ºçš„é¡¹ç›®æ¥ç»§ç»­å¼€å‘ã€‚\næºç ï¼šgithub.com/Kuari/hello-wasm\nç¯å¢ƒ Rust 1.70.0 wasm-bindgen 0.2.87 web-sys 0.3.64 DOM é…ç½®ä¾èµ– è¦æ“ä½œDOMï¼Œéœ€è¦å¼•å…¥æ–°çš„ä¾èµ–web-sysï¼Œå› æ­¤ï¼Œå¯ä»¥é…ç½®Cargo.tomlä¸­ä¾èµ–å¦‚ä¸‹ï¼š\n1 2 3 [dependencies] wasm-bindgen = \u0026#34;0.2.87\u0026#34; web-sys = { version = \u0026#34;0.3.64\u0026#34;, features = [] } ä½ æˆ–è®¸ä¼šå¥½å¥‡ï¼Œè¿™ä¸ªfeaturesæ˜¯ä»€ä¹ˆï¼Œè®²çœŸï¼Œæˆ‘ä¸€å¼€å§‹å¾ˆå¥½å¥‡ï¼Œåˆæ²¡çœ‹åˆ°ä»€ä¹ˆç‰¹åˆ«çš„è¯´æ˜ï¼Œè¯•é”™æ‰å‘ç°ï¼ŒåŸæ¥æ˜¯è¦æ‰‹åŠ¨å¼•å…¥åŠŸèƒ½ä¾èµ–\u0026hellip;æ¯”å¦‚è¯´ï¼Œå½“ä½ éœ€è¦åœ¨Rustä¸­ä½¿ç”¨JSçš„consoleï¼Œé‚£ä¹ˆä½ éœ€è¦åœ¨featuresä¸­åŠ å…¥consoleã€‚\nè·å–Document åœ¨Rustä¸­ä½¿ç”¨Documentï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§ä¸Šä¸€æ­¥çš„è¯´æ˜ï¼Œæ·»åŠ featuresã€‚é‚£ä¹ˆè¿™é‡Œæœ‰ä¸€ä¸ªä¾èµ–å…³ç³»ï¼Œé¦–å…ˆåœ¨Rustä¸­è·å–windowï¼Œç„¶åå†è·å–documentã€‚\nå› æ­¤ï¼Œæ·»åŠ featuresåå¦‚ä¸‹ï¼š\n1 2 3 [dependencies] wasm-bindgen = \u0026#34;0.2.87\u0026#34; web-sys = { version = \u0026#34;0.3.64\u0026#34;, features = [\u0026#34;Window\u0026#34;, \u0026#34;Document\u0026#34;] } ç„¶ååœ¨lib.rsä¸­åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥è°ƒç”¨documentï¼š\n1 2 3 4 5 #[wasm_bindgen] pub fn update_message() { let window = web_sys::window().expect(\u0026#34;Failed to load window\u0026#34;); let document = window.document().expect(\u0026#34;Failed to load document\u0026#34;); } é‚£ä¹ˆï¼Œç°åœ¨å°±æ˜¯åœ¨Rustä¸­è§£é”äº†documentï¼Œå°±å¯ä»¥åœ¨å‰ç«¯ä¸ºæ‰€æ¬²ä¸ºäº†ï¼\næ“ä½œElement é‚£ä¹ˆå¼€å§‹æ“ä½œä¸€æ³¢ï¼Œé¦–å…ˆå¾—è·å–åˆ°Element\u0026hellip;\u0026hellip;\næ˜¯çš„ï¼Œä½ æ²¡æœ‰æƒ³é”™ï¼Œç»§ç»­æ¥æ·»åŠ featureså§ï¼Œæ­¤å¤„è¦æ·»åŠ ä¸€ä¸ªElementï¼š\n1 2 3 [dependencies] wasm-bindgen = \u0026#34;0.2.87\u0026#34; web-sys = { version = \u0026#34;0.3.64\u0026#34;, features = [\u0026#34;Window\u0026#34;, \u0026#34;Document\u0026#34;, \u0026#34;Element\u0026#34;] } okï¼Œé‚£ä¹ˆç»§ç»­ã€‚æ­¤å¤„è®¾å®šå‡½æ•°ä¼ å…¥ä¸¤ä¸ªå‚æ•°selectorå’Œmessageï¼Œç„¶åé€šè¿‡selectorè·å–elementï¼Œæ›´æ–°å€¼ä¸ºmessageå‚æ•°çš„å€¼ã€‚å®Œæ•´å‡½æ•°å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 #[wasm_bindgen] pub fn update_message(selector: \u0026amp;str, message: \u0026amp;str) { let window = web_sys::window().expect(\u0026#34;Failed to load window\u0026#34;); let document = window.document().expect(\u0026#34;Failed to load document\u0026#34;); let element = document.query_selector(selector).expect(\u0026#34;Failed to load element\u0026#34;); if let Some(element) = element { element.set_inner_html(message); } else { panic!(\u0026#34;Failed to set inner html\u0026#34;) } } ç¼–è¯‘ å°†å†™å®Œçš„Rusté¡¹ç›®ç¼–è¯‘æˆwasmï¼š\n1 wasm-pack build --target web åœ¨htmlä¸­è°ƒç”¨ åŸºäºä¸Šä¸€ç¯‡æ–‡ç« çš„é¡¹ç›®ä¸­çš„htmlï¼Œæ­¤å¤„æ·»åŠ ä¸€ä¸ªdivï¼Œidä¸ºmessageï¼Œæ·»åŠ è°ƒç”¨wasmçš„update_messageå‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;message\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; import init, { update_message } from \u0026#39;./pkg/hello_wasm.js\u0026#39;; // å¼•å…¥update_messageå‡½æ•° const run = async () =\u0026gt; { await init(); update_message(\u0026#39;#message\u0026#39;, \u0026#39;\u0026lt;h1\u0026gt;Hello, Rust!\u0026lt;/h1\u0026gt;\u0026#39;); // è°ƒç”¨update_messageå‡½æ•° } run(); \u0026lt;/script\u0026gt; åœ¨æµè§ˆå™¨éªŒè¯ å¯åŠ¨ä¸€ä¸ªhttp serverï¼Œç„¶ååœ¨æµè§ˆå™¨æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°åœ¨é¡µé¢ä¸Šå‡ºç°ä¸€ä¸ªh1æ ‡ç­¾çš„Hello, Rust!ã€‚\nå‘ç°æ›´å¤šæ–¹æ³• æŒ‰ç…§æ–‡ç« æ¥å†™çš„è¿‡ç¨‹ä¸­ï¼Œä½ åº”è¯¥ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜â€”â€”æ€ä¹ˆè¿™äº›æ–¹æ³•æ²¡æœ‰è¡¥å…¨ï¼Ÿï¼\næ˜¯çš„ï¼Œæ²¡é”™çš„ï¼Œï¼ˆè‡³å°‘æˆ‘å‘ç°ï¼‰å½“å‰web-syså¹¶æ²¡æœ‰è¡¥å…¨ï¼Œæ‰€ä»¥åªèƒ½ç»“åˆå¼€å‘è€…ä¼˜ç§€çš„å‰ç«¯æŠ€èƒ½å’Œä¸°å¯Œçš„å®˜æ–¹æ–‡æ¡£æ¥å¼€å‘äº†ã€‚\nRustä¸JSçš„ç±»å‹ç›¸äº’è½¬æ¢ å¯¹äºwasmè€Œè¨€ï¼Œæ€§èƒ½å›ºç„¶æ˜¯æå‡çš„ï¼Œä½†æ˜¯ç±»å‹è½¬æ¢ä¸€ç›´æ˜¯ä¸ªé—®é¢˜ã€‚å½“å¤§é‡æ•°æ®éœ€è¦åœ¨wasm/jsä¸­è¿›è¡Œç±»å‹è½¬æ¢æ—¶ï¼Œè¿™å¯¹æ€§èƒ½æ¥è¯´ï¼ŒçœŸçš„æ˜¯ä¸ªç¾éš¾ã€‚ä¹‹å‰åœ¨ä½¿ç”¨goå¼€å‘wasmæ—¶ï¼Œå°±é‡åˆ°è¿‡è¿™æ ·çš„é—®é¢˜ï¼Œéœ€è¦ç”¨å®˜æ–¹çš„æ–¹æ³•æ¥è¿›è¡Œæ‰‹åŠ¨ç±»å‹è½¬æ¢ï¼Œç„¶è€Œwasmå¤„ç†çš„æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®é‡\u0026hellip;\u0026hellip;\nä¸è¿‡å¥½åœ¨Rustçš„ç±»å‹æ”¯æŒçœŸçš„æŒºä¸°å¯Œçš„ï¼\nåŸºç¡€ç±»å‹ åŸºç¡€ç±»å‹æŒºç®€å•çš„ï¼Œè€Œä¸”Rustçš„èŒƒæ€§ä¹Ÿå¾ˆå¥½åœ°æ”¯æŒäº†å¾ˆå¤šç±»å‹ã€‚å¦‚ä¸‹æ˜¯åŸºç¡€ç±»å‹æ˜ å°„è¡¨ï¼š\nRustç±»å‹ JavaScriptç±»å‹ i8 number i16 number i32 number i64 BigInt u8 number u16 number u32 number u64 BigInt f32 number f64 number bool boolean char string \u0026amp;str string String string \u0026amp;[T] ä¾‹å¦‚ï¼š\u0026amp;[u8] [T] ä¾‹å¦‚ï¼šUint8Array Vec Array åŸºç¡€ç±»å‹è½¬æ¢ç¤ºä¾‹ åœ¨lib.rsæ–‡ä»¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼ŒæŒ‘é€‰å‡ ä¸ªç±»å‹ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œç„¶åå°†å…¶è¯»å–å¹¶æ‰“å°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 #[wasm_bindgen] pub fn print_values(js_number: i32, js_boolean: bool, js_uint8_array: \u0026amp;[u8], js_number_array: Vec\u0026lt;i32\u0026gt;) { println!(\u0026#34;js number: {}\u0026#34;, js_number); println!(\u0026#34;js boolean: {}\u0026#34;, js_boolean); for item in js_uint8_array { println!(\u0026#34;js Uint8Array item: {}\u0026#34;, item); } for item in js_number_array { println!(\u0026#34;js number array item: {}\u0026#34;, item); } } å¯ä»¥çœ‹åˆ°è¯¥å‡½æ•°ä¼ å…¥äº†JSçš„numberã€booleanã€Uint8Arrayå’ŒArrayå››ä¸ªç±»å‹çš„å‚æ•°ã€‚\nç„¶åç¼–è¯‘ï¼š\n1 wasm-pack build --target web æ¥ç€ï¼Œåœ¨å‰ç«¯ä¸­å¼•å…¥å‡½æ•°å¹¶è°ƒç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; import init, { print_values } from \u0026#39;./pkg/hello_wasm.js\u0026#39;; const run = async () =\u0026gt; { await init(); const jsNumber = 10; const jsBoolean = true; const jsUint8Array = new Uint8Array(3); jsUint8Array[0] = 1; jsUint8Array[1] = 2; jsUint8Array[2] = 3; const jsNumberArray = [30, 40, 50]; print_values(jsNumber, jsBoolean, jsUint8Array, jsNumberArray); } run(); \u0026lt;/script\u0026gt; æœ€åï¼Œå¯åŠ¨http serverå¹¶æ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°\u0026hellip;çœ‹ä¸åˆ°ï¼Ÿï¼\næ˜¯çš„ï¼Œæ²¡é”™ï¼ŒRustçš„println!åªä¼šå°†æ‰“å°çš„å†…å®¹å‘é€åˆ°Rustçš„æ ‡å‡†è¾“å‡ºæµï¼Œè€Œä¸æ˜¯å‰ç«¯çš„æ§åˆ¶å°ã€‚å¦‚æœæƒ³åœ¨æ§åˆ¶å°ä¸­æ‰“å°ï¼Œé‚£ä¹ˆéœ€è¦è°ƒç”¨JSçš„consoleäº†ã€‚\nä½¿ç”¨æ–°çš„åŠŸèƒ½ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯æ·»åŠ featuresï¼ŒCargo.tomlä¸­æ·»åŠ consoleå¦‚ä¸‹ï¼š\n1 2 3 [dependencies] wasm-bindgen = \u0026#34;0.2.87\u0026#34; web-sys = { version = \u0026#34;0.3.64\u0026#34;, features = [\u0026#34;Window\u0026#34;, \u0026#34;Document\u0026#34;, \u0026#34;Element\u0026#34;, \u0026#34;console\u0026#34;] } åœ¨Rustä¸­è°ƒç”¨console.log()å¦‚ä¸‹ï¼š\n1 web_sys::console::log_1(\u0026amp;\u0026#34;Hello, Rust!\u0026#34;.into()); æ­¤å¤„å°†å…¶å°è£…æˆä¸€ä¸ªå‡½æ•°ï¼š\n1 2 3 fn console_log(message: String) { web_sys::console::log_1(\u0026amp;message.into()); } ç„¶åï¼Œå°†ç¤ºä¾‹å‡½æ•°çš„printlnæ”¹æˆconsole_log()å’Œformat!ï¼Œå‡½æ•°ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 #[wasm_bindgen] pub fn print_values(js_number: i32, js_boolean: bool, js_uint8_array: \u0026amp;[u8], js_number_array: Vec\u0026lt;i32\u0026gt;) { console_log(format!(\u0026#34;js number: {}\u0026#34;, js_number)); console_log(format!(\u0026#34;js boolean: {}\u0026#34;, js_boolean)); for item in js_uint8_array { console_log(format!(\u0026#34;js Uint8Array item: {}\u0026#34;, item)); } for item in js_number_array { console_log(format!(\u0026#34;js number array item: {}\u0026#34;, item)); } } æœ€åï¼Œç¼–è¯‘ä¹‹åï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œå°±å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°è¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 js number: 10 js boolean: true js Uint8Array item: 1 js Uint8Array item: 2 js Uint8Array item: 3 js number array item: 30 js number array item: 40 js number array item: 50 é€šç”¨ç±»å‹ Rustä¸­æä¾›äº†ä¸€ä¸ªé€šç”¨çš„ç±»å‹â€”â€”JsValueï¼Œå¯ä»¥ä½œä¸ºä»»ä½•JSç±»å‹ã€‚\nè¿™é‡Œç»™ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹ï¼Œè®¾ç½®ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨JsValueä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œå¹¶æ‰“å°ã€‚\nåˆ›å»ºå‡½æ•°ï¼š\n1 2 3 4 #[wasm_bindgen] pub fn print_js_value(val: JsValue) { console_log(format!(\u0026#34;{:?}\u0026#34;, val)); } ç„¶åç¼–è¯‘æˆwasmæ–‡ä»¶ã€‚\nåœ¨htmlä¸­è°ƒç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; import init, { print_js_value } from \u0026#39;./pkg/hello_wasm.js\u0026#39;; const run = async () =\u0026gt; { await init(); const jsNumber = 10; const jsBoolean = true; const jsUint8Array = new Uint8Array(3); jsUint8Array[0] = 1; jsUint8Array[1] = 2; jsUint8Array[2] = 3; const jsNumberArray = [30, 40, 50]; print_js_value(jsNumber); print_js_value(jsBoolean); print_js_value(jsUint8Array); print_js_value(jsNumberArray); } run(); \u0026lt;/script\u0026gt; åœ¨htmlä¸­ï¼Œä¼ å…¥äº†ä¸åŒç±»å‹çš„å‚æ•°ï¼Œä½†æ˜¯åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå°†æ‰€æœ‰ä¸åŒç±»å‹çš„å‚æ•°éƒ½æ‰“å°å‡ºæ¥äº†ï¼š\n1 2 3 4 JsValue(10) JsValue(true) JsValue(Uint8Array) JsValue([30, 40, 50]) Result Resultåœ¨Rustä¸­æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å­˜åœ¨ï¼Œç»å¸¸å†™Rustçš„è¯ï¼Œä¹Ÿä¸æƒ³åœ¨å†™WebAssemblyæ—¶æ”¹å˜å¼€å‘ä¹ æƒ¯ã€‚\nå…¶å®å¯¹äºJSè€Œè¨€ï¼ŒResultå¯ä»¥ç›´æ¥åœ¨catchä¸­æ•è·åˆ°ï¼Œåªæ˜¯è¯´ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å®šä¹‰å¥½å‚æ•°ç±»å‹ã€‚\n1 ä½¿ç”¨Resultè¿”å›æŠ¥é”™ é¦–å…ˆæ¥ä¸€ä¸ªåªè¿”å›æŠ¥é”™çš„åœºæ™¯ï¼š\n1 2 3 4 5 6 7 8 #[wasm_bindgen] pub fn only_return_error_when_result(count: i32) -\u0026gt; Result\u0026lt;(), JsError\u0026gt; { if count \u0026gt; 10 { Ok(()) } else { Err(JsError::new(\u0026#34;count \u0026lt; 10\u0026#34;)) } } è¿™é‡Œè¿”å›ç±»å‹æ˜¯Resultï¼Œä½†æ˜¯ä»…ä»…è¿”å›äº†ä¸€ä¸ªé”™è¯¯ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„æŠ¥é”™ä½¿ç”¨çš„ç±»å‹æ˜¯JsErrorï¼Œå½“ç„¶ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨JsValueã€‚\nç„¶ååœ¨htmlè°ƒç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; import init, { only_return_error_when_result } from \u0026#39;./pkg/hello_wasm.js\u0026#39;; const run = async () =\u0026gt; { await init(); try { only_return_error_when_result(1); console.log(\u0026#39;1 is ok\u0026#39;); } catch(error) { console.log(\u0026#39;An error is reported when the input parameter is 1: \u0026#39;, error); } try { only_return_error_when_result(100); console.log(\u0026#39;100 is ok\u0026#39;); } catch(error) { console.log(\u0026#39;An error is reported when the input parameter is 100: \u0026#39;, error); } } run(); \u0026lt;/script\u0026gt; è¿™é‡Œè°ƒç”¨äº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡åº”å½“æ˜¯é”™è¯¯çš„ï¼Œç¬¬äºŒæ¬¡åº”è¯¥æ˜¯æ­£ç¡®çš„ï¼Œå¹¶ä¸”éƒ½ä½¿ç”¨äº†catchæ¥æ•è·é”™è¯¯ã€‚\né‚£ä¹ˆï¼Œåœ¨æµè§ˆå™¨çš„æ§åˆ¶å°å¯ä»¥çœ‹åˆ°è¾“å‡ºï¼š\n1 2 An error is reported when the input parameter is 1: Error: count \u0026lt; 10 100 is ok 2 ä½¿ç”¨Resultè¿”å›æ­£å¸¸å€¼å’Œé”™è¯¯ é‚£ä¹ˆï¼Œå¦‚æœæƒ³æ—¢è¿”å›æ­£å¸¸å€¼ï¼Œä¹Ÿæƒ³è¿”å›é”™è¯¯å‘¢ï¼ŸRustè¿”å›ä¸€ä¸ªResultæ˜¯æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆJSæ€ä¹ˆè§£æå‘¢ï¼Ÿ\nç›´æ¥ä¸ŠRustä»£ç ï¼š\n1 2 3 4 5 6 7 8 #[wasm_bindgen] pub fn return_all_when_result(count: i32) -\u0026gt; Result\u0026lt;i32, JsError\u0026gt; { if count \u0026gt; 10 { Ok(count + 10) } else { Err(JsError::new(\u0026#34;count \u0026lt; 10\u0026#34;)) } } è¯¥å‡½æ•°ï¼Œè·å–åˆ°å‚æ•°åï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶ï¼ŒåŠ 10åè¿”å›ï¼Œå¦åˆ™æŠ¥é”™ã€‚\né‚£ä¹ˆçœ‹çœ‹htmlä¸­å¦‚ä½•è°ƒç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; import init, { return_all_when_result } from \u0026#39;./pkg/hello_wasm.js\u0026#39;; const run = async () =\u0026gt; { await init(); try { const res = return_all_when_result(1); console.log(`get ${res}`); } catch(error) { console.log(\u0026#39;An error is reported when the input parameter is 1: \u0026#39;, error); } try { const res = return_all_when_result(100); console.log(`get ${res}`); } catch(error) { console.log(\u0026#39;An error is reported when the input parameter is 100: \u0026#39;, error); } } run(); \u0026lt;/script\u0026gt; æ˜¯çš„ï¼Œæ²¡é”™ï¼Œæ­£å¸¸è·å–å°±è¡Œäº†\u0026hellip;\u0026hellip;/æ‚è„¸å“­\nè¿™é‡Œçš„è°ƒç”¨ï¼Œä¾ç„¶æ˜¯ï¼Œç¬¬ä¸€ä¸ªæ˜¯é”™è¯¯çš„ï¼Œç¬¬äºŒä¸ªæ˜¯æ­£ç¡®è¿”å›å€¼çš„ï¼Œå¹¶ä¸”éƒ½ä½¿ç”¨äº†catchæ¥æ•è·é”™è¯¯ã€‚\næœ€åï¼Œå°±æ˜¯åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­çœ‹åˆ°ï¼š\n1 2 An error is reported when the input parameter is 1: Error: count \u0026lt; 10 get 110 ç›´æ¥å¼•å…¥JSç±»å‹ å¦‚æœä½ æƒ³æ›´ç›´æ¥ä¸€ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å¼•å…¥JSç±»å‹ï¼è¿™é‡Œä¸»è¦æ˜¯åˆ©ç”¨js-sysè¿™ä¸ªä¾èµ–ï¼Œå¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸Šçœ‹åˆ°å¾ˆå¤šJSçš„ç±»å‹å’Œå‡½æ•°ï¼Œç›´æ¥å¼•å…¥å³å¯ä½¿ç”¨ã€‚å½“ç„¶ï¼Œä¸€å®šåœºæ™¯ä¸‹ï¼Œç›´æ¥å¼•å…¥çš„ç±»å‹ï¼Œæ˜¯éœ€è¦æ‰‹åŠ¨è½¬æ¢ç±»å‹çš„ã€‚\n1 é…ç½®ä¾èµ– åœ¨Cargo.tomlä¸­æ·»åŠ js-sysä¾èµ–ï¼š\n1 2 3 4 [dependencies] wasm-bindgen = \u0026#34;0.2.87\u0026#34; web-sys = { version = \u0026#34;0.3.64\u0026#34;, features = [\u0026#34;Window\u0026#34;, \u0026#34;Document\u0026#34;, \u0026#34;Element\u0026#34;, \u0026#34;console\u0026#34;] } js-sys = \u0026#34;0.3.61\u0026#34; 2 Uint8Array é¦–å…ˆä»¥Uint8Arrayä¸¾ä¾‹ï¼Œåœ¨lib.rså¤´éƒ¨å¼•å…¥ç±»å‹ï¼š\n1 use js_sys::Uint8Array; ç„¶ååˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°å’Œè¿”å›éƒ½æ˜¯Uint8Arrayç±»å‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #[wasm_bindgen] pub fn print_uint8_array(js_arr: Uint8Array) -\u0026gt; Uint8Array { // new Uint8Array let mut arr = Uint8Array::new_with_length(3); // Uint8Array -\u0026gt; vec for (index, item) in js_arr.to_vec().iter().enumerate() { console_log(format!(\u0026#34;{} - the item in js_arr: {}\u0026#34;, index, item)); } // Avoid type conversion // Use the method of the type itself for index in 0..js_arr.length() { console_log(format!(\u0026#34;{} - the item in js_arr: {}\u0026#34;, index, js_arr.get_index(index))); } // vec -\u0026gt; Uint8Array let vec = vec![1, 2, 3]; let arr2 = Uint8Array::from(vec.as_slice()); arr = arr2.clone(); // Use the method of the type itself arr.set_index(0, 100); arr } å¿½ç•¥è¯¥å‡½æ•°ä¸­æ— æ„ä¹‰çš„é€»è¾‘å’Œarrå˜é‡çš„è­¦å‘Šï¼Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºç”¨æ³•ã€‚\nå¯ä»¥åœ¨ä»£ç ä¸­çœ‹åˆ°ï¼Œç›´æ¥å¼•å…¥çš„Uint8Arrayæœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œä¸€å®šåœºæ™¯ä¸‹ï¼Œéœ€è¦è½¬æ¢ç±»å‹ï¼Œä½†æ˜¯æœ€å¥½é¿å…è¿›è¡Œç±»å‹è½¬æ¢ï¼Œè€Œç›´æ¥ä½¿ç”¨å…¶è‡ªå¸¦çš„æ–¹æ³•ã€‚\nè¿™é‡Œå¯ä»¥ç®€è¦æ€»ç»“ä¸‹ï¼Œå°±æ˜¯æœ€å¥½ä¸€å®šåœºæ™¯å†…å…¨éƒ¨ä½¿ç”¨ç›´æ¥å¼•å…¥çš„JSç±»å‹ï¼Œæˆ–è€…ç›´æ¥å…¨éƒ¨ä½¿ç”¨Rustç±»å‹æ¥ä»£æ›¿JSç±»å‹ï¼Œä¸¤è€…éƒ½å­˜åœ¨åœºæ™¯ä¸‹ï¼Œæ‰‹åŠ¨è½¬æ¢ç±»å‹æ˜¯ä»¶å¾ˆç³Ÿç³•çš„äº‹ã€‚\n3 Date Dateç±»å‹ï¼Œåœ¨ä¸Šé¢çš„ç¯‡ç« ä¸­éƒ½æ²¡æœ‰æåŠï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥å¼•å…¥JSçš„Dateç±»å‹æ¥ä½¿ç”¨ã€‚\né¦–å…ˆæ˜¯å¼•å…¥ç±»å‹ï¼š\n1 use js_sys::Date; ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›æ—¶é—´æˆ³ï¼š\n1 2 3 4 5 #[wasm_bindgen] pub fn return_time() -\u0026gt; f64 { let date = Date::new_0(); date.get_time() } æ¥ç€ï¼Œåœ¨htmlä¸­è°ƒç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; import init, { return_time } from \u0026#39;./pkg/hello_wasm.js\u0026#39;; const run = async () =\u0026gt; { await init(); console.log(\u0026#39;current time: \u0026#39;, return_time()); } run(); \u0026lt;/script\u0026gt; æœ€åï¼Œåœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼š\n1 current time: 1686979932833 æ€»ç»“ æœ¬æ–‡ä¸­ï¼Œä¸»è¦è®²è¿°äº†å¦‚ä½•ä½¿ç”¨Rustæ¥å®ç°DOMæ“ä½œï¼Œè¯»è€…å¯ä»¥æ ¹æ®æ–¹æ³•è‡ªå·±å»æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ï¼Œæ¥å®ç°è‡ªå·±çš„åœºæ™¯ã€‚å…¶æ¬¡ï¼Œè¿˜è®²è¿°äº†Rustä¸JSçš„ç±»å‹è½¬æ¢ï¼Œä»åŸºç¡€çš„å„è‡ªç±»å‹çš„æ˜ å°„ï¼Œåˆ°Rustç‹¬æœ‰çš„Resultï¼Œåˆ°ç›´æ¥å¼•å…¥JSç±»å‹ã€‚å½“ç„¶è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›´æ¥å¼•å…¥JSç±»å‹å’ŒRustçš„åŸºç¡€ç±»å‹æ˜ å°„JSç±»å‹è¿™ä¸¤ç§æ–¹æ³•å°½é‡ä¸è¦æ··ç”¨ï¼Œæ··ç”¨ä¼šå¯¼è‡´éœ€è¦æ‰‹åŠ¨ç±»å‹è½¬æ¢ï¼Œé€ æˆæ€§èƒ½æŸè€—ã€‚\nè‡³æ­¤ï¼Œåˆå‘Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿è¿ˆè¿›äº†ä¸€æ­¥~ğŸ˜¼\n","date":"2023-06-18T18:18:31Z","image":"https://hunterji.com/zh-cn/posts/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E4%BA%8Cdom%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/cover_hu6437590238652352065.jpg","permalink":"https://hunterji.com/zh-cn/posts/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E4%BA%8Cdom%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/","title":"ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(äºŒ)â€”â€”DOMå’Œç±»å‹è½¬æ¢"},{"content":"å‰è¨€ WebAssembly æ˜¯ä¸€ç§æ–°çš„ç¼–ç æ–¹å¼ï¼Œå¯ä»¥åœ¨ç°ä»£çš„ç½‘ç»œæµè§ˆå™¨ä¸­è¿è¡Œ ï¼ å®ƒæ˜¯ä¸€ç§ä½çº§çš„ç±»æ±‡ç¼–è¯­è¨€ï¼Œå…·æœ‰ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¯ä»¥æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½è¿è¡Œï¼Œå¹¶ä¸ºè¯¸å¦‚ C / C ++ç­‰è¯­è¨€æä¾›ä¸€ä¸ªç¼–è¯‘ç›®æ ‡ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥åœ¨ Web ä¸Šè¿è¡Œã€‚å®ƒä¹Ÿè¢«è®¾è®¡ä¸ºå¯ä»¥ä¸ JavaScript å…±å­˜ï¼Œå…è®¸ä¸¤è€…ä¸€èµ·å·¥ä½œã€‚\nä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼Œæ˜¯å…³äºå¦‚ä½•ä½¿ç”¨golangæ¥å¼€å‘WebAssemblyçš„â€”â€”WebAssemblyï¼šæœªæ¥å‰ç«¯å¼€å‘çš„å¿…å¤‡æŠ€èƒ½ã€‚\nRustå’ŒGoéƒ½å¯ä»¥ç”¨æ¥å¼€å‘WebAssemblyï¼Œä½†å®ƒä»¬æœ‰å„è‡ªçš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚\nRustçš„ä¼˜ç‚¹ï¼š\næ›´å¿«çš„æ€§èƒ½å’Œæ›´å°çš„äºŒè¿›åˆ¶æ–‡ä»¶ æ›´å¥½çš„å†…å­˜å®‰å…¨æ€§ Goçš„ä¼˜ç‚¹ï¼š\næ›´å®¹æ˜“ä¸Šæ‰‹å’Œå­¦ä¹  æ›´å¥½çš„ç”Ÿæ€ç³»ç»Ÿå’Œç¤¾åŒºæ”¯æŒ ç»¼åˆæ¥è¯´ï¼Œå¦‚æœä½ æ›´æ³¨é‡æ€§èƒ½å’Œå†…å­˜å®‰å…¨æ€§ï¼Œé‚£ä¹ˆRustå¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚è€Œå¦‚æœä½ æ›´æ³¨é‡å¼€å‘æ•ˆç‡å’Œæ˜“ç”¨æ€§ï¼Œé‚£ä¹ˆGoå¯èƒ½æ›´é€‚åˆä½ ã€‚å½“ç„¶ï¼Œå®é™…æƒ…å†µè¿˜éœ€è¦æ ¹æ®å…·ä½“çš„é¡¹ç›®éœ€æ±‚å’Œå›¢é˜Ÿæƒ…å†µæ¥é€‰æ‹©ã€‚\nå› ä¸ºä¸€äº›å·¥ä½œéœ€æ±‚ï¼Œæœ€è¿‘æ•´äº†äº›rustçš„èŠ±æ´»å„¿ï¼Œè¿™é‡Œç³»ç»Ÿåœ°è®°å½•ä¸€ä¸‹ã€‚å½“ä½ é‡åˆ°æ›´æ³¨é‡æ€§èƒ½å’Œå†…å­˜å®‰å…¨æ€§çš„åœºæ™¯ï¼Œå¸Œæœ›è¿™èƒ½æœ‰å¸®åŠ©ã€‚\nç¯å¢ƒ Rust 1.70.0 wasm-bindgen 0.2.87 åˆ›å»ºé¡¹ç›®å¹¶æ·»åŠ ä¾èµ– æ­¤å¤„é»˜è®¤å·²ç»å®‰è£…Rustï¼Œéœ€è¦å®‰è£…çš„å°ä¼™ä¼´å„¿å¯ä»¥å‚è€ƒå®˜ç½‘ã€‚\nä½¿ç”¨Cargoåˆ›å»ºä¸€ä¸ªåä¸ºhello-wasmçš„é¡¹ç›®ï¼š\n1 cargo new --lib hello-wasm è¿›å…¥é¡¹ç›®ï¼Œæ‰“å¼€æ–‡ä»¶Cargo.tomlï¼Œæ·»åŠ ä¾èµ–ï¼š\n1 2 3 4 5 [lib] crate-type = [\u0026#34;cdylib\u0026#34;] [dependencies] wasm-bindgen = \u0026#34;0.2.87\u0026#34; æ›´æ–°lib.rs é»˜è®¤åˆ›å»ºé¡¹ç›®ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªåä¸ºlib.rsçš„æ–‡ä»¶ï¼Œå°†å†…å®¹å…¨éƒ¨æ›¿æ¢æˆï¼š\n1 2 3 4 5 6 use wasm_bindgen::prelude::*; #[wasm_bindgen] pub fn add(a: i32, b: i32) -\u0026gt; i32 { a + b } ç¼–è¯‘ è‡³æ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæœ€ç®€å•çš„åŠŸèƒ½â€”â€”ä¸€ä¸ªè¿”å›ä¸¤ä¸ªæ•´æ•°ç›¸åŠ ç»“æœçš„å‡½æ•°ã€‚\nç„¶åæˆ‘ä»¬å¯ä»¥è¿›è¡Œç¼–è¯‘äº†ï¼Œç¼–è¯‘ä¹‹å‰éœ€è¦å®‰è£…ä¸€ä¸ªå·¥å…·wasm-packï¼š\n1 cargo install wasm-pack ç„¶åè¿›è¡Œç¼–è¯‘ï¼š\n1 wasm-pack build --target web ç¼–è¯‘å®Œæˆä¹‹åï¼Œå°†ä¼šå¤šå‡ºæ¥ä¸€ä¸ªpkgæ–‡ä»¶å¤¹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 pkg â”œâ”€â”€ hello_wasm.d.ts â”œâ”€â”€ hello_wasm.js â”œâ”€â”€ hello_wasm_bg.wasm â”œâ”€â”€ hello_wasm_bg.wasm.d.ts â””â”€â”€ package.json è™½ç„¶æ–‡ä»¶å¾ˆå¤šï¼Œä½†æ˜¯é¦–å…ˆæˆ‘ä»¬çœ‹åˆ°äº†æˆ‘ä»¬æ‰€éœ€è¦çš„wasmæ–‡ä»¶ï¼Œå¹¶ä¸”ï¼Œæ ¹æ®goçš„wasmå¼•å…¥æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬æˆ–è®¸ä¼šéœ€è¦ç”¨åˆ°jsæ–‡ä»¶ã€‚\nå‰ç«¯å¼•å…¥ ä¸ºäº†æ–¹ä¾¿æœ€å¿«æ ¡éªŒï¼Œç›´æ¥åœ¨hello-wasmé¡¹ç›®ä¸­åˆ›å»ºindex.htmlæ–‡ä»¶ï¼Œæ¥è¿›è¡Œå‰ç«¯å¼•å…¥ã€‚\nåˆ›å»ºindex.html é‚£ä¹ˆï¼Œé¦–å…ˆï¼Œåˆ›å»ºindex.htmlæ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; Hello, World! \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ˜¯çš„ï¼Œæ²¡é”™ï¼è¿™æ˜¯ä¸€åœºæ ‡å‡†çš„å¼€å±€ï¼ğŸ˜¼\nå¼•å…¥WASM å…¶å®ä¸åŒäºgoè¯­è¨€çš„wasmå¼•å…¥æ–¹å¼ï¼ŒRustæ›´å¸Œæœ›ç›´æ¥å¼•å…¥jsæ–‡ä»¶ï¼Œè€Œä¸æ˜¯è®©å¼€å‘è€…æ‰‹åŠ¨å¼•å…¥wasmæ–‡ä»¶ã€‚\nè¿™é‡Œä½¿ç”¨jså¼•å…¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; import init, { add } from \u0026#39;./pkg/hello_wasm.js\u0026#39;; const run = async () =\u0026gt; { await init(); const result = add(1, 2); console.log(`the result from rust is: ${result}`); } run(); \u0026lt;/script\u0026gt; å®Œæ•´ä»£ç  å®Œæ•´çš„htmlä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; Hello, World! \u0026lt;/body\u0026gt; \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; import init, { add } from \u0026#39;./pkg/hello_wasm.js\u0026#39;; const run = async () =\u0026gt; { await init(); const result = add(1, 2); console.log(`the result from rust is: ${result}`); } run(); \u0026lt;/script\u0026gt; \u0026lt;/html\u0026gt; éªŒè¯ è¿™é‡Œå¯ä»¥å¿«é€Ÿèµ·ä¸€ä¸ªhttp serverï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ä½¿ç”¨http-serverï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨python3 -m http.serverè¿™æ ·çš„æ–¹å¼ï¼Œçœ‹æ€ä¹ˆå„è‡ªçš„ä½¿ç”¨ä¹ æƒ¯ã€‚\né‚£ä¹ˆï¼Œå¯åŠ¨http serverï¼š\n1 http-server æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®http://localhost:8080ï¼Œæ‰“å¼€è°ƒè¯•å™¨ï¼Œå³å¯çœ‹åˆ°è¾“å‡ºthe result from rust is: 3ï¼Œè¿™å°±æ„å‘³ç€è¿ˆå‡ºäº†æ•´èŠ±æ´»å„¿çš„ç¬¬ä¸€æ­¥ï¼\nå¸¸è§é—®é¢˜ å‰ç«¯æŠ¥å“åº”ç±»å‹é”™è¯¯ è¯¦ç»†æŠ¥é”™å¦‚ä¸‹ï¼š\n1 Failed to load module script: The server responded with a non-JavaScript MIME type of \u0026#34;application/wasm\u0026#34;. Strict MIME type checking is enforced for module scripts per HTML spec. å½“å¼•å…¥WebAssemblyç”Ÿæˆçš„jsæ–‡ä»¶æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™ä¸ªæŠ¥é”™ã€‚æŠ¥é”™ä¹ä¸€çœ‹æ˜¯http serverçš„å“åº”é—®é¢˜ï¼Œæˆ–è€…æœç´¢æ—¶å€™ï¼Œä¹Ÿä¼šæœ‰å¸–å­è¯´è¿™æ˜¯ä¸€ä¸ªresponseé—®é¢˜ã€‚\nå®é™…ä¸Šï¼Œå½“æŒ‰ç…§è¿™ä¸ªæ–‡ç« ä¸€æ­¥æ­¥æ“ä½œæ—¶æ˜¯ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜çš„ï¼Œæ˜¯å› ä¸ºæœ¬æ–‡çš„ç¼–è¯‘å‚æ•°æ˜¯ç›´æ¥è§£å†³äº†è¿™ä¸ªé—®é¢˜çš„ã€‚å½“æˆ‘è‡ªå·±æ‘¸ç´¢çš„æ—¶å€™ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çœŸçš„æ˜¯çœ‹åˆ°äººéƒ½éº»äº†â€¦â€¦\nå…³é”®åœ¨äºç¼–è¯‘å‘½ä»¤çš„å‚æ•°ï¼š--targetã€‚\nå½“æ²¡æœ‰è®¾ç½®è¿™ä¸ªå‚æ•°æ—¶ï¼Œé»˜è®¤çš„å‚æ•°å…¶å®æ˜¯--target bundlerï¼Œå…¶æ˜¯ç¼–è¯‘æˆç»™webpackä¹‹ç±»çš„è„šæ‰‹æ¶ä½¿ç”¨çš„ã€‚å› æ­¤è¿™é‡Œä½¿ç”¨â€”target webï¼Œåˆ™æ˜¯ä½¿å…¶ç¼–è¯‘æˆå¯ç›´æ¥åœ¨webä¸­ä½¿ç”¨ã€‚\nç›¸å…³å‚æ•°å¦‚ä¸‹ï¼š\nbundlerï¼šç¼–è¯‘æˆç»™webpackä¹‹ç±»çš„è„šæ‰‹æ¶ä½¿ç”¨ webï¼šç¼–è¯‘æˆwebå¯ç›´æ¥ä½¿ç”¨ nodejsï¼šç¼–è¯‘æˆå¯é€šè¿‡requireæ¥åŠ è½½çš„nodeæ¨¡å— denoï¼šç¼–è¯‘æˆå¯é€šè¿‡importåŠ è½½çš„denoæ¨¡å— no-modulesï¼šè·Ÿwebç±»ä¼¼ï¼Œä½†æ˜¯æ›´æ—§ï¼Œä¸”ä¸èƒ½ä½¿ç”¨esæ¨¡å— ç›´æ¥å¼•å…¥wasmæ–‡ä»¶ è‹¥æ­¤æ—¶å°è¯•ç›´æ¥å¼•å…¥wasmæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æœ¬æ–‡æ‰€è¿°çš„æ–¹å¼ï¼Œé‚£ä¹ˆä½ ä¼šå‘ç°ï¼Œä¹Ÿæ˜¯å¯è¡Œçš„ï¼\n1 2 3 4 5 \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; WebAssembly.instantiateStreaming(fetch(\u0026#34;./pkg/hello_wasm_bg.wasm\u0026#34;), {}).then( (obj) =\u0026gt; console.log(\u0026#39;the result from rust is: \u0026#39;, obj.instance.exports.add(1, 2)) ); \u0026lt;/script\u0026gt; æ˜¯çš„ï¼Œæ²¡é”™ï¼Œå½“å‰æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å½“å¼•å…¥äº†ä¸€äº›åˆ«çš„æ¯”å¦‚domä¹‹ç±»çš„ï¼Œå°±åèµ·æ¥äº†â€¦â€¦\næ›´æ–°çš„wasmå¼•å…¥æ–¹å¼ ä¸Šä¸€é—®é¢˜ä¸­ï¼Œä¸”ä¸è¯´æ˜¯å¦å¯ä»¥ç›´æ¥å¼•å…¥wasmæ–‡ä»¶ï¼Œè¿™é‡Œä»…è¯´ä¸€ä¸‹ï¼ŒinstantiateStreamingè¿™ä¸ªæ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªæ›´æ–°çš„æ–¹æ³•ï¼Œæ— éœ€è½¬æˆarrayBufferï¼Œè¿™ä¹Ÿæ˜¯æ‘¸ç´¢Rustæ•´æ´»å„¿æ—¶å€™å‘ç°çš„ã€‚å¦‚æœåœ¨åˆ«çš„è¯­è¨€å¼•å…¥wasmï¼Œè¯·ä½¿ç”¨è¿™ä¸ªæ›´æ–°çš„æ–¹æ³•å§ã€‚\n","date":"2023-06-14T17:32:28Z","image":"https://hunterji.com/zh-cn/posts/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E4%B8%80%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/cover_hu6437590238652352065.jpg","permalink":"https://hunterji.com/zh-cn/posts/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E4%B8%80%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/","title":"ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(ä¸€)â€”â€”å¿«é€Ÿå¼€å§‹"},{"content":"å‰è¨€ WebAssembly æ˜¯ä¸€ç§æ–°çš„ç¼–ç æ–¹å¼ï¼Œå¯ä»¥åœ¨ç°ä»£çš„ç½‘ç»œæµè§ˆå™¨ä¸­è¿è¡Œ ï¼ å®ƒæ˜¯ä¸€ç§ä½çº§çš„ç±»æ±‡ç¼–è¯­è¨€ï¼Œå…·æœ‰ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¯ä»¥æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½è¿è¡Œï¼Œå¹¶ä¸ºè¯¸å¦‚ C / C ++ç­‰è¯­è¨€æä¾›ä¸€ä¸ªç¼–è¯‘ç›®æ ‡ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥åœ¨ Web ä¸Šè¿è¡Œã€‚å®ƒä¹Ÿè¢«è®¾è®¡ä¸ºå¯ä»¥ä¸ JavaScript å…±å­˜ï¼Œå…è®¸ä¸¤è€…ä¸€èµ·å·¥ä½œã€‚\nå¿«é€Ÿä¸Šæ‰‹ ç”¨goå†™ä¸€ä¸ªhello world 1 2 3 4 5 6 7 8 9 package main import ( \u0026#34;fmt\u0026#34; ) func main() { fmt.Println(\u0026#34;Hello, WebAssembly!\u0026#34;) } å°†goæ–‡ä»¶ç¼–è¯‘æˆwasmæ–‡ä»¶ 1 GOOS=js GOARCH=wasm go build -o static/main.wasm æ‹·è´å‡ºwasm_exec.js è¯¥æ–‡ä»¶ä¸ºgoçš„wasmçš„jsæ”¯æŒæ–‡ä»¶\n1 cp \u0026#34;$(go env GOROOT)/misc/wasm/wasm_exec.js\u0026#34; static htmlæ–‡ä»¶è°ƒç”¨wasmæ–‡ä»¶ 1 2 3 4 5 6 \u0026lt;script src=\u0026#34;static/wasm_exec.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; const go = new Go(); WebAssembly.instantiateStreaming(fetch(\u0026#34;static/main.wasm\u0026#34;), go.importObject) .then((result) =\u0026gt; go.run(result.instance)) \u0026lt;/script\u0026gt; éªŒè¯è°ƒç”¨ æµè§ˆå™¨åŠ è½½htmlæ–‡ä»¶ï¼Œf12æ‰“å¼€æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°wasmçš„æ‰“å°æ¶ˆæ¯ã€‚\ngoä¸jsçš„ç±»å‹è½¬æ¢ ç±»å‹æ˜ å°„ 1 2 3 4 5 6 7 8 9 10 | Go | JavaScript | | ---------------------- | ---------------------- | | js.Value | [its value] | | js.Func | function | | nil | null | | bool | boolean | | integers and floats | number | | string | string | | []interface{} | new array | | map[string]interface{} | new object | å¦‚ä¸Šä¸ºå®˜æ–¹ç»™å‡ºçš„goä¸jsçš„ç±»å‹æ˜ å°„è¡¨ã€‚\næ¯”å¦‚åœ¨goä¸­è°ƒç”¨jså‡½æ•°ï¼Œå‚æ•°ä¸ºarrayï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥å°†goçš„[]interface{}ç±»å‹çš„å˜é‡ä½œä¸ºå‚æ•°ä½¿ç”¨ã€‚\nå‡½æ•°è½¬æ¢æ•°ç»„ syscall/jsæä¾›äº†ä¸¤ä¸ªå‡½æ•°ï¼š\nCopyBytesToGoï¼šfunc CopyBytesToGo(dst []byte, src Value) int CopyBytesToJSï¼šfunc CopyBytesToJS(dst Value, src []byte) int ä¸¤è€…å¯¹äºgoè€Œè¨€ï¼Œç±»å‹éƒ½æ˜¯[]byteï¼Œä½†æ˜¯å¯¹äºjsè€Œè¨€ï¼Œéœ€è¦Uint8Arrayæˆ–è€…Uint8ClampedArrayç±»å‹ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚\né‚£ä¹ˆï¼Œå¦‚ä½•åœ¨goä¸­ç”Ÿæˆä¸€ä¸ªUint8Arrayæˆ–è€…Uint8ClampedArrayç±»å‹çš„å˜é‡å‘¢ï¼Ÿå®˜æ–¹çš„ç±»å‹æ˜ å°„è¡¨ä¹Ÿæ²¡æœ‰å•Š\u0026hellip;é‚£ä¹ˆå°±çœ‹ä¸‹ä¸€æ­¥ã€‚\nå…¶ä½™ç±»å‹ å¯¹äºéå®˜æ–¹ç±»å‹æ˜ å°„è¡¨å†…çš„ç±»å‹ï¼Œå’Œå®˜æ–¹æä¾›çš„ä¸¤ä¸ªæ•°æ®ç±»å‹è½¬æ¢ä¹‹å¤–çš„ç±»å‹ï¼Œå¯ä»¥é€šè¿‡ä¸€ç§é€šç”¨çš„æ–¹å¼æ¥ç”Ÿæˆï¼Œä»¥ä¸Šä¸€æ­¥çš„Uint8Arrayä¸ºä¾‹ï¼š\n1 js.Global().Get(\u0026#34;Uint8Array\u0026#34;).New(\u0026lt;length\u0026gt;) å®é™…ä½¿ç”¨æ¡ˆä¾‹ï¼š\n1 2 3 // goData []byte{...} jsData := js.Global().Get(\u0026#34;Uint8Array\u0026#34;).New(len(goData)) js.CopyBytesToJS(jsData, goData) é‚£ä¹ˆï¼Œæ¯”å¦‚jsä¸­çš„Dateç±»å‹ï¼š\n1 2 dateConstructor := js.Global().Get(\u0026#34;Date\u0026#34;) dateConstructor.New(\u0026#34;2020-10-01\u0026#34;) æç«¯æƒ…å†µ å¥½å§ï¼Œè¿˜æœ‰æœ€åä¸€ä¸ªæ–¹æ¡ˆï¼Œå¦‚æœé‡åˆ°æç«¯æƒ…å†µï¼Œä¸Šè¿°æ–¹æ¡ˆéƒ½æ— æ³•è§£å†³ï¼Œé‚£ä¹ˆè¯·è½¬æ¢æˆå­—ç¬¦ä¸²å§ï¼è®©goå’Œjsç”¨å„è‡ªçš„æ–¹æ³•åˆ†åˆ«å¤„ç†ä¸€æ³¢ï¼Œå¾—åˆ°è‡ªå·±æƒ³è¦çš„ç»“æœæˆ–è€…ç»™å‡ºå„è‡ªæƒ³ç»™çš„æ•°æ®ã€‚\njsè°ƒç”¨goå‡½æ•° æ­¤å¤„éœ€è¦åœ¨goä¸­å¼•å…¥syscall/jsï¼Œä»¥å®ç°jsç›¸å…³çš„æ“ä½œã€‚\næ³¨å†Œgoå‡½æ•° å°†goçš„å‡½æ•°æ³¨å†Œä¸ºjsçš„å‡½æ•°ï¼Œç”±jsæ¥è¿›è¡Œè°ƒç”¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 package main import \u0026#34;syscall/js\u0026#34; func handleCount(this js.Value, args []js.Value) interface{} { count := args[0].Int() return js.ValueOf(count + 1) } func main() { done := make(chan string, 0) js.Global().Set(\u0026#34;HandleEvent\u0026#34;, js.FuncOf(handleEvent)) \u0026lt;-done } js.Func() æ¥å—ä¸€ä¸ªå‡½æ•°ç±»å‹ä½œä¸ºå…¶å‚æ•°ï¼Œè¯¥å‡½æ•°çš„å®šä¹‰æ˜¯å›ºå®šçš„ï¼š\n1 2 3 4 func(this Value, args []Value) interface{} // this å³ JavaScript ä¸­çš„ this // args æ˜¯åœ¨ JavaScript ä¸­è°ƒç”¨è¯¥å‡½æ•°çš„å‚æ•°åˆ—è¡¨ã€‚ // è¿”å›å€¼éœ€ç”¨ js.ValueOf æ˜ å°„æˆ JavaScript çš„å€¼ js.ValueOfè¿”å›ä½œä¸ºjsçš„å€¼ï¼š\n1 2 3 4 5 6 7 8 9 10 | Go | JavaScript | | ---------------------- | ---------------------- | | js.Value | [its value] | | js.Func | function | | nil | null | | bool | boolean | | integers and floats | number | | string | string | | []interface{} | new array | | map[string]interface{} | new object | jsè°ƒç”¨ åœ¨jsä¸­ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•ï¼Œå¼•å…¥wasmæ–‡ä»¶ä¹‹åï¼Œç›´æ¥è°ƒç”¨å‡½æ•°å³å¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;script src=\u0026#34;static/wasm_exec.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; const go = new Go(); WebAssembly.instantiateStreaming(fetch(\u0026#34;static/main.wasm\u0026#34;), go.importObject) .then((result) =\u0026gt; go.run(result.instance)) \u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; document.querySelector(\u0026#39;#button\u0026#39;).addEventListener(\u0026#39;click\u0026#39;, () =\u0026gt; { HandleEvent(1) // ä¼ å…¥å‚æ•°1 }) \u0026lt;/script\u0026gt; goè°ƒç”¨jså‡½æ•° å¦‚æœåœ¨jsä¸­æœ¬èº«å·²ç»å®šä¹‰äº†å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨goä¸­ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨è¯¥å‡½æ•°ï¼Œè¿›è¡Œè¿ç®—ï¼Œå°†å¾—å‡ºçš„ç»“æœåœ¨goä¸­ç»§ç»­ä½¿ç”¨ã€‚\nå®šä¹‰jså‡½æ•° 1 2 3 4 5 \u0026lt;script\u0026gt; function add(m, n) { return m + n } \u0026lt;/script\u0026gt; goä¸­è°ƒç”¨jså‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 12 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;syscall/js\u0026#34; ) func main() { result := js.Global().Call(\u0026#34;add\u0026#34;, 1, 2) fmt.Println(result) // æ­¤å¤„è¾“å‡ºç±»å‹ä¸ºjs.Valueï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨ fmt.Println(result.Int() + 1) // ä½¿ç”¨.Int()å°†å…¶è½¬æ¢ä¸ºgoä¸­çš„ç±»å‹ï¼Œå³å¯ç›´æ¥ä½¿ç”¨ } å¼•å…¥wasm 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;script\u0026gt; function add(m, n) { return m + n } \u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;static/wasm_exec.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; const go = new Go(); WebAssembly.instantiateStreaming(fetch(\u0026#34;static/main.wasm\u0026#34;), go.importObject) .then((result) =\u0026gt; go.run(result.instance)) \u0026lt;/script\u0026gt; ç»“æœ åœ¨å‰ç«¯è°ƒè¯•å°å¯ä»¥çœ‹åˆ°è¾“å‡ºï¼š\n1 2 \u0026lt;number: 3\u0026gt; 4 ç¬¬ä¸€ä¸ªç»“æœå°±æ˜¯js.Valueçš„å€¼ï¼Œç¬¬äºŒä¸ªç»“æœåˆ™æ˜¯è½¬æ¢æˆgoçš„å€¼ï¼Œå¹¶æŒ‰ç…§é€»è¾‘è¿›è¡Œäº†+1å¤„ç†ã€‚\nå›è°ƒå‡½æ•°/è§£å†³goå‡½æ•°é˜»å¡é—®é¢˜ The Go function fn is called with the value of JavaScript\u0026rsquo;s \u0026ldquo;this\u0026rdquo; keyword and the arguments of the invocation. The return value of the invocation is the result of the Go function mapped back to JavaScript according to ValueOf.\nInvoking the wrapped Go function from JavaScript will pause the event loop and spawn a new goroutine. Other wrapped functions which are triggered during a call from Go to JavaScript get executed on the same goroutine.\nAs a consequence, if one wrapped function blocks, JavaScript\u0026rsquo;s event loop is blocked until that function returns. Hence, calling any async JavaScript API, which requires the event loop, like fetch (http.Client), will cause an immediate deadlock. Therefore a blocking function should explicitly start a new goroutine.\nsyscall/jså®˜æ–¹æ–‡æ¡£è¡¨æ˜ï¼Œå¦‚æœgoåŒ…è£…å‡½æ•°é˜»å¡ï¼Œé‚£ä¹ˆjsçš„äº‹ä»¶å¾ªç¯ä¹Ÿå°†è¢«é˜»å¡ï¼Œç›´åˆ°å‡½æ•°è¿”å›ï¼Œè°ƒç”¨ä»»ä½•éœ€è¦äº‹ä»¶å¾ªç¯ï¼ˆå¦‚fetchï¼‰çš„å¼‚æ­¥js apiéƒ½å¯¼è‡´ç«‹å³æ­»é”ã€‚å› æ­¤ï¼Œä¸€ä¸ªé˜»å¡å‡½æ•°åº”è¯¥æ˜¾å¼åœ°å¯åŠ¨ä¸€ä¸ªæ–°çš„åç¨‹ã€‚\næ­¤å¤„ï¼Œå¯ä»¥åœ¨goä¸­æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ŒåŠ ä¸Šåç¨‹å®ç°å¼‚æ­¥ï¼Œä¸ä¼šäº§ç”Ÿå µå¡ã€‚\næ³¨å†Œå‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;syscall/js\u0026#34; \u0026#34;time\u0026#34; ) func handleRender(this js.Value, args []js.Value) interface{} { username := args[0].String() callback := args[len(args)-1] go func() { time.Sleep(3 * time.Second) callback.Invoke(fmt.Sprintf(\u0026#34;hello, %s !\u0026#34;, username)) }() fmt.Println(\u0026#34;waiting...\u0026#34;) return nil } func main() { done := make(chan string, 0) js.Global().Set(\u0026#34;HandleRender\u0026#34;, js.FuncOf(handleRender)) \u0026lt;-done } jsè°ƒç”¨ 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;script src=\u0026#34;static/wasm_exec.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; const go = new Go(); WebAssembly.instantiateStreaming(fetch(\u0026#34;static/main.wasm\u0026#34;), go.importObject) .then((result) =\u0026gt; go.run(result.instance)) \u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; document.querySelector(\u0026#39;#button\u0026#39;).addEventListener(\u0026#39;click\u0026#39;, () =\u0026gt; { HandleRender(\u0026#34;tom\u0026#34;, (message) =\u0026gt; console.log(\u0026#39;message: \u0026#39;, message)) }) \u0026lt;/script\u0026gt; è¾“å‡º åœ¨æµè§ˆå™¨è°ƒè¯•å°ï¼Œå¯ä»¥çœ‹åˆ°ï¼š\n1 2 waiting... // å…ˆè¾“å‡ºäº†waiting... hello, tom ! // éš”äº†3ç§’ä¹‹åï¼Œè¾“å‡ºäº†å›è°ƒå‡½æ•°çš„å€¼ Goå®ç°Promise ä¸Šä¸€æ­¥çš„å›è°ƒå‡½æ•°ï¼Œè§£å†³äº†å‡½æ•°é˜»å¡é—®é¢˜ï¼Œæ­¤å¤„ï¼Œç»“åˆå›è°ƒå‡½æ•°å®ç°promiseï¼Œæ¥ä¸°å¯Œå¼‚æ­¥åœºæ™¯ã€‚\nåœ¨jsä¸­ï¼Œpromiseæ˜¯è¿™æ ·çš„ï¼š\n1 2 3 4 5 const message = new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { resolve(\u0026#34;hello, world !\u0026#34;) }, 3000) }) ä½¿ç”¨asyncå’Œawaitè°ƒç”¨ï¼Œæ‹¿åˆ°ç»“æœï¼š\n1 2 3 4 5 6 7 8 9 10 async function printMessage() { const message = new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { resolve(\u0026#34;hello, world !\u0026#34;) }, 3000) }) const result = await message console.log(result) } åœ¨goä¸­åˆå¦‚ä½•æ„å»ºpromiseå‘¢ï¼Ÿè¿™é‡Œå¯ä»¥ç”¨åˆ°ä¸Šè¿°goä¸jsçš„ç±»å‹è½¬æ¢ï¼Œåˆ›å»ºä¸€ä¸ªpromiseï¼š\n1 js.Global().Get(\u0026#34;Promise\u0026#34;) æ³¨å†Œå‡½æ•° goçš„å®Œæ•´å®ç°å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;syscall/js\u0026#34; \u0026#34;time\u0026#34; ) var document = js.Global().Get(\u0026#34;document\u0026#34;) func handleRender(this js.Value, args []js.Value) interface{} { handler := js.FuncOf(func(this js.Value, args []js.Value) interface{} { resolve := args[0] go func() { time.Sleep(3 * time.Second) resolve.Invoke(\u0026#34;hello, world !\u0026#34;) }() fmt.Println(\u0026#34;waiting...\u0026#34;) return nil }) promiseConstructor := js.Global().Get(\u0026#34;Promise\u0026#34;) return promiseConstructor.New(handler) } func main() { done := make(chan string, 0) js.Global().Set(\u0026#34;HandleRender\u0026#34;, js.FuncOf(handleRender)) \u0026lt;-done } jsè°ƒç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;script src=\u0026#34;static/wasm_exec.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; const go = new Go(); WebAssembly.instantiateStreaming(fetch(\u0026#34;static/main.wasm\u0026#34;), go.importObject) .then((result) =\u0026gt; go.run(result.instance)) \u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; document.querySelector(\u0026#39;#button\u0026#39;).addEventListener(\u0026#39;click\u0026#39;, async () =\u0026gt; { const message = await HandleRender() console.log(\u0026#39;message: \u0026#39;, message) }) \u0026lt;/script\u0026gt; è¾“å‡º åœ¨æµè§ˆå™¨è°ƒè¯•å°ï¼Œå¯ä»¥çœ‹åˆ°ï¼š\n1 2 waiting... // å…ˆè¾“å‡ºäº†waiting... message: hello, world ! // éš”äº†3ç§’ä¹‹åè¾“å‡º æ“ä½œDOM ä½¿ç”¨document å®šä¹‰ä¸€ä¸ªå…¨å±€çš„document\n1 var docuemnt = js.Global().Get(\u0026#34;document\u0026#34;) è·å–å…ƒç´  è·å–ä¸€ä¸ªidä¸ºcontainerçš„divï¼Œè®¾ç½®background-color: redã€widht: 600ã€height: 400\n1 2 3 4 5 var containerElement = document.Call(\u0026#34;getElementById\u0026#34;, \u0026#34;container\u0026#34;) var containerElementStyle = container.Get(\u0026#34;style\u0026#34;) containerElementStyle.Set(\u0026#34;background\u0026#34;, \u0026#34;red\u0026#34;) containerElementStyle.Set(\u0026#34;width\u0026#34;, \u0026#34;600px\u0026#34;) containerElementStyle.Set(\u0026#34;height\u0026#34;, \u0026#34;400px\u0026#34;) åˆ›å»ºå…ƒç´  åˆ›å»ºä¸€ä¸ªidä¸ºimageçš„imageï¼Œè®¾ç½®width:300ã€height:200\n1 2 3 var imageElement = document.Call(\u0026#34;createElement\u0026#34;, \u0026#34;canvas\u0026#34;) imageElement.Set(\u0026#34;width\u0026#34;, 300) imageElement.Set(\u0026#34;width\u0026#34;, 200) æ·»åŠ å­å…ƒç´  å°†imageæ·»åŠ ä¸ºidä¸ºcontainerçš„divçš„å­å…ƒç´ \n1 containerElement.Call(\u0026#34;appendChild\u0026#34;, imageElement) æ·»åŠ äº‹ä»¶ ç»™imageæ·»åŠ å³å‡»äº‹ä»¶ï¼Œå³å‡»imageåˆ™é˜»æ­¢å³é”®èœå•\n1 2 3 4 5 6 7 8 // å®šä¹‰å“åº”å‡½æ•° func handlePreventEventCallBack(this js.Value, args []js.Value) interface{} { args[0].Call(\u0026#34;preventDefault\u0026#34;) return false } // ç»™imageæ·»åŠ äº‹ä»¶ imageElement.Call(\u0026#34;addEventListener\u0026#34;, \u0026#34;contextmenu\u0026#34;, js.FuncOf(handlePreventEventCallBack)) è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä¸å†è°ƒç”¨å“åº”äº‹ä»¶å‡½æ•°æ—¶ï¼Œå¿…é¡»è°ƒç”¨Func.Releaseä»¥é‡Šæ”¾èµ„æºï¼š\n1 2 3 4 5 6 7 var cb js.Func cb = js.FuncOf(func(this js.Value, args []js.Value) any { fmt.Println(\u0026#34;button clicked\u0026#34;) cb.Release() // å¦‚æœä¸å†å•å‡»è¯¥æŒ‰é’®ï¼Œåˆ™é‡Šæ”¾è¯¥å‡½æ•° return nil }) js.Global().Get(\u0026#34;document\u0026#34;).Call(\u0026#34;getElementById\u0026#34;, \u0026#34;myButton\u0026#34;).Call(\u0026#34;addEventListener\u0026#34;, \u0026#34;click\u0026#34;, cb) Canvas è¿™é‡Œæ”¾ä¸€æ³¢canvasçš„æ¡ˆä¾‹ï¼ŒåŒ…å«äº†ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒå®Œæˆæ›´å¤šæ“ä½œã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 package main import ( \u0026#34;math\u0026#34; \u0026#34;syscall/js\u0026#34; ) const ( width = 400 height = 400 radius = 200 ) var document = js.Global().Get(\u0026#34;document\u0026#34;) func handleRender(this js.Value, args []js.Value) interface{} { var canvas = document.Call(\u0026#34;getElementById\u0026#34;, \u0026#34;canvas\u0026#34;) canvas.Set(\u0026#34;width\u0026#34;, width) canvas.Set(\u0026#34;height\u0026#34;, height) var ctx = canvas.Call(\u0026#34;getContext\u0026#34;, \u0026#34;2d\u0026#34;) ctx.Call(\u0026#34;beginPath\u0026#34;) ctx.Call(\u0026#34;arc\u0026#34;, width/2, height/2, radius, 0, 2*math.Pi) ctx.Set(\u0026#34;fillStyle\u0026#34;, \u0026#34;lightpink\u0026#34;) ctx.Call(\u0026#34;fill\u0026#34;) ctx.Set(\u0026#34;lineWidth\u0026#34;, 2) ctx.Set(\u0026#34;strokeStyle\u0026#34;, \u0026#34;red\u0026#34;) ctx.Call(\u0026#34;stroke\u0026#34;) ctx.Set(\u0026#34;font\u0026#34;, \u0026#34;20px Comic Sans MS\u0026#34;) ctx.Set(\u0026#34;fillStyle\u0026#34;, \u0026#34;blue\u0026#34;) ctx.Call(\u0026#34;fillText\u0026#34;, \u0026#34;Hello, World !\u0026#34;, width/2-60, height/2) return nil } func main() { done := make(chan string, 0) js.Global().Set(\u0026#34;HandleRender\u0026#34;, js.FuncOf(handleRender)) \u0026lt;-done } æ¸²æŸ“ç»“æœï¼š\nå‚è€ƒæ–‡æ¡£ syscall/js go wiki WebAssembly Go WebAssembly (Wasm) ç®€æ˜æ•™ç¨‹ Go, WebAssembly, HTTP requests and Promises ","date":"2023-02-09T13:15:34Z","image":"https://hunterji.com/zh-cn/posts/webassembly--%E6%9C%AA%E6%9D%A5%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E5%BF%85%E5%A4%87%E6%8A%80%E8%83%BD/cover_hu15501836490561713388.jpg","permalink":"https://hunterji.com/zh-cn/posts/webassembly--%E6%9C%AA%E6%9D%A5%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E5%BF%85%E5%A4%87%E6%8A%80%E8%83%BD/","title":"WebAssembly -- æœªæ¥å‰ç«¯å¼€å‘çš„å¿…å¤‡æŠ€èƒ½"}]