<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>WebAssembly on å°æ©™</title><link>https://hunterji.com/zh-cn/tags/webassembly/</link><description>Recent content in WebAssembly on å°æ©™</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 26 Oct 2023 23:51:13 +0000</lastBuildDate><atom:link href="https://hunterji.com/zh-cn/tags/webassembly/index.xml" rel="self" type="application/rss+xml"/><item><title>ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(å››)â€”â€”æ›´å°æ›´å°çš„wasmæ–‡ä»¶ä½“ç§¯</title><link>https://hunterji.com/zh-cn/post/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E5%9B%9B%E6%9B%B4%E5%B0%8F%E6%9B%B4%E5%B0%8F%E7%9A%84wasm%E6%96%87%E4%BB%B6%E4%BD%93%E7%A7%AF/</link><pubDate>Thu, 26 Oct 2023 23:51:13 +0000</pubDate><guid>https://hunterji.com/zh-cn/post/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E5%9B%9B%E6%9B%B4%E5%B0%8F%E6%9B%B4%E5%B0%8F%E7%9A%84wasm%E6%96%87%E4%BB%B6%E4%BD%93%E7%A7%AF/</guid><description>&lt;img src="https://hunterji.com/img/cover.jpg" alt="Featured image of post ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(å››)â€”â€”æ›´å°æ›´å°çš„wasmæ–‡ä»¶ä½“ç§¯" />&lt;h2 id="å‰è¨€">å‰è¨€
&lt;/h2>&lt;p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« &lt;a class="link" href="https://blog.hunterji.com/p/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E4%B8%89rust%E4%B8%8Ejs%E4%BA%A4%E4%BA%92/" target="_blank" rel="noopener"
>ã€Šä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(ä¸‰)â€”â€”Rustä¸JSäº¤äº’ã€‹&lt;/a>ä¸­ï¼Œè®²è¿°äº†Rustä¸JSçš„äº¤äº’ï¼ŒåŒ…æ‹¬Rustä¸JSçš„å‡½æ•°ç›¸äº’è°ƒç”¨ï¼Œæ¯”è¾ƒç‚¸è£‚çš„åŠŸèƒ½å°±æ˜¯ä½¿ç”¨JSè°ƒç”¨Rustçš„structï¼ŒJSæœ¬èº«è¿structéƒ½æ²¡æœ‰ï¼Œå±…ç„¶å¯ä»¥è°ƒç”¨Rustçš„structï¼Œè¿™å¯¹äºRustå¼€å‘è€…çš„å¼€å‘ä½“éªŒè€Œè¨€ï¼Œæ˜¯çœŸçš„å¾ˆæ£’ï¼&lt;/p>
&lt;p>åŸºäºå‰é¢çš„ç³»åˆ—æ–‡ç« ï¼Œå·²ç»è¶³ä»¥ä½¿ç”¨Rustå¼€å‘ä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½äº†ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œåœ¨å‰ç«¯å¼•å…¥wasmæ–‡ä»¶æ—¶ï¼Œè¿˜æ˜¯å¯èƒ½å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚wasmæ–‡ä»¶è¾ƒå¤§ï¼Œå¯¼è‡´ç½‘é¡µè®¿é—®æ—¶é—´è¾ƒé•¿ï¼Œç”¨æˆ·ä½“éªŒè¾ƒå·®ã€‚æœ¬ç¯‡æ–‡ç« å°†ä¼šé€šè¿‡å¤šç§é€”å¾„æ¥å‡å°‘Rustç¼–è¯‘wasmæ–‡ä»¶çš„ä½“ç§¯ï¼Œä»¥å‡å°‘å‰ç«¯åŠ è½½wasmæ–‡ä»¶çš„æ—¶é—´ã€‚&lt;/p>
&lt;p>æ›¾ç»ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä¸€ç›´ç”¨&lt;a class="link" href="https://blog.hunterji.com/p/webassembly--%E6%9C%AA%E6%9D%A5%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E5%BF%85%E5%A4%87%E6%8A%80%E8%83%BD/" target="_blank" rel="noopener"
>Goå¼€å‘WebAssembly&lt;/a>ï¼Œå…¶ç¼–è¯‘åçš„wasmæ–‡ä»¶ä½“ç§¯è¿˜æ˜¯è¾ƒå¤§çš„ï¼Œä¸ºäº†å‡å°‘wasmæ–‡ä»¶çš„ä½“ç§¯çœŸæ˜¯ç…è´¹è‹¦å¿ƒï¼Œ1xMBå¤§å°çš„wasmæ–‡ä»¶çœŸçš„æ˜¯å¤ªç—›äº†&amp;hellip;&amp;hellip;ä½†æ˜¯ä½“ç§¯ä¼˜åŒ–å¾€å¾€éƒ½ä¼šæŒ‡å‘ä¸€æ¡â€œå……æ»¡é­…æƒ‘çš„ä¸å½’è·¯â€â€”â€”æ¢æˆRustå¼€å‘ğŸ˜†ï¼å¦‚æœä½ å·²ç»åœ¨ç”¨Rustå¼€å‘WebAssemblyäº†ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œå¯¹Goè€Œè¨€ï¼Œåœ¨wasmä½“ç§¯ä¸Šï¼Œä½ å·²ç»èµ¢åœ¨èµ·è·‘çº¿ä¸Šäº†ã€‚&lt;/p>
&lt;h2 id="ç¯å¢ƒ">ç¯å¢ƒ
&lt;/h2>&lt;ul>
&lt;li>Rust 1.70.0&lt;/li>
&lt;li>wasm-bindgen 0.2.87&lt;/li>
&lt;/ul>
&lt;h2 id="æŸ¥çœ‹ä½“ç§¯">æŸ¥çœ‹ä½“ç§¯
&lt;/h2>&lt;p>åœ¨çœŸæ­£å»å‡å°‘ä½“ç§¯å‰ï¼Œæˆ‘ä»¬éœ€è¦æ¥å…ˆçœ‹ä¸€ä¸‹ï¼Œå½“å‰æƒ…å†µä¸‹ä½“ç§¯æ˜¯å¤šå°‘ï¼Œæ–¹ä¾¿åç»­å¯¹æ¯”å‰åä½“ç§¯ã€‚&lt;/p>
&lt;p>æŸ¥çœ‹ä½“ç§¯çš„æ–¹å¼æœ‰å¤šç§ï¼Œè¿™é‡Œæ¨èå‡ ä¸ªï¼Œï¼ˆLinuxå’ŒMacOSï¼‰ä½¿ç”¨å…¶ä¸€å³å¯ã€‚&lt;/p>
&lt;h3 id="ls">ls
&lt;/h3>&lt;p>å¯ä»¥ä½¿ç”¨&lt;code>ls -l&lt;/code>æˆ–è€…&lt;code>ll&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ ll pkg/hello_wasm_bg.wasm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> kuari staff 23K Jul &lt;span class="m">20&lt;/span> 21:52 pkg/hello_wasm_bg.wasm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="stat">stat
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ stat pkg/hello_wasm_bg.wasm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">16777222&lt;/span> &lt;span class="m">142141572&lt;/span> -rw-r--r-- &lt;span class="m">1&lt;/span> kuari staff &lt;span class="m">0&lt;/span> &lt;span class="m">23347&lt;/span> &lt;span class="s2">&amp;#34;Jul 20 21:52:53 2023&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;Jul 20 21:52:01 2023&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;Jul 20 21:52:01 2023&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;Jul 20 21:52:01 2023&amp;#34;&lt;/span> &lt;span class="m">4096&lt;/span> &lt;span class="m">48&lt;/span> &lt;span class="m">0&lt;/span> pkg/hello_wasm_bg.wasm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="wc">wc
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ wc -c pkg/hello_wasm_bg.wasm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">23347&lt;/span> pkg/hello_wasm_bg.wasm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»¥&lt;code>wc&lt;/code>ä¸ºä¾‹ï¼Œå½“å‰è¯¥wasmæ–‡ä»¶ä½“ç§¯ä¸º&lt;strong>23347b&lt;/strong>ã€‚&lt;/p>
&lt;h2 id="ä»£ç å±‚é¢">ä»£ç å±‚é¢
&lt;/h2>&lt;blockquote>
&lt;p>Link-Time Optimization (LTO) æ˜¯æŒ‡åœ¨ç¨‹åºé“¾æ¥æ—¶è¿›è¡Œçš„ä¸€ç§è¿‡ç¨‹é—´ä¼˜åŒ–ï¼ˆinterprocedural optimizationï¼‰ã€‚å®ƒå…è®¸ç¼–è¯‘å™¨åœ¨é“¾æ¥é˜¶æ®µå¯¹å¤šä¸ªç¼–è¯‘å•å…ƒè¿›è¡Œä¼˜åŒ–ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€å¯é æ€§å’Œå®‰å…¨æ€§ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>ä»ä»£ç å±‚é¢ä¼˜åŒ–ï¼Œä¸»è¦æ˜¯åˆ©ç”¨LTOï¼ˆLink-Time Optimizationï¼‰ã€‚&lt;/p>
&lt;h3 id="ä»£ç å†…">ä»£ç å†…
&lt;/h3>&lt;p>åœ¨&lt;code>Cargo.toml&lt;/code>ä¸­å¼€å¯LTOï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">profile&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">release&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">lto&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¼€å¯LTOè™½ç„¶èƒ½å¤Ÿå‡å°‘ç¼–è¯‘åçš„ä½“ç§¯ï¼Œä½†æ˜¯ä¹Ÿä¼šå¢åŠ ç¼–è¯‘æ—¶é—´ã€‚&lt;/p>
&lt;p>LTOå¼€å¯åï¼Œé»˜è®¤æ˜¯åœ¨å‡å°‘ä¸€å®šç¨‹åº¦çš„ç¼–è¯‘ä½“ç§¯çš„æƒ…å†µä¸‹ï¼Œè¦ç¡®ä¿ç¼–è¯‘çš„æ—¶é—´ã€‚å¦‚æœä½ çš„éœ€æ±‚å°±æ˜¯æ›´å°çš„ä½“ç§¯ï¼Œè€Œä¸æ˜¯è¾ƒçŸ­çš„æ—¶é—´ï¼Œé‚£ä¹ˆï¼Œå¯ä»¥é€šè¿‡æ‰‹åŠ¨æŒ‡å®šç¼–è¯‘ç­‰çº§æ¥è®©LTOä½œå‡ºæ”¹å˜ã€‚&lt;/p>
&lt;p>åœ¨ä»£ç å†…å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ç­‰çº§ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>s&lt;/code>ï¼šé»˜è®¤çš„ LTO ç­‰çº§ã€‚å®ƒä¼šè¿›è¡Œæœ€åŸºæœ¬çš„ LTO ä¼˜åŒ–ï¼ŒåŒ…æ‹¬å†…è”å‡½æ•°ã€å‡½æ•°é‡å†™ã€æ•°æ®é‡æ’ç­‰&lt;/li>
&lt;li>&lt;code>z&lt;/code>ï¼šæœ€é«˜çº§çš„ LTO ç­‰çº§ã€‚å®ƒä¼šè¿›è¡Œæ›´å¤æ‚çš„ LTO ä¼˜åŒ–ï¼ŒåŒ…æ‹¬æ­»ä»£ç æ¶ˆé™¤ã€å†…å­˜åˆ†é…ä¼˜åŒ–ã€å®‰å…¨æ€§ä¼˜åŒ–ç­‰&lt;/li>
&lt;/ul>
&lt;p>é‚£ä¹ˆå¯ä»¥åœ¨&lt;code>Cargo.toml&lt;/code>ä¸­è¿™ä¹ˆé…ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">profile&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">release&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">lto&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">opt-level&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;z&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åŸå§‹çš„æ–‡ä»¶ä½“ç§¯æ˜¯23347bï¼Œç°åœ¨ç¼–è¯‘åçœ‹ä¸€ä¸‹ä½“ç§¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ wc -c pkg/hello_wasm_bg.wasm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">19879&lt;/span> pkg/hello_wasm_bg.wasm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¾ˆæ˜æ˜¾æ˜¯å‡å°‘ä½“ç§¯ï¼ä½†æ˜¯ï¼Œä½¿ç”¨&lt;code>z&lt;/code>ç­‰çº§å¹¶ä¸ä»£è¡¨ä¸€å®šæ¯æ¬¡ä½“ç§¯éƒ½ä¼šæ¯”&lt;code>s&lt;/code>å°çš„ï¼Œæœ‰æ—¶å€™&lt;code>s&lt;/code>ä¹Ÿä¼šæ¯”&lt;code>z&lt;/code>å°ï¼Œè¿™éœ€è¦è§†ä»£ç æƒ…å†µè€Œå®šã€‚&lt;/p>
&lt;h3 id="ä»£ç å¤–">ä»£ç å¤–
&lt;/h3>&lt;p>åœ¨ä»£ç å¤–ï¼Œå¯ä»¥ä½¿ç”¨&lt;a class="link" href="https://github.com/WebAssembly/binaryen" target="_blank" rel="noopener"
>wasm-opt&lt;/a>æ¥è¿›è¡Œä¼˜åŒ–ï¼Œå…¶å¯ä»¥å¯¹ WebAssembly æ¨¡å—è¿›è¡Œå¤šæ–¹é¢çš„ä¼˜åŒ–ï¼Œå½“ç„¶æœ¬ç¯‡æ–‡ç« ä¸­é‡ç‚¹åœ¨ä½“ç§¯æ–¹é¢ï¼ˆæŒ–ä¸ªå‘ï¼Œåé¢å†è¯¦èŠ/ç‹—å¤´ï¼‰ã€‚å¹¶ä¸”wasm-optå¯ä»¥å¯¹æ‰€æœ‰ç¬¦åˆWebAssemblyè§„èŒƒçš„wasmæ–‡ä»¶è¿›è¡Œä¼˜åŒ–ï¼Œæ‰€ä»¥ï¼Œå°±ç®—ä½ ä¸æ˜¯Rustå†™çš„ï¼Œé‚£ä¹Ÿå¯ä»¥ç”¨å…¶è¿›è¡Œä¼˜åŒ–ã€‚ï¼ˆæƒ³æƒ³æˆ‘æ›¾ç»Goå†™çš„wasmï¼Œä¹Ÿæ˜¯æœ‰å¤šä¸€ä¸ªæ³•å­å¯ä»¥ä¼˜åŒ–ä¸€æŠŠäº†&amp;hellip;&amp;hellip;ï¼‰&lt;/p>
&lt;p>é¦–å…ˆï¼Œæ¥çœ‹ä¸€ä¸‹wasm-optçš„åŸºæœ¬ä¼˜åŒ–å‚æ•°ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>-o&lt;/strong>ï¼šæŒ‡å®šä¼˜åŒ–åçš„æ¨¡å—è¾“å‡ºæ–‡ä»¶&lt;/li>
&lt;li>&lt;strong>-O&lt;/strong>ï¼šå¯ç”¨é»˜è®¤ä¼˜åŒ–ï¼Œç­‰åŒäº&lt;code>-Os&lt;/code>å‚æ•°&lt;/li>
&lt;li>&lt;strong>-O0&lt;/strong>ï¼šä¸è¿›è¡Œä»»ä½•ä¼˜åŒ–&lt;/li>
&lt;li>&lt;strong>-O1&lt;/strong>ï¼šè¿›è¡Œä¸€äº›åŸºæœ¬çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚å†…è”å‡½æ•°ä¼˜åŒ–å’Œæ­»ä»£ç æ¶ˆé™¤ä¼˜åŒ–&lt;/li>
&lt;li>&lt;strong>-O2&lt;/strong>ï¼šè¿›è¡Œæ›´ä¸ºå½»åº•çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚å‡½æ•°é‡å†™ã€æ•°æ®é‡æ’ã€å†…å­˜åˆ†é…ä¼˜åŒ–ç­‰&lt;/li>
&lt;li>&lt;strong>-O3&lt;/strong>ï¼šè¿›è¡Œæœ€ä¸ºå½»åº•çš„ä¼˜åŒ–ï¼ŒåŒ…æ‹¬ä¸€äº›å¯èƒ½å½±å“ç¨‹åºåŠŸèƒ½çš„ä¼˜åŒ–&lt;/li>
&lt;li>&lt;strong>-O4&lt;/strong>ï¼šä¸ &lt;code>-O3&lt;/code> ç›¸åŒï¼Œä½†ä¼šå¯ç”¨æ›´ä¸ºæ¿€è¿›çš„ä¼˜åŒ–&lt;/li>
&lt;li>&lt;strong>-Os&lt;/strong>ï¼šä¼˜åŒ–ç›®æ ‡æ˜¯å‡å°ä»£ç å¤§å°ï¼Œä¼šè¿›è¡Œä¸€äº›å¯èƒ½å½±å“æ€§èƒ½çš„ä¼˜åŒ–&lt;/li>
&lt;li>&lt;strong>-Oz&lt;/strong>ï¼šä¸ &lt;code>-Os&lt;/code> ç›¸åŒï¼Œä½†ä¼šå¯ç”¨æ›´ä¸ºæ¿€è¿›çš„ä¼˜åŒ–&lt;/li>
&lt;/ul>
&lt;p>åŸºäºæœ¬ç¯‡æ–‡ç« ä¸»é¢˜ï¼Œæ­¤å¤„å°†ä½¿ç”¨&lt;code>-Os&lt;/code>å’Œ&lt;code>-Oz&lt;/code>ä¸¤ç§å‚æ•°ï¼Œå…¶äºä¸Šè¿°&amp;quot;ä»£ç å†…&amp;quot;çš„ç­‰çº§æ˜¯å¯¹åº”çš„ã€‚&lt;/p>
&lt;p>æ­¤å¤„ä»¥åŸå§‹wasmæ–‡ä»¶ï¼Œä»¥&lt;code>-Oz&lt;/code>å‚æ•°æ¥æ‰§è¡Œä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹å¯¹æ¯”æ•ˆæœï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ wc -c pkg/output.wasm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">23194&lt;/span> pkg/output.wasm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å†ä»¥ä¸Šè¿°å¼€å¯â€œä»£ç å†…â€œLTOç¼–è¯‘åçš„wasmæ–‡ä»¶ï¼Œä»¥wasm-optæ‰§è¡Œä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹å¯¹æ¯”æ•ˆæœï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ wc -c pkg/output.wasm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">19871&lt;/span> pkg/output.wasm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ€»ä½“è€Œè¨€ï¼Œwasmæ–‡ä»¶çš„ä½“ç§¯è¶Šæ¥è¶Šå°ã€‚åªæ˜¯å½“å‰æˆ‘è¿™é‡Œçš„æ¡ˆä¾‹ï¼Œæ˜¯æ²¿ç”¨ç³»åˆ—æ–‡ç« å†…å®¹çš„ä»£ç ï¼Œæ²¡æœ‰ä»€ä¹ˆå®é™…æ€§å¤æ‚ä»£ç ï¼Œå†è€…æœ¬èº«ä½“ç§¯å·²ç»å¾ˆå°äº†ï¼Œæ‰€ä»¥ä¸ä¼šç‰¹åˆ«æœ‰æ•ˆæœã€‚&lt;/p>
&lt;h2 id="ç½‘ç»œå±‚é¢">ç½‘ç»œå±‚é¢
&lt;/h2>&lt;p>ç½‘ç»œå±‚é¢çš„è¯ï¼Œå°±æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„åœ¨ç½‘ç»œä¼ è¾“æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çº¦å®šç›¸åŒçš„å‹ç¼©ç®—æ³•ï¼Œç„¶åæœåŠ¡ç«¯ç»™å‡ºæ—¶è¿›è¡Œå‹ç¼©ï¼Œå®¢æˆ·ç«¯æ¥æ”¶æ—¶è¿›è¡Œè§£å‹ã€‚ç½‘ç»œå±‚é¢å¯ä»¥å¯¹ä¼ è¾“æŠ¥æ–‡è¿›è¡Œå‹ç¼©ï¼Œä½†ä¸ä¸¢å¤±ä¿¡æ¯ã€‚&lt;/p>
&lt;p>æ¯”å¦‚å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰çš„gzipå‹ç¼©ç®—æ³•ï¼Œä¸è¿‡ï¼Œå‹ç¼©ç®—æ³•æœ‰å¥½å‡ ç§ï¼š&lt;/p>
&lt;ul>
&lt;li>gzip&lt;/li>
&lt;li>compress&lt;/li>
&lt;li>deflate&lt;/li>
&lt;li>br&lt;/li>
&lt;/ul>
&lt;p>å…¶ä¸­gzipä¹Ÿæ˜¯å‹ç¼©ç‡æœ€é«˜çš„äº†ï¼Œæ­¤å¤„å°±ä»¥gzipä¸ºä¾‹ã€‚&lt;/p>
&lt;p>åœ¨ç½‘ç»œå±‚é¢ï¼Œå°†wasmæ–‡ä»¶ä»¥gzipå‹ç¼©ï¼Œå‡å°‘å…¶åœ¨ä¼ è¾“æ—¶çš„ä½“ç§¯ã€‚è™½ç„¶å‡å°‘äº†ä¼ è¾“æ—¶çš„ä½“ç§¯ï¼Œä½†æ˜¯æµè§ˆå™¨åœ¨æ‹¿åˆ°å‹ç¼©åçš„æ•°æ®ï¼Œéœ€è¦æ¶ˆè€—ä¸€å®šæ€§èƒ½æ¥è§£å¯†ã€‚&lt;/p>
&lt;h3 id="å¼€å¯gzip">å¼€å¯GZIP
&lt;/h3>&lt;p>å¼€å¯GZIPå…¶å®ç®€å•ï¼Œåªè¦å‰åç«¯çº¦å®šå¥½éƒ½ç”¨gzipå°±è¡Œäº†ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼Œå‰ç«¯è¯·æ±‚wasmæ–‡ä»¶æ—¶ï¼Œéœ€è¦åœ¨request headerä¸­æ”¾å…¥æµè§ˆå™¨æ”¯æŒçš„å‹ç¼©æ¨¡å¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Accept-Encoding: gzip, deflate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥ç€ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åå°±å¯ä»¥ç»™å‡ºæœåŠ¡ç«¯ä¹Ÿæ”¯æŒçš„å‹ç¼©æ¨¡å¼ï¼Œå¹¶å‘Šè¯‰æµè§ˆå™¨æœåŠ¡ç«¯å°†ä¼šç”¨ä»€ä¹ˆå‹ç¼©æ¨¡å¼ã€‚&lt;/p>
&lt;p>è·Ÿæµè§ˆå™¨é€šä¿¡çš„æ–¹å¼å°±æ˜¯å°†ä¿¡æ¯å¡åˆ°respone headeré‡Œé¢ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Content-Encoding: gzip
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ ·å°±å¼€å¯GZIPäº†ã€‚&lt;/p>
&lt;p>ç„¶åï¼Œå°±æ˜¯æµè§ˆå™¨æ¥æ”¶åˆ°responseçš„bodyå’Œheaderï¼ŒçŸ¥é“åç«¯ä½¿ç”¨gzipå‹ç¼©çš„ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šè‡ªåŠ¨ç”¨gzipæ¥è§£å‹ï¼Œæ‹¿åˆ°å®Œæ•´çš„æ•°æ®äº†ã€‚&lt;/p>
&lt;h3 id="æœåŠ¡ç«¯æ”¯æŒ">æœåŠ¡ç«¯æ”¯æŒ
&lt;/h3>&lt;p>æˆ–è®¸ä½ ä¼šæƒ³é—®ï¼Œæµè§ˆå™¨èƒ½è‡ªåŠ¨è§£å¯†ï¼Œé‚£æœåŠ¡ç«¯æ€ä¹ˆè‡ªåŠ¨åŠ å¯†å‘¢ï¼Ÿè¦åç«¯å†™ä»£ç è®©æ–‡ä»¶åŠ å¯†å—ï¼Ÿ&lt;/p>
&lt;p>é‚£å½“ç„¶ä¸æ˜¯äº†ï¼Œç›´æ¥è®©http serveræ¥å®Œæˆè¿™ä¸ªæ“ä½œã€‚æ­¤å¤„ä»¥è€³ç†Ÿèƒ½è¯¦çš„Nginxä¸ºä¾‹ã€‚&lt;/p>
&lt;p>æœ€ç®€å•çš„å°±æ˜¯ä¸€è¡Œé…ç½®å¼€å¯gzipäº†ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">gzip on;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¹Ÿå¯ä»¥æŒ‡å®šgzipçš„ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚å¯ä»¥åŠ å¯†çš„ç±»å‹ã€æœ€å°åŠ å¯†é•¿åº¦ç­‰ç­‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">gzip on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gzip_types text/plain application/xml;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gzip_proxied no-cache no-store private expired auth;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gzip_min_length 1000;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ›´å¤šçš„http serveré…ç½®ï¼Œå¯ä»¥å»å„è‡ªå®˜æ–¹æ–‡æ¡£æŸ¥é˜…ã€‚&lt;/p>
&lt;h2 id="ç‰©ç†å±‚é¢">ç‰©ç†å±‚é¢
&lt;/h2>&lt;p>ä½ å¯èƒ½ä¼šæƒŠå¥‡ï¼Œä»€ä¹ˆç‰©ç†å±‚é¢ï¼Ÿï¼&lt;/p>
&lt;p>æ²¡é”™ï¼ŒçœŸå°±æ˜¯ç‰©ç†å±‚é¢â€”â€”ç›´æ¥å¯¹wasmæ–‡ä»¶è¿›è¡Œgzipç‰©ç†å‹ç¼©ï¼å“ˆå“ˆï¼Œè¿™ä¸ªæ–¹æ³•ä¹ŸçœŸæ˜¯ç»äº†ï¼Œæˆ‘ä¹‹å‰åœ¨Goå¼€å‘wasmæ—¶ï¼Œå¯»æ‰¾å‡å°‘ä½“ç§¯çš„æ—¶å€™å‘ç°çš„ï¼Œå¦‚æœä½ çš„wasmå·²ç»ä¼˜åŒ–å¾—ç©·é€”æœ«è·¯äº†ï¼Œä¸å¦¨å¤§èƒ†è¯•è¯•è¿™ä¸ªæ–¹æ¡ˆã€‚ğŸ˜†&lt;/p>
&lt;p>è¿˜è®°å¾—ä¸Šé¢ç« èŠ‚â€œç½‘ç»œå±‚é¢â€œä¸­ï¼Œæœ‰ä¸ªé—®é¢˜å°±æ˜¯æ˜¯å¦éœ€è¦æ‰‹åŠ¨å‹ç¼©ï¼Œé‚£ä¹ˆè¿™é‡Œå°±æ˜¯å…¨ç¨‹æ‰‹åŠ¨å‹ç¼©å’Œè§£å‹ç¼©äº†ï¼Œå“ˆå“ˆã€‚&lt;/p>
&lt;h3 id="ç‰©ç†å‹ç¼©">ç‰©ç†å‹ç¼©
&lt;/h3>&lt;p>é¦–å…ˆï¼Œæ˜¯å¯¹wasmæ–‡ä»¶è¿›è¡Œç‰©ç†å±‚é¢çš„gzipå‹ç¼©ï¼Œæ­¤å¤„å…ˆä½¿ç”¨åŸå§‹çš„wasmï¼ˆ23347bï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">gzip -c pkg/hello_wasm_bg.wasm &amp;gt; pkg/output.gz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶åï¼Œçœ‹ä¸€ä¸‹å…¶ä½“ç§¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ wc -c pkg/output.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">10403&lt;/span> pkg/output.gz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ•ˆæœå“ç¾¤ï¼Œä»23347bå‡å°‘åˆ°äº†10403bï¼&lt;/p>
&lt;p>ç„¶åæ¥æŠŠä¸Šè¿°â€œä»£ç å±‚é¢â€çš„ä¼˜åŒ–æ¥ä¸€éï¼Œçœ‹ä¸€ä¸‹æœ€åçš„ä½“ç§¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ wc -c pkg/output.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">9237&lt;/span> pkg/output.gz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ•ˆæœæ›´åŠ å“ç¾¤äº†ï¼Œä»19871bå‡å°‘åˆ°äº†9237bäº†ï¼&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œæ­¤å¤„å°±æ˜¯å¯¹wasmæ–‡ä»¶è¿›è¡Œç‰©ç†å‹ç¼©å¹¶å­˜å‚¨ï¼Œç„¶åæµè§ˆå™¨è¯·æ±‚æ—¶ï¼Œç›´æ¥è¯·æ±‚åˆ°&lt;code>.gz&lt;/code>æ–‡ä»¶ã€‚&lt;/p>
&lt;h3 id="ç‰©ç†è§£å‹">ç‰©ç†è§£å‹
&lt;/h3>&lt;p>æµè§ˆå™¨æ‹¿åˆ°&lt;code>.gz&lt;/code>æ–‡ä»¶åï¼Œéœ€è¦ç‰©ç†è§£å‹ã€‚&lt;/p>
&lt;p>è¿™é‡Œæ¨èä½¿ç”¨&lt;code>pako&lt;/code>è¿™ä¸ªå‰ç«¯åº“ï¼Œå¯¹&lt;code>.gz&lt;/code>æ–‡ä»¶è¿›è¡Œè§£å‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">async&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">gunzipWasm&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">await&lt;/span> &lt;span class="nx">fetch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;target.gz&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nx">buffer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">await&lt;/span> &lt;span class="nx">pako&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ungzip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kr">await&lt;/span> &lt;span class="nx">res&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">arrayBuffer&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// A fetched response might be decompressed twice on Firefox.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// See https://bugzilla.mozilla.org/show_bug.cgi?id=610679
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">buffer&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="mh">0x1F&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">buffer&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="mh">0x8B&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nx">buffer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">pako&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ungzip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">buffer&lt;/span>&lt;span class="p">)}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">buffer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚&lt;/p>
&lt;h2 id="buffå åŠ ">BUFFå åŠ 
&lt;/h2>&lt;p>æ­¤å¤„ç›´æ¥å°†ä¸Šè¿°æ‰€æœ‰æ–¹æ³•éƒ½ç”¨èµ·æ¥ï¼Œç›´æ¥å åŠ buffï¼Œæ¥çœ‹çœ‹å½“å‰ï¼ˆæœ¬ç³»åˆ—æ–‡ç« ç§¯ç´¯çš„ï¼‰è¿™ä¸ªæ¡ˆä¾‹èƒ½å‡å°‘å¤šå°‘ä½“ç§¯ã€‚åœ¨â€œç‰©ç†å±‚é¢â€ç« èŠ‚ä¸­ï¼Œå·²ç»ç´¯åŠ é™¤äº†â€œç½‘ç»œå±‚é¢â€çš„buffäº†ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨å…¶ç»“æœã€‚è€Œâ€œç½‘ç»œå±‚é¢â€ç« èŠ‚ä¸­ï¼Œä»¥gzipæ¥å‹ç¼©ï¼Œå°†gzipçš„å‹ç¼©ç‡ä»¥40%æ¥ä¼°ç®—ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆæœ€ç»ˆè¯¥æ¡ˆä¾‹çš„wasmä½“ç§¯å°†åœ¨5542bï¼Œå‹ç¼©ç‡å¤§çº¦åœ¨77%ï¼&lt;/p>
&lt;p>å½“ç„¶ï¼Œè¿˜è¦ç®—ä¸Šä¸€ä¸ªåˆå§‹çš„è¯­è¨€buffâ€”â€”Rustï¼Œä½¿ç”¨Rustæœ¬èº«å°±å·²ç»å¯¼è‡´wasmæ–‡ä»¶ä½“ç§¯å¾ˆå°äº†ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“
&lt;/h2>&lt;p>æœ¬ç‰‡æ–‡ç« ä¸­ï¼Œä»ä»£ç å±‚é¢ã€ç½‘ç»œå±‚é¢ã€ç‰©ç†å±‚é¢å…±ä¸‰ä¸ªå±‚é¢ä»‹ç»äº†å¯¹wasmæ–‡ä»¶çš„ä½“ç§¯ä¼˜åŒ–æ–¹æ¡ˆï¼Œå…¶ä¸­å…±æœ‰å››ä¸ªæ–¹æ¡ˆã€‚&lt;/p>
&lt;p>æœ€åï¼Œå½“å‰ï¼ˆæœ¬ç³»åˆ—æ–‡ç« ç§¯ç´¯çš„ï¼‰è¯¥æ¡ˆä¾‹å åŠ äº†æ‰€æœ‰buffä¹‹åï¼Œèƒ½å¤Ÿå‡å°‘77%çš„ä½“ç§¯ï¼ŒçœŸçš„æ„Ÿè§‰æŒºæ£’çš„äº†ï¼Œå“ˆå“ˆã€‚&lt;/p>
&lt;p>å¸Œæœ›èƒ½å¤Ÿå¯¹å„ä½æœ‰æ‰€å¸®åŠ©ã€‚&lt;/p></description></item><item><title>ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(ä¸‰)â€”â€”Rustä¸JSäº¤äº’</title><link>https://hunterji.com/zh-cn/post/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E4%B8%89rust%E4%B8%8Ejs%E4%BA%A4%E4%BA%92/</link><pubDate>Tue, 27 Jun 2023 00:11:12 +0000</pubDate><guid>https://hunterji.com/zh-cn/post/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E4%B8%89rust%E4%B8%8Ejs%E4%BA%A4%E4%BA%92/</guid><description>&lt;img src="https://hunterji.com/img/cover.jpg" alt="Featured image of post ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(ä¸‰)â€”â€”Rustä¸JSäº¤äº’" />&lt;h2 id="å‰è¨€">å‰è¨€
&lt;/h2>&lt;p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« &lt;a class="link" href="https://github.com/Kuari/Blog/issues/73" target="_blank" rel="noopener"
>ã€Šä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(äºŒ)â€”â€”DOMå’Œç±»å‹è½¬æ¢ã€‹&lt;/a>ä¸­ï¼Œæè¿°äº†ä½¿ç”¨Rustæ“ä½œDOMï¼Œå¹¶å®ç°Rustä¸JSç±»å‹è½¬æ¢çš„å¤šç§æ–¹æ³•ã€‚&lt;/p>
&lt;p>åœ¨å¼€å‘ Web åº”ç”¨ç¨‹åºæ—¶ï¼Œä½¿ç”¨ Rust ç¼–å†™çš„ Wasm æ¨¡å—å¯ä»¥æä¾›æ›´é«˜çš„æ€§èƒ½å’Œæ›´å¥½çš„å®‰å…¨æ€§ã€‚ä½†æ˜¯ï¼Œä¸ºäº†ä¸ç°æœ‰çš„ JavaScript ä»£ç é›†æˆï¼Œå¿…é¡»å®ç° Rust ä¸ JS ä¹‹é—´çš„äº¤äº’ã€‚Rust ä¸ JS äº¤äº’çš„ä¸»è¦ç›®çš„æ˜¯å°†ä¸¤ç§è¯­è¨€çš„ä¼˜åŠ¿ç»“åˆèµ·æ¥ï¼Œä»¥å®ç°æ›´å¥½çš„ Web åº”ç”¨ç¨‹åºã€‚&lt;/p>
&lt;p>åŸºäºä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼ŒRustä¸JSçš„ç±»å‹è½¬æ¢çš„å¤šç§æ–¹æ³•ï¼Œæœ¬ç¯‡æ–‡ç« ç»§ç»­æ·±å…¥Rustä¸JSçš„äº¤äº’ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼ŒRustä¸JSçš„ç±»å‹è½¬æ¢ï¼Œå¯ä»¥å®ç°å˜é‡çš„ä¼ é€’ï¼Œé‚£ä¹ˆå˜é‡æ˜¯è¦ç”¨åœ¨å“ªé‡Œå‘¢ï¼Ÿé‚£å¿…ç„¶æ˜¯å‡½æ•°äº†ï¼&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œæœ¬ç¯‡æ–‡ç« æ¥è®²è¿°ä¸€ä¸‹Rustä¸JSçš„å‡½æ•°ç›¸äº’è°ƒç”¨ï¼ŒåŸºäºæ­¤ï¼Œå¯ä»¥å®ç°å¤§é‡æ—¥å¸¸åŠŸèƒ½å¼€å‘ã€‚&lt;/p>
&lt;p>å¹¶ä¸”ï¼Œè¿˜å°†ä¼šè®²è¿°ä¸€ä¸‹ï¼Œå¦‚ä½•å¯¼å‡ºRustçš„structç»™JSè°ƒç”¨ã€‚&lt;/p>
&lt;p>æ˜¯çš„ï¼Œæ²¡é”™ï¼Œåœ¨JSè°ƒç”¨Rustçš„structï¼ä¸€å¼€å§‹çœ‹åˆ°è¿™ä¸ªåŠŸèƒ½çš„æ—¶å€™ï¼Œæˆ‘çš„è„‘å­æ˜¯æœ‰ç‚¹ç‚¸è£‚çš„&amp;hellip;&amp;hellip;ğŸ˜³&lt;/p>
&lt;p>æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œå°†åŸºäºä¸Šä¸€ç¯‡æ–‡ç« ä¸­åˆ›å»ºçš„é¡¹ç›®æ¥ç»§ç»­å¼€å‘ã€‚&lt;/p>
&lt;p>æºç ï¼š&lt;a class="link" href="https://github.com/Kuari/hello-wasm" target="_blank" rel="noopener"
>github.com/Kuari/hello-wasm&lt;/a>&lt;/p>
&lt;h2 id="ç¯å¢ƒ">ç¯å¢ƒ
&lt;/h2>&lt;ul>
&lt;li>Rust 1.70.0&lt;/li>
&lt;li>wasm-bindgen 0.2.87&lt;/li>
&lt;/ul>
&lt;h2 id="å‡½æ•°çš„ç›¸äº’è°ƒç”¨">å‡½æ•°çš„ç›¸äº’è°ƒç”¨
&lt;/h2>&lt;h3 id="jsè°ƒç”¨rustå‡½æ•°">JSè°ƒç”¨Rustå‡½æ•°
&lt;/h3>&lt;p>å…¶å®ï¼Œåœ¨æœ¬ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ä¸­ï¼Œå°±æ˜¯ä½¿ç”¨çš„JSè°ƒç”¨Rustå‡½æ•°ä½œä¸ºæ¡ˆä¾‹æ¥æ¼”ç¤ºçš„ï¼Œè¿™é‡Œä¾ç„¶ä»¥æ­¤ä¸ºä¾‹ï¼Œä¸»è¦è®²ä¸€ä¸‹è¦ç‚¹ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼Œå£°æ˜ä¸€ä¸ªRustå‡½æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">wasm_bindgen&lt;/span>::&lt;span class="n">prelude&lt;/span>::&lt;span class="o">*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">i32&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ­¤å¤„éœ€è¦æ³¨æ„çš„è¦ç‚¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>å¼•å…¥&lt;code>wasm_bindgen&lt;/code>&lt;/li>
&lt;li>å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨&lt;code>pub&lt;/code>å£°æ˜&lt;/li>
&lt;li>åœ¨å‡½æ•°ä¸Šä½¿ç”¨&lt;code>#[wasm_bindgen]&lt;/code>å®æ¥å°†Rustå‡½æ•°å¯¼å‡ºä¸ºWebAssemblyæ¨¡å—çš„å‡½æ•°&lt;/li>
&lt;/ul>
&lt;p>æ¥ç€ï¼Œç¼–è¯‘æˆwasmæ–‡ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">wasm-pack build --target web
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶åï¼Œåœ¨JSä¸­è°ƒç”¨è¯¥å‡½æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;module&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">import&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">add&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;./pkg/hello_wasm.js&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">run&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">await&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`the result from rust is: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">run&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœ€åï¼Œå¯åŠ¨http serverï¼Œåœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­å¯ä»¥çœ‹åˆ°&lt;code>the result from rust is: 3&lt;/code>ï¼Œè¡¨æ˜è°ƒç”¨æˆåŠŸï¼&lt;/p>
&lt;h3 id="rustè°ƒç”¨jså‡½æ•°">Rustè°ƒç”¨JSå‡½æ•°
&lt;/h3>&lt;p>###1 æŒ‡å®šJSå¯¹è±¡&lt;/p>
&lt;p>åœ¨Rustä¸­è°ƒç”¨JSå‡½æ•°ï¼Œéœ€è¦è¿›è¡ŒæŒ‡å®šJSå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¾—æ˜ç¡®å‘Šè¯‰Rustï¼Œè¿™ä¸ªJSå‡½æ•°æ˜¯ä»JSå“ªå„¿æ‹¿æ¥çš„ç”¨çš„ã€‚&lt;/p>
&lt;p>ä¸»è¦åœ¨äºä¸‹é¢ä¸¤ä¸ªæ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;em>&lt;strong>js_namespace&lt;/strong>&lt;/em>: æ˜¯ä¸€ä¸ªå¯é€‰çš„å±æ€§ï¼Œç”¨äºæŒ‡å®šä¸€ä¸ªJavaScriptå‘½åç©ºé—´ï¼Œå…¶ä¸­åŒ…å«å°†è¦åœ¨wasmæ¨¡å—ä¸­å¯¼å‡ºçš„å‡½æ•°ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š&lt;code>js_namespace&lt;/code>ï¼Œåˆ™æ‰€æœ‰çš„å¯¼å‡ºå‡½æ•°å°†è¢«æ”¾ç½®åœ¨å…¨å±€å‘½åç©ºé—´ä¸‹ã€‚&lt;/li>
&lt;li>&lt;em>&lt;strong>js_name&lt;/strong>&lt;/em>: æ˜¯å¦ä¸€ä¸ªå¯é€‰å±æ€§ï¼Œå®ƒç”¨äºæŒ‡å®šJavaScriptä¸­çš„å‡½æ•°åç§°ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š&lt;code>js_name&lt;/code>ï¼Œåˆ™å¯¼å‡ºå‡½æ•°çš„åç§°å°†ä¸Rustä¸­çš„å‡½æ•°åç§°ç›¸åŒã€‚&lt;/li>
&lt;/ul>
&lt;p>###2 JSåŸç”Ÿå‡½æ•°&lt;/p>
&lt;p>å¯¹äºä¸€äº›JSåŸç”Ÿå‡½æ•°ï¼Œåœ¨Rustä¸­ï¼Œéœ€è¦å»å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è®²çš„&lt;code>console.log()&lt;/code>å‡½æ•°ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—å¥½éº»çƒ¦å•Šï¼&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œä½ æƒ³ç›´æ¥åœ¨Rustä¸­è°ƒç”¨JSåŸç”Ÿå‡½æ•°å—ï¼Ÿï¼&lt;/p>
&lt;p>æ­¤å¤„ï¼Œå°±ä»¥&lt;code>console.log()&lt;/code>å‡½æ•°ä¸ºä¾‹ï¼Œç›´æ¥åœ¨Rustä¸­å¼•å…¥å¹¶è°ƒç”¨ï¼Œå…å»æ›¿ä»£æ–¹æ¡ˆçš„çƒ¦æ¼ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼Œç»™å‡ºRustä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">extern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;C&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[wasm_bindgen(js_namespace = console)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">message&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">call_js_func&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;hello, javascript!&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚ä¸Šä»£ç ä¸­ï¼Œ&lt;code>call_js_func&lt;/code>å‡½æ•°ï¼Œé¡¾åæ€ä¹‰ï¼Œæ­¤å¤„æ˜¯è°ƒç”¨äº†jså‡½æ•°ï¼Œå¹¶ä¼ å…¥å‚æ•°&lt;code>hello, javascript!&lt;/code>ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œ&lt;code>call_js_func&lt;/code>å‡½æ•°ä¸Šæ–¹çš„ä»£ç ï¼Œæˆ‘ä»¬æ¥ä¸€æ­¥æ­¥è§£æä¸€ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>ç¬¬ä¸€è¡Œä»£ç &lt;code>#[wasm_bindgen]&lt;/code>æ˜¯Rustçš„å±æ€§ï¼Œå®ƒå‘Šè¯‰ç¼–è¯‘å™¨å°†å‡½æ•°å¯¼å‡ºä¸ºWebAssemblyæ¨¡å—&lt;/li>
&lt;li>&lt;code>extern &amp;quot;C&amp;quot;&lt;/code>æ˜¯Cè¯­è¨€è°ƒç”¨çº¦å®šï¼Œå®ƒå‘Šè¯‰Rustç¼–è¯‘å™¨å°†å‡½æ•°å¯¼å‡ºä¸ºCè¯­è¨€å‡½æ•°&lt;/li>
&lt;li>&lt;code>#[wasm_bindgen(js_namespace = console)]&lt;/code>å‘Šè¯‰ç¼–è¯‘å™¨å°†å‡½æ•°ç»‘å®šåˆ°JavaScriptä¸­çš„consoleå¯¹è±¡&lt;/li>
&lt;li>&lt;code>fn log(message: &amp;amp;str)&lt;/code>æ˜¯ä¸€ä¸ªRustå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œå¹¶å°†å…¶æ‰“å°åˆ°JavaScriptä¸­çš„consoleå¯¹è±¡ä¸­&lt;/li>
&lt;/ol>
&lt;p>æ­¤å¤„ä¸JSäº¤äº’çš„å…³é”®æ˜¯&lt;code>js_namespace&lt;/code>ã€‚åœ¨Rustä¸­ï¼Œ&lt;code>js_namespace&lt;/code>æ˜¯ç”¨äºæŒ‡å®šJavaScriptå‘½åç©ºé—´çš„å±æ€§ã€‚åœ¨WebAssemblyä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒå°†å‡½æ•°ç»‘å®šåˆ°JavaScriptä¸­çš„å¯¹è±¡ä¸Šã€‚&lt;/p>
&lt;p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ&lt;code>#[wasm_bindgen(js_namespace = console)]&lt;/code>å‘Šè¯‰ç¼–è¯‘å™¨å°†å‡½æ•°ç»‘å®šåˆ°JavaScriptä¸­çš„&lt;code>console&lt;/code>å¯¹è±¡ã€‚è¿™æ„å‘³ç€åœ¨JSä¸­ä½¿ç”¨&lt;code>console.log()&lt;/code>å‡½æ•°æ¥è°ƒç”¨Rustä¸­çš„&lt;code>log()&lt;/code>å‡½æ•°ã€‚&lt;/p>
&lt;p>å› æ­¤ï¼Œç±»ä¼¼çš„åŸç”Ÿå‡½æ•°ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•æ¥å®ç°è°ƒç”¨ã€‚&lt;/p>
&lt;p>æœ€åï¼Œæˆ‘ä»¬åœ¨JSä¸­è°ƒç”¨ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;module&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">import&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">call_js_func&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;./pkg/hello_wasm.js&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">run&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">await&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">call_js_func&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">run&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­çœ‹åˆ°&lt;code>hello, javascript!&lt;/code>ã€‚å¦™å•Šï¼&lt;/p>
&lt;p>å…¶å®å¯¹äº&lt;code>console.log()&lt;/code>è€Œè¨€ï¼Œè¿˜æœ‰å¦ä¸€ç§è°ƒç”¨æ–¹å¼ï¼Œé‚£å°±æ˜¯ä½¿ç”¨&lt;code>js_namespace&lt;/code>å’Œ&lt;code>js_name&lt;/code>åŒæ—¶æŒ‡å®šã€‚&lt;/p>
&lt;p>æˆ–è®¸ï¼Œä½ ä¼šé—®ï¼Œè¿™æœ‰ä»€ä¹ˆä¸åŒå—ï¼Ÿæ˜¯çš„ï¼Œè¿™æœ‰äº›ä¸åŒã€‚&lt;/p>
&lt;p>ä¸çŸ¥é“ä½ æ˜¯å¦å‘ç°ï¼Œå½“å‰è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼ŒæŒ‡å®šäº†&lt;code>js_namespace&lt;/code>ä¸º&lt;code>console&lt;/code>ï¼Œä½†æ˜¯çœŸå®æ‰§è¡Œçš„å‡½æ•°æ˜¯&lt;code>log()&lt;/code>ï¼Œé‚£ä¹ˆè¿™ä¸ª&lt;code>log&lt;/code>å‡½æ•°çš„æŒ‡å®šï¼Œå…¶å®æ˜¯ä½“ç°åœ¨Rustä¸­åŒæ ·çš„å‡½æ•°å&lt;code>log&lt;/code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥æ¡ˆä¾‹çš„&lt;code>log()&lt;/code>å°±æ˜¯&lt;code>console.log()&lt;/code>ä¸­çš„&lt;code>log()&lt;/code>ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥æ¢ä¸ªåå­—çœ‹çœ‹ï¼Œå°†åŸæ¥çš„&lt;code>log()&lt;/code>æ¢æˆ&lt;code>log2()&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">extern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;C&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[wasm_bindgen(js_namespace = console)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">log2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">message&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">call_js_func&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">log2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;hello, javascript!&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶åç¼–è¯‘åå»æ§åˆ¶å°çœ‹çœ‹ï¼Œå°±ä¼šçœ‹åˆ°æŠ¥é”™ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">TypeError: console.log2 is not a function
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å› æ­¤ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨&lt;code>js_namespace&lt;/code>å’Œ&lt;code>js_name&lt;/code>ç»“åˆçš„æ–¹å¼ï¼Œåœ¨æ­¤å¤„æ˜¯å¯ä»¥è¿›è¡Œè‡ªå®šä¹‰å‡½æ•°åçš„ã€‚&lt;/p>
&lt;p>çœ‹ä¸€ä¸‹Rustä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">extern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;C&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[wasm_bindgen(js_namespace = console)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">message&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[wasm_bindgen(js_namespace = console, js_name = log)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">log_str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">message&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">call_js_func&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">log_str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;hello, javascript!&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ­¤å¤„ï¼Œé‡æ–°å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°&lt;code>log_str&lt;/code>ï¼Œä½†æ˜¯å…¶æŒ‡å®šäº†&lt;code>js_namespace = console&lt;/code>å’Œ&lt;code>js_name = log&lt;/code>ï¼Œé‚£ä¹ˆæ­¤å¤„ï¼Œå°±å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„å‡½æ•°åã€‚&lt;/p>
&lt;p>ç›´æ¥ç¼–è¯‘åï¼Œåœ¨æ§åˆ¶å°çœ‹ä¸€ä¸‹ï¼Œå¯ä»¥ç›´æ¥çœ‹åˆ°æ­£å¸¸è¾“å‡ºï¼š&lt;code>hello, javascript!&lt;/code>ã€‚&lt;/p>
&lt;p>æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š&lt;code>js_name&lt;/code>ï¼Œåˆ™ Rust å‡½æ•°åç§°å°†ç”¨ä½œ JS å‡½æ•°åç§°ã€‚&lt;/p>
&lt;p>###3 è‡ªå®šä¹‰JSå‡½æ•°&lt;/p>
&lt;p>åœ¨ä¸€å®šåœºæ™¯ä¸‹ï¼Œéœ€è¦ä½¿ç”¨Rustè°ƒç”¨JSå‡½æ•°ï¼Œæ¯”å¦‚å¯¹äºä¸€äº›å¯¹äºJSè€Œè¨€æ›´æœ‰ä¼˜åŠ¿çš„åœºæ™¯â€”â€”ç”¨JSæ“ä½œDOMï¼Œç”¨Rustè®¡ç®—ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶&lt;code>index.js&lt;/code>ï¼Œå†™å…¥ä¸€ä¸ªå‡½æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">addIt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">m&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">n&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">m&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">n&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“å‰çš„æ–‡ä»¶ç»“æ„å…³ç³»å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ Cargo.lock
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ Cargo.toml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ index.js
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ pkg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚Â Â  â”œâ”€â”€ README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚Â Â  â”œâ”€â”€ hello_wasm.d.ts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚Â Â  â”œâ”€â”€ hello_wasm.js
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚Â Â  â”œâ”€â”€ hello_wasm_bg.wasm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚Â Â  â”œâ”€â”€ hello_wasm_bg.wasm.d.ts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚Â Â  â””â”€â”€ package.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ src
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚Â Â  â””â”€â”€ lib.rs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â””â”€â”€ target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â”œâ”€â”€ CACHEDIR.TAG
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â”œâ”€â”€ debug
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â”œâ”€â”€ release
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â””â”€â”€ wasm32-unknown-unknown
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…¶ä¸­ï¼Œ&lt;code>index.js&lt;/code>å’Œ&lt;code>lib.rs&lt;/code>ï¼Œä»¥åŠ&lt;code>hello_wasm_bg.wasm&lt;/code>éƒ½æ˜¯ä¸åœ¨åŒä¸€çº§åˆ«çš„ï¼Œ&lt;code>index.js&lt;/code>éƒ½åœ¨å…¶å®ƒä¸¤ä¸ªæ–‡ä»¶çš„ä¸Šä¸€çº§ã€‚è®°ä½è¿™ä¸ªæœºæ„å…³ç³»ï¼&lt;/p>
&lt;p>ç„¶åï¼Œåœ¨&lt;code>lib.rs&lt;/code>ä¸­ï¼ŒæŒ‡å®šå‡½æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">##&lt;span class="p">.&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">js&lt;/span>&lt;span class="s">&amp;#34;)]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">extern &amp;#34;&lt;/span>&lt;span class="n">C&lt;/span>&lt;span class="s">&amp;#34; {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> fn addIt(m: i32, n: i32) -&amp;gt; i32;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…¶ä¸­ï¼Œ&lt;code>raw_module = &amp;quot;../index.js&amp;quot;&lt;/code>çš„æ„æ€æ˜¯ï¼ŒæŒ‡å®šå¯¹åº”çš„&lt;code>index.js&lt;/code>æ–‡ä»¶ï¼Œå¤§å®¶åº”è¯¥æ¸…æ¥šï¼Œæ­¤å¤„æŒ‡å®šçš„æ˜¯åˆšåˆšåˆ›å»ºçš„&lt;code>index.js&lt;/code>ã€‚&lt;code>raw_module&lt;/code>çš„ä½œç”¨å°±æ˜¯ç”¨æ¥æŒ‡å®šjsæ–‡ä»¶çš„ã€‚&lt;/p>
&lt;p>è¿™æ®µä»£ç åœ¨å‰ç«¯ï¼Œå¯ä»¥ç­‰åŒäºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">addIt&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;../index.js&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ ·åœ¨å‰ç«¯éƒ½ä¸ç”¨å¼•å…¥äº†ï¼Œç›´æ¥åœ¨Rustä¸­å¼•å…¥äº†ï¼Œæ„Ÿè§‰è¿˜æœ‰ç‚¹å¥‡å¦™çš„ã€‚&lt;/p>
&lt;p>æ¥ç€ï¼Œåœ¨Rustè°ƒç”¨è¯¥å‡½æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">call_js_func&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">i32&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">addIt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœ€åï¼Œåœ¨å‰ç«¯è°ƒç”¨ï¼Œç¼–è¯‘åï¼Œåœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­å¯ä»¥çœ‹åˆ°è¾“å‡ºç»“æœäº†ï¼&lt;/p>
&lt;p>æ€»ç»“ä¸€ä¸‹ï¼Œè¿™é‡Œæœ‰å‡ ä¸ªæ³¨æ„ç‚¹ï¼š&lt;/p>
&lt;ol>
&lt;li>JSçš„å‡½æ•°å¿…é¡»è¦exportï¼Œå¦åˆ™å°†æ— æ³•è°ƒç”¨ï¼›&lt;/li>
&lt;li>&lt;code>raw_module&lt;/code>åªèƒ½ç”¨æ¥æŒ‡å®šç›¸å¯¹è·¯å¾„ï¼Œå¹¶ä¸”ï¼Œå¤§å®¶å¯ä»¥åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­æ³¨æ„åˆ°ï¼Œæ­¤å¤„çš„&lt;code>../&lt;/code>çš„ç›¸å¯¹è·¯å¾„ï¼Œå…¶å®æ˜¯ä»¥wasmæ–‡ä»¶è€Œè¨€çš„ç›¸å¯¹è·¯å¾„ï¼Œè¿™é‡Œä¸€å®šè¦æ³¨æ„å‘€ï¼&lt;/li>
&lt;/ol>
&lt;h2 id="jsè°ƒç”¨rustçš„struct">JSè°ƒç”¨Rustçš„struct
&lt;/h2>&lt;p>ç°åœ¨ï¼Œæ¥ç‚¹ç‚¸è£‚çš„ï¼ŒJSè°ƒç”¨Rustçš„structï¼Ÿï¼&lt;/p>
&lt;p>JSä¸­è¿structéƒ½æ²¡æœ‰ï¼Œè¿™ç©æ„å„¿å¯¼å‡ºæ¥ä¼šæ˜¯ä»€ä¹ˆæ ·ï¼Œå¾—æ€ä¹ˆåœ¨JSä¸­è°ƒç”¨å‘¢ï¼Ÿï¼&lt;/p>
&lt;p>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªstructï¼Œå¹¶ä¸”å£°æ˜å‡ ä¸ªæ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">User&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>: &lt;span class="nb">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>: &lt;span class="kt">u32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">User&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[wasm_bindgen(constructor)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>: &lt;span class="nb">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>: &lt;span class="kt">u32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">User&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">User&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">print_user&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;name is : &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">, age is : &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">as_str&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">set_age&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>: &lt;span class="kt">u32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ­¤å¤„ï¼Œå£°æ˜äº†ä¸€ä¸ªstructåä¸º&lt;code>User&lt;/code>ï¼ŒåŒ…å«&lt;code>name&lt;/code>å’Œ&lt;code>age&lt;/code>ä¸¤ä¸ªå­—æ®µï¼Œå¹¶å£°æ˜äº†&lt;code>new&lt;/code>ã€&lt;code>print_user&lt;/code>å’Œ&lt;code>set_age&lt;/code>æ–¹æ³•ã€‚&lt;/p>
&lt;p>å…¶ä¸­è¿˜æœ‰ä¸€ä¸ªæœªè§è¿‡çš„&lt;code>#[wasm_bindgen(constructor)]&lt;/code>ï¼Œ&lt;code>constructor&lt;/code>ç”¨äºæŒ‡ç¤ºè¢«ç»‘å®šçš„å‡½æ•°å®é™…ä¸Šåº”è¯¥è½¬æ¢ä¸ºè°ƒç”¨ JavaScript ä¸­çš„ new è¿ç®—ç¬¦ã€‚æˆ–è®¸ä½ è¿˜ä¸å¤ªæ¸…æ™°ï¼Œç»§ç»­çœ‹ä¸‹å»ï¼Œä½ å°±ä¼šæ˜ç™½äº†ã€‚&lt;/p>
&lt;p>æ¥ç€ï¼Œåœ¨JSä¸­è°ƒç”¨è¿™ä¸ªstructï¼Œå’Œå…¶æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;module&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">addIt2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">m&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">n&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">m&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">n&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">import&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">User&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;./pkg/hello_wasm.js&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">run&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">await&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">user&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">User&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;kuari&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">user&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">set_age&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">21&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">user&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">print_user&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">run&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„ç”¨æ³•å°±å¾ˆç†Ÿæ‚‰äº†ï¼&lt;/p>
&lt;p>å¤§æ¦‚æƒ³ä¸€ä¸‹ï¼Œåœ¨Rustä¸­è¦å¦‚ä½•è°ƒç”¨ï¼Ÿä¹Ÿå°±æ˜¯ç›´æ¥newä¸€ä¸ªâ€”â€”&lt;code>User::new('kuari', 20)&lt;/code>ã€‚&lt;/p>
&lt;p>æ­¤å¤„åœ¨JSä¸­ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå…ˆnewä¸€ä¸ªï¼&lt;/p>
&lt;p>ç„¶åå¾ˆè‡ªç„¶åœ°è°ƒç”¨structçš„æ–¹æ³•ã€‚&lt;/p>
&lt;p>ç¼–è¯‘åï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°è¾“å‡ºï¼š&lt;code>name is : kuari, age is : 21&lt;/code>ã€‚&lt;/p>
&lt;p>å…¶å®ï¼Œæˆ–è®¸å¤§å®¶ä¼šå¾ˆå¥½å¥‡ï¼Œèµ·ç æˆ‘æ˜¯éå¸¸å¥½å¥‡çš„ï¼ŒRustçš„structåœ¨JSä¸­åˆ°åº•æ˜¯ä¸€ä¸ªæ€æ ·çš„å­˜åœ¨å‘¢ï¼Ÿ&lt;/p>
&lt;p>è¿™é‡Œç›´æ¥æ·»åŠ ä¸€ä¸ª&lt;code>console.log(user)&lt;/code>ï¼Œå°±å¯ä»¥åœ¨è¾“å‡ºçœ‹åˆ°ã€‚é‚£ä¹ˆåˆ°åº•åœ¨JSä¸­æ˜¯ä¸€ä¸ªæ€æ ·çš„å­˜åœ¨å‘¢ï¼Ÿè¯·å„ä½åŠ¨æ‰‹æ‰“å°ä¸€ä¸‹çœ‹çœ‹å§ï¼:P&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“
&lt;/h2>&lt;p>æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œä¸»è¦è®²è¿°äº†Rustä¸JSçš„äº¤äº’ï¼Œä½“ç°åœ¨Rustä¸JSçš„ç›¸äº’è°ƒç”¨ï¼Œè¿™æ˜¯å»ºç«‹åœ¨&lt;a class="link" href="https://github.com/Kuari/Blog/issues/73" target="_blank" rel="noopener"
>ä¸Šä¸€ç¯‡æ–‡ç« &lt;/a>ä¸­ç±»å‹è½¬æ¢çš„åŸºç¡€ä¸Šçš„ã€‚&lt;/p>
&lt;p>Rustä¸JSçš„å‡½æ•°ç›¸äº’è°ƒç”¨çš„å­¦ä¹ æˆæœ¬è¿˜æ˜¯è¾ƒå¤§çš„ï¼Œè€Œä¸”å¯¹æ¯”Goå†™wasmï¼ŒRustçš„é¢—ç²’åº¦æ˜¯éå¸¸ç»†çš„ï¼Œå‡ ä¹å¯ä»¥è¯´æ˜¯éšå¿ƒæ‰€æ¬²äº†ã€‚&lt;/p>
&lt;p>æ¯”è¾ƒç‚¸è£‚çš„å°±æ˜¯Rustçš„structå¯¼å‡ºç»™JSç”¨ï¼Œè¿™å¯¹äºRustä¸JSçš„äº¤äº’è€Œè¨€ï¼Œè¿˜æ˜¯éå¸¸æ£’çš„ä½“éªŒã€‚&lt;/p></description></item><item><title>ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(äºŒ)â€”â€”DOMå’Œç±»å‹è½¬æ¢</title><link>https://hunterji.com/zh-cn/post/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E4%BA%8Cdom%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/</link><pubDate>Sun, 18 Jun 2023 18:18:31 +0000</pubDate><guid>https://hunterji.com/zh-cn/post/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E4%BA%8Cdom%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/</guid><description>&lt;img src="https://hunterji.com/img/cover.jpg" alt="Featured image of post ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(äºŒ)â€”â€”DOMå’Œç±»å‹è½¬æ¢" />&lt;h2 id="å‰è¨€">å‰è¨€
&lt;/h2>&lt;p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« &lt;a class="link" href="https://github.com/Kuari/Blog/issues/72" target="_blank" rel="noopener"
>ã€Šä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(ä¸€)â€”â€”å¿«é€Ÿå¼€å§‹ã€‹&lt;/a>ä¸­ï¼Œæè¿°äº†å¦‚ä½•åˆ›å»ºé¡¹ç›®å’Œå¿«é€Ÿç”Ÿæˆwasmå¹¶åœ¨å‰ç«¯ä¸­ä½¿ç”¨ï¼Œè¿ˆå‡ºäº†æ•´èŠ±æ´»å„¿çš„ç¬¬ä¸€æ­¥ã€‚&lt;/p>
&lt;p>åœ¨å¼€å‘ Web åº”ç”¨ç¨‹åºæ—¶ï¼Œä½¿ç”¨ Rust ç¼–å†™çš„ Wasm æ¨¡å—å¯ä»¥æä¾›æ›´é«˜çš„æ€§èƒ½å’Œæ›´å¥½çš„å®‰å…¨æ€§ã€‚ä½†æ˜¯ï¼Œä¸ºäº†ä¸ç°æœ‰çš„ JavaScript ä»£ç é›†æˆï¼Œå¿…é¡»å®ç° Rust ä¸ JS ä¹‹é—´çš„äº¤äº’ã€‚Rust ä¸ JS äº¤äº’çš„ä¸»è¦ç›®çš„æ˜¯å°†ä¸¤ç§è¯­è¨€çš„ä¼˜åŠ¿ç»“åˆèµ·æ¥ï¼Œä»¥å®ç°æ›´å¥½çš„ Web åº”ç”¨ç¨‹åºã€‚&lt;/p>
&lt;p>æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œå°†åŸºäºä¸Šä¸€ç¯‡æ–‡ç« ä¸­åˆ›å»ºçš„é¡¹ç›®æ¥ç»§ç»­å¼€å‘ã€‚&lt;/p>
&lt;p>æºç ï¼š&lt;a class="link" href="https://github.com/Kuari/hello-wasm" target="_blank" rel="noopener"
>github.com/Kuari/hello-wasm&lt;/a>&lt;/p>
&lt;h2 id="ç¯å¢ƒ">ç¯å¢ƒ
&lt;/h2>&lt;ul>
&lt;li>Rust 1.70.0&lt;/li>
&lt;li>wasm-bindgen 0.2.87&lt;/li>
&lt;li>web-sys 0.3.64&lt;/li>
&lt;/ul>
&lt;h2 id="dom">DOM
&lt;/h2>&lt;h3 id="é…ç½®ä¾èµ–">é…ç½®ä¾èµ–
&lt;/h3>&lt;p>è¦æ“ä½œDOMï¼Œéœ€è¦å¼•å…¥æ–°çš„ä¾èµ–&lt;code>web-sys&lt;/code>ï¼Œå› æ­¤ï¼Œå¯ä»¥é…ç½®&lt;code>Cargo.toml&lt;/code>ä¸­ä¾èµ–å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">dependencies&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">wasm-bindgen&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.2.87&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">web-sys&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">version&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.3.64&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">features&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[]&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½ æˆ–è®¸ä¼šå¥½å¥‡ï¼Œè¿™ä¸ª&lt;code>features&lt;/code>æ˜¯ä»€ä¹ˆï¼Œè®²çœŸï¼Œæˆ‘ä¸€å¼€å§‹å¾ˆå¥½å¥‡ï¼Œåˆæ²¡çœ‹åˆ°ä»€ä¹ˆç‰¹åˆ«çš„è¯´æ˜ï¼Œè¯•é”™æ‰å‘ç°ï¼ŒåŸæ¥æ˜¯è¦æ‰‹åŠ¨å¼•å…¥åŠŸèƒ½ä¾èµ–&amp;hellip;æ¯”å¦‚è¯´ï¼Œå½“ä½ éœ€è¦åœ¨Rustä¸­ä½¿ç”¨JSçš„&lt;code>console&lt;/code>ï¼Œé‚£ä¹ˆä½ éœ€è¦åœ¨&lt;code>features&lt;/code>ä¸­åŠ å…¥&lt;code>console&lt;/code>ã€‚&lt;/p>
&lt;h3 id="è·å–document">è·å–Document
&lt;/h3>&lt;p>åœ¨Rustä¸­ä½¿ç”¨&lt;code>Document&lt;/code>ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§ä¸Šä¸€æ­¥çš„è¯´æ˜ï¼Œæ·»åŠ &lt;code>features&lt;/code>ã€‚é‚£ä¹ˆè¿™é‡Œæœ‰ä¸€ä¸ªä¾èµ–å…³ç³»ï¼Œé¦–å…ˆåœ¨Rustä¸­è·å–&lt;code>window&lt;/code>ï¼Œç„¶åå†è·å–&lt;code>document&lt;/code>ã€‚&lt;/p>
&lt;p>å› æ­¤ï¼Œæ·»åŠ &lt;code>features&lt;/code>åå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">dependencies&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">wasm-bindgen&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.2.87&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">web-sys&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">version&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.3.64&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">features&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;Window&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Document&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶ååœ¨&lt;code>lib.rs&lt;/code>ä¸­åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥è°ƒç”¨&lt;code>document&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">update_message&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">window&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">web_sys&lt;/span>::&lt;span class="n">window&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">expect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to load window&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">document&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">document&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">expect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to load document&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é‚£ä¹ˆï¼Œç°åœ¨å°±æ˜¯åœ¨Rustä¸­è§£é”äº†&lt;code>document&lt;/code>ï¼Œå°±å¯ä»¥åœ¨å‰ç«¯ä¸ºæ‰€æ¬²ä¸ºäº†ï¼&lt;/p>
&lt;h3 id="æ“ä½œelement">æ“ä½œElement
&lt;/h3>&lt;p>é‚£ä¹ˆå¼€å§‹æ“ä½œä¸€æ³¢ï¼Œé¦–å…ˆå¾—è·å–åˆ°&lt;code>Element&lt;/code>&amp;hellip;&amp;hellip;&lt;/p>
&lt;p>æ˜¯çš„ï¼Œä½ æ²¡æœ‰æƒ³é”™ï¼Œç»§ç»­æ¥æ·»åŠ &lt;code>features&lt;/code>å§ï¼Œæ­¤å¤„è¦æ·»åŠ ä¸€ä¸ª&lt;code>Element&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">dependencies&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">wasm-bindgen&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.2.87&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">web-sys&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">version&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.3.64&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">features&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;Window&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Document&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Element&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>okï¼Œé‚£ä¹ˆç»§ç»­ã€‚æ­¤å¤„è®¾å®šå‡½æ•°ä¼ å…¥ä¸¤ä¸ªå‚æ•°&lt;code>selector&lt;/code>å’Œ&lt;code>message&lt;/code>ï¼Œç„¶åé€šè¿‡&lt;code>selector&lt;/code>è·å–elementï¼Œæ›´æ–°å€¼ä¸º&lt;code>message&lt;/code>å‚æ•°çš„å€¼ã€‚å®Œæ•´å‡½æ•°å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">update_message&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">selector&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">message&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">window&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">web_sys&lt;/span>::&lt;span class="n">window&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">expect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to load window&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">document&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">document&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">expect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to load document&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">query_selector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">selector&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">expect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to load element&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">set_inner_html&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">panic!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to set inner html&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç¼–è¯‘">ç¼–è¯‘
&lt;/h3>&lt;p>å°†å†™å®Œçš„Rusté¡¹ç›®ç¼–è¯‘æˆwasmï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">wasm-pack build --target web
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åœ¨htmlä¸­è°ƒç”¨">åœ¨htmlä¸­è°ƒç”¨
&lt;/h3>&lt;p>åŸºäºä¸Šä¸€ç¯‡æ–‡ç« çš„é¡¹ç›®ä¸­çš„htmlï¼Œæ­¤å¤„æ·»åŠ ä¸€ä¸ª&lt;code>div&lt;/code>ï¼Œidä¸º&lt;code>message&lt;/code>ï¼Œæ·»åŠ è°ƒç”¨wasmçš„&lt;code>update_message&lt;/code>å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">body&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;message&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">body&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;module&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">import&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">update_message&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;./pkg/hello_wasm.js&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// å¼•å…¥update_messageå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">run&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">await&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">update_message&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#message&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;lt;h1&amp;gt;Hello, Rust!&amp;lt;/h1&amp;gt;&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// è°ƒç”¨update_messageå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">run&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åœ¨æµè§ˆå™¨éªŒè¯">åœ¨æµè§ˆå™¨éªŒè¯
&lt;/h3>&lt;p>å¯åŠ¨ä¸€ä¸ªhttp serverï¼Œç„¶ååœ¨æµè§ˆå™¨æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°åœ¨é¡µé¢ä¸Šå‡ºç°ä¸€ä¸ª&lt;code>h1&lt;/code>æ ‡ç­¾çš„&lt;code>Hello, Rust!&lt;/code>ã€‚&lt;/p>
&lt;h3 id="å‘ç°æ›´å¤šæ–¹æ³•">å‘ç°æ›´å¤šæ–¹æ³•
&lt;/h3>&lt;p>æŒ‰ç…§æ–‡ç« æ¥å†™çš„è¿‡ç¨‹ä¸­ï¼Œä½ åº”è¯¥ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜â€”â€”æ€ä¹ˆè¿™äº›æ–¹æ³•æ²¡æœ‰è¡¥å…¨ï¼Ÿï¼&lt;/p>
&lt;p>æ˜¯çš„ï¼Œæ²¡é”™çš„ï¼Œï¼ˆè‡³å°‘æˆ‘å‘ç°ï¼‰å½“å‰&lt;code>web-sys&lt;/code>å¹¶æ²¡æœ‰è¡¥å…¨ï¼Œæ‰€ä»¥åªèƒ½ç»“åˆå¼€å‘è€…ä¼˜ç§€çš„å‰ç«¯æŠ€èƒ½å’Œä¸°å¯Œçš„&lt;a class="link" href="https://rustwasm.github.io/wasm-bindgen/api/web_sys/" target="_blank" rel="noopener"
>å®˜æ–¹æ–‡æ¡£&lt;/a>æ¥å¼€å‘äº†ã€‚&lt;/p>
&lt;h2 id="rustä¸jsçš„ç±»å‹ç›¸äº’è½¬æ¢">Rustä¸JSçš„ç±»å‹ç›¸äº’è½¬æ¢
&lt;/h2>&lt;p>å¯¹äºwasmè€Œè¨€ï¼Œæ€§èƒ½å›ºç„¶æ˜¯æå‡çš„ï¼Œä½†æ˜¯ç±»å‹è½¬æ¢ä¸€ç›´æ˜¯ä¸ªé—®é¢˜ã€‚å½“å¤§é‡æ•°æ®éœ€è¦åœ¨wasm/jsä¸­è¿›è¡Œç±»å‹è½¬æ¢æ—¶ï¼Œè¿™å¯¹æ€§èƒ½æ¥è¯´ï¼ŒçœŸçš„æ˜¯ä¸ªç¾éš¾ã€‚ä¹‹å‰åœ¨ä½¿ç”¨goå¼€å‘wasmæ—¶ï¼Œå°±é‡åˆ°è¿‡è¿™æ ·çš„é—®é¢˜ï¼Œéœ€è¦ç”¨å®˜æ–¹çš„æ–¹æ³•æ¥è¿›è¡Œæ‰‹åŠ¨ç±»å‹è½¬æ¢ï¼Œç„¶è€Œwasmå¤„ç†çš„æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®é‡&amp;hellip;&amp;hellip;&lt;/p>
&lt;p>ä¸è¿‡å¥½åœ¨Rustçš„ç±»å‹æ”¯æŒçœŸçš„æŒºä¸°å¯Œçš„ï¼&lt;/p>
&lt;h3 id="åŸºç¡€ç±»å‹">åŸºç¡€ç±»å‹
&lt;/h3>&lt;p>åŸºç¡€ç±»å‹æŒºç®€å•çš„ï¼Œè€Œä¸”Rustçš„èŒƒæ€§ä¹Ÿå¾ˆå¥½åœ°æ”¯æŒäº†å¾ˆå¤šç±»å‹ã€‚å¦‚ä¸‹æ˜¯åŸºç¡€ç±»å‹æ˜ å°„è¡¨ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Rustç±»å‹&lt;/th>
&lt;th>JavaScriptç±»å‹&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>i8&lt;/td>
&lt;td>number&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>i16&lt;/td>
&lt;td>number&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>i32&lt;/td>
&lt;td>number&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>i64&lt;/td>
&lt;td>BigInt&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>u8&lt;/td>
&lt;td>number&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>u16&lt;/td>
&lt;td>number&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>u32&lt;/td>
&lt;td>number&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>u64&lt;/td>
&lt;td>BigInt&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>f32&lt;/td>
&lt;td>number&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>f64&lt;/td>
&lt;td>number&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>bool&lt;/td>
&lt;td>boolean&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>char&lt;/td>
&lt;td>string&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;amp;str&lt;/td>
&lt;td>string&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>String&lt;/td>
&lt;td>string&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;amp;[T] ä¾‹å¦‚ï¼š&amp;amp;[u8]&lt;/td>
&lt;td>[T] ä¾‹å¦‚ï¼šUint8Array&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Vec&amp;lt;T&amp;gt;&lt;/td>
&lt;td>Array&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="åŸºç¡€ç±»å‹è½¬æ¢ç¤ºä¾‹">åŸºç¡€ç±»å‹è½¬æ¢ç¤ºä¾‹
&lt;/h3>&lt;p>åœ¨&lt;code>lib.rs&lt;/code>æ–‡ä»¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼ŒæŒ‘é€‰å‡ ä¸ªç±»å‹ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œç„¶åå°†å…¶è¯»å–å¹¶æ‰“å°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">print_values&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">js_number&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_boolean&lt;/span>: &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_uint8_array&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_number_array&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;js number: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_number&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;js boolean: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_boolean&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_uint8_array&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;js Uint8Array item: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_number_array&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;js number array item: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°è¯¥å‡½æ•°ä¼ å…¥äº†JSçš„&lt;code>number&lt;/code>ã€&lt;code>boolean&lt;/code>ã€&lt;code>Uint8Array&lt;/code>å’Œ&lt;code>Array&lt;/code>å››ä¸ªç±»å‹çš„å‚æ•°ã€‚&lt;/p>
&lt;p>ç„¶åç¼–è¯‘ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">wasm-pack build --target web
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥ç€ï¼Œåœ¨å‰ç«¯ä¸­å¼•å…¥å‡½æ•°å¹¶è°ƒç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;module&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">import&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">print_values&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;./pkg/hello_wasm.js&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">run&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">await&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">jsNumber&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">jsBoolean&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">jsUint8Array&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Uint8Array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jsUint8Array&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jsUint8Array&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jsUint8Array&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">jsNumberArray&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">40&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">50&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">print_values&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">jsNumber&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">jsBoolean&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">jsUint8Array&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">jsNumberArray&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">run&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœ€åï¼Œå¯åŠ¨http serverå¹¶æ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°&amp;hellip;çœ‹ä¸åˆ°ï¼Ÿï¼&lt;/p>
&lt;p>æ˜¯çš„ï¼Œæ²¡é”™ï¼ŒRustçš„&lt;code>println!&lt;/code>åªä¼šå°†æ‰“å°çš„å†…å®¹å‘é€åˆ°Rustçš„æ ‡å‡†è¾“å‡ºæµï¼Œè€Œä¸æ˜¯å‰ç«¯çš„æ§åˆ¶å°ã€‚å¦‚æœæƒ³åœ¨æ§åˆ¶å°ä¸­æ‰“å°ï¼Œé‚£ä¹ˆéœ€è¦è°ƒç”¨JSçš„&lt;code>console&lt;/code>äº†ã€‚&lt;/p>
&lt;p>ä½¿ç”¨æ–°çš„åŠŸèƒ½ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯æ·»åŠ &lt;code>features&lt;/code>ï¼Œ&lt;code>Cargo.toml&lt;/code>ä¸­æ·»åŠ &lt;code>console&lt;/code>å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">dependencies&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">wasm-bindgen&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.2.87&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">web-sys&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">version&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.3.64&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">features&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;Window&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Document&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Element&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;console&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨Rustä¸­è°ƒç”¨&lt;code>console.log()&lt;/code>å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">web_sys&lt;/span>::&lt;span class="n">console&lt;/span>::&lt;span class="n">log_1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;Hello, Rust!&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ­¤å¤„å°†å…¶å°è£…æˆä¸€ä¸ªå‡½æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">console_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">message&lt;/span>: &lt;span class="nb">String&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">web_sys&lt;/span>::&lt;span class="n">console&lt;/span>::&lt;span class="n">log_1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶åï¼Œå°†ç¤ºä¾‹å‡½æ•°çš„&lt;code>println&lt;/code>æ”¹æˆ&lt;code>console_log()&lt;/code>å’Œ&lt;code>format!&lt;/code>ï¼Œå‡½æ•°ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">print_values&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">js_number&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_boolean&lt;/span>: &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_uint8_array&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_number_array&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">console_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;js number: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_number&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">console_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;js boolean: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_boolean&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_uint8_array&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">console_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;js Uint8Array item: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_number_array&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">console_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;js number array item: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœ€åï¼Œç¼–è¯‘ä¹‹åï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œå°±å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">js number: 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">js boolean: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">js Uint8Array item: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">js Uint8Array item: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">js Uint8Array item: 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">js number array item: 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">js number array item: 40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">js number array item: 50
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é€šç”¨ç±»å‹">é€šç”¨ç±»å‹
&lt;/h3>&lt;p>Rustä¸­æä¾›äº†ä¸€ä¸ªé€šç”¨çš„ç±»å‹â€”â€”JsValueï¼Œå¯ä»¥ä½œä¸ºä»»ä½•JSç±»å‹ã€‚&lt;/p>
&lt;p>è¿™é‡Œç»™ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹ï¼Œè®¾ç½®ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨&lt;code>JsValue&lt;/code>ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œå¹¶æ‰“å°ã€‚&lt;/p>
&lt;p>åˆ›å»ºå‡½æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">print_js_value&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">val&lt;/span>: &lt;span class="nc">JsValue&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">console_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶åç¼–è¯‘æˆwasmæ–‡ä»¶ã€‚&lt;/p>
&lt;p>åœ¨htmlä¸­è°ƒç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;module&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">import&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">print_js_value&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;./pkg/hello_wasm.js&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">run&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">await&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">jsNumber&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">jsBoolean&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">jsUint8Array&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Uint8Array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jsUint8Array&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jsUint8Array&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jsUint8Array&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">jsNumberArray&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">40&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">50&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">print_js_value&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">jsNumber&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">print_js_value&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">jsBoolean&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">print_js_value&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">jsUint8Array&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">print_js_value&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">jsNumberArray&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">run&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨htmlä¸­ï¼Œä¼ å…¥äº†ä¸åŒç±»å‹çš„å‚æ•°ï¼Œä½†æ˜¯åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå°†æ‰€æœ‰ä¸åŒç±»å‹çš„å‚æ•°éƒ½æ‰“å°å‡ºæ¥äº†ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">JsValue(10)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">JsValue(true)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">JsValue(Uint8Array)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">JsValue([30, 40, 50])
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="result">Result
&lt;/h3>&lt;p>&lt;code>Result&lt;/code>åœ¨Rustä¸­æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å­˜åœ¨ï¼Œç»å¸¸å†™Rustçš„è¯ï¼Œä¹Ÿä¸æƒ³åœ¨å†™WebAssemblyæ—¶æ”¹å˜å¼€å‘ä¹ æƒ¯ã€‚&lt;/p>
&lt;p>å…¶å®å¯¹äºJSè€Œè¨€ï¼Œ&lt;code>Result&lt;/code>å¯ä»¥ç›´æ¥åœ¨&lt;code>catch&lt;/code>ä¸­æ•è·åˆ°ï¼Œåªæ˜¯è¯´ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å®šä¹‰å¥½å‚æ•°ç±»å‹ã€‚&lt;/p>
&lt;h4 id="1-ä½¿ç”¨resultè¿”å›æŠ¥é”™">1 ä½¿ç”¨Resultè¿”å›æŠ¥é”™
&lt;/h4>&lt;p>é¦–å…ˆæ¥ä¸€ä¸ªåªè¿”å›æŠ¥é”™çš„åœºæ™¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">only_return_error_when_result&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">count&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JsError&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Err&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JsError&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;count &amp;lt; 10&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œè¿”å›ç±»å‹æ˜¯&lt;code>Result&lt;/code>ï¼Œä½†æ˜¯ä»…ä»…è¿”å›äº†ä¸€ä¸ªé”™è¯¯ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„æŠ¥é”™ä½¿ç”¨çš„ç±»å‹æ˜¯&lt;code>JsError&lt;/code>ï¼Œå½“ç„¶ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code>JsValue&lt;/code>ã€‚&lt;/p>
&lt;p>ç„¶ååœ¨htmlè°ƒç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;module&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">import&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">only_return_error_when_result&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;./pkg/hello_wasm.js&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">run&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">await&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">only_return_error_when_result&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;1 is ok&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;An error is reported when the input parameter is 1: &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">error&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">only_return_error_when_result&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;100 is ok&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;An error is reported when the input parameter is 100: &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">error&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">run&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œè°ƒç”¨äº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡åº”å½“æ˜¯é”™è¯¯çš„ï¼Œç¬¬äºŒæ¬¡åº”è¯¥æ˜¯æ­£ç¡®çš„ï¼Œå¹¶ä¸”éƒ½ä½¿ç”¨äº†&lt;code>catch&lt;/code>æ¥æ•è·é”™è¯¯ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œåœ¨æµè§ˆå™¨çš„æ§åˆ¶å°å¯ä»¥çœ‹åˆ°è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">An error is reported when the input parameter is 1: Error: count &amp;lt; 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">100 is ok
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="2-ä½¿ç”¨resultè¿”å›æ­£å¸¸å€¼å’Œé”™è¯¯">2 ä½¿ç”¨Resultè¿”å›æ­£å¸¸å€¼å’Œé”™è¯¯
&lt;/h4>&lt;p>é‚£ä¹ˆï¼Œå¦‚æœæƒ³æ—¢è¿”å›æ­£å¸¸å€¼ï¼Œä¹Ÿæƒ³è¿”å›é”™è¯¯å‘¢ï¼ŸRustè¿”å›ä¸€ä¸ª&lt;code>Result&lt;/code>æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆJSæ€ä¹ˆè§£æå‘¢ï¼Ÿ&lt;/p>
&lt;p>ç›´æ¥ä¸ŠRustä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">return_all_when_result&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">count&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JsError&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Err&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JsError&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;count &amp;lt; 10&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¯¥å‡½æ•°ï¼Œè·å–åˆ°å‚æ•°åï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶ï¼ŒåŠ 10åè¿”å›ï¼Œå¦åˆ™æŠ¥é”™ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆçœ‹çœ‹htmlä¸­å¦‚ä½•è°ƒç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;module&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">import&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">return_all_when_result&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;./pkg/hello_wasm.js&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">run&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">await&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">return_all_when_result&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`get &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">res&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;An error is reported when the input parameter is 1: &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">error&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">return_all_when_result&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`get &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">res&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;An error is reported when the input parameter is 100: &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">error&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">run&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ˜¯çš„ï¼Œæ²¡é”™ï¼Œæ­£å¸¸è·å–å°±è¡Œäº†&amp;hellip;&amp;hellip;/æ‚è„¸å“­&lt;/p>
&lt;p>è¿™é‡Œçš„è°ƒç”¨ï¼Œä¾ç„¶æ˜¯ï¼Œç¬¬ä¸€ä¸ªæ˜¯é”™è¯¯çš„ï¼Œç¬¬äºŒä¸ªæ˜¯æ­£ç¡®è¿”å›å€¼çš„ï¼Œå¹¶ä¸”éƒ½ä½¿ç”¨äº†&lt;code>catch&lt;/code>æ¥æ•è·é”™è¯¯ã€‚&lt;/p>
&lt;p>æœ€åï¼Œå°±æ˜¯åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­çœ‹åˆ°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">An error is reported when the input parameter is 1: Error: count &amp;lt; 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">get 110
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç›´æ¥å¼•å…¥jsç±»å‹">ç›´æ¥å¼•å…¥JSç±»å‹
&lt;/h3>&lt;p>å¦‚æœä½ æƒ³æ›´ç›´æ¥ä¸€ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å¼•å…¥JSç±»å‹ï¼è¿™é‡Œä¸»è¦æ˜¯åˆ©ç”¨&lt;code>js-sys&lt;/code>è¿™ä¸ªä¾èµ–ï¼Œå¯ä»¥åœ¨&lt;a class="link" href="https://docs.rs/js-sys/latest/js_sys/" target="_blank" rel="noopener"
>å®˜æ–¹æ–‡æ¡£&lt;/a>ä¸Šçœ‹åˆ°å¾ˆå¤šJSçš„ç±»å‹å’Œå‡½æ•°ï¼Œç›´æ¥å¼•å…¥å³å¯ä½¿ç”¨ã€‚å½“ç„¶ï¼Œä¸€å®šåœºæ™¯ä¸‹ï¼Œç›´æ¥å¼•å…¥çš„ç±»å‹ï¼Œæ˜¯éœ€è¦æ‰‹åŠ¨è½¬æ¢ç±»å‹çš„ã€‚&lt;/p>
&lt;h4 id="1-é…ç½®ä¾èµ–">1 é…ç½®ä¾èµ–
&lt;/h4>&lt;p>åœ¨&lt;code>Cargo.toml&lt;/code>ä¸­æ·»åŠ &lt;code>js-sys&lt;/code>ä¾èµ–ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">dependencies&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">wasm-bindgen&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.2.87&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">web-sys&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">version&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.3.64&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">features&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;Window&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Document&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Element&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;console&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">js-sys&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.3.61&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="2-uint8array">2 Uint8Array
&lt;/h4>&lt;p>é¦–å…ˆä»¥&lt;code>Uint8Array&lt;/code>ä¸¾ä¾‹ï¼Œåœ¨&lt;code>lib.rs&lt;/code>å¤´éƒ¨å¼•å…¥ç±»å‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_sys&lt;/span>::&lt;span class="n">Uint8Array&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶ååˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°å’Œè¿”å›éƒ½æ˜¯&lt;code>Uint8Array&lt;/code>ç±»å‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">print_uint8_array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">js_arr&lt;/span>: &lt;span class="nc">Uint8Array&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Uint8Array&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// new Uint8Array
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Uint8Array&lt;/span>::&lt;span class="n">new_with_length&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Uint8Array -&amp;gt; vec
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_arr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_vec&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">enumerate&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">console_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s"> - the item in js_arr: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Avoid type conversion
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Use the method of the type itself
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="n">js_arr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">console_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s"> - the item in js_arr: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_arr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">get_index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">)));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// vec -&amp;gt; Uint8Array
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">vec&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arr2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Uint8Array&lt;/span>::&lt;span class="n">from&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vec&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">as_slice&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arr2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clone&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Use the method of the type itself
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">set_index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>å¿½ç•¥è¯¥å‡½æ•°ä¸­æ— æ„ä¹‰çš„é€»è¾‘å’Œ&lt;code>arr&lt;/code>å˜é‡çš„è­¦å‘Šï¼Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºç”¨æ³•ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å¯ä»¥åœ¨ä»£ç ä¸­çœ‹åˆ°ï¼Œç›´æ¥å¼•å…¥çš„&lt;code>Uint8Array&lt;/code>æœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œä¸€å®šåœºæ™¯ä¸‹ï¼Œéœ€è¦è½¬æ¢ç±»å‹ï¼Œä½†æ˜¯æœ€å¥½é¿å…è¿›è¡Œç±»å‹è½¬æ¢ï¼Œè€Œç›´æ¥ä½¿ç”¨å…¶è‡ªå¸¦çš„æ–¹æ³•ã€‚&lt;/p>
&lt;p>è¿™é‡Œå¯ä»¥ç®€è¦æ€»ç»“ä¸‹ï¼Œå°±æ˜¯æœ€å¥½ä¸€å®šåœºæ™¯å†…å…¨éƒ¨ä½¿ç”¨ç›´æ¥å¼•å…¥çš„JSç±»å‹ï¼Œæˆ–è€…ç›´æ¥å…¨éƒ¨ä½¿ç”¨Rustç±»å‹æ¥ä»£æ›¿JSç±»å‹ï¼Œä¸¤è€…éƒ½å­˜åœ¨åœºæ™¯ä¸‹ï¼Œæ‰‹åŠ¨è½¬æ¢ç±»å‹æ˜¯ä»¶å¾ˆç³Ÿç³•çš„äº‹ã€‚&lt;/p>
&lt;h4 id="3-date">3 Date
&lt;/h4>&lt;p>&lt;code>Date&lt;/code>ç±»å‹ï¼Œåœ¨ä¸Šé¢çš„ç¯‡ç« ä¸­éƒ½æ²¡æœ‰æåŠï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥å¼•å…¥JSçš„&lt;code>Date&lt;/code>ç±»å‹æ¥ä½¿ç”¨ã€‚&lt;/p>
&lt;p>é¦–å…ˆæ˜¯å¼•å…¥ç±»å‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">js_sys&lt;/span>::&lt;span class="n">Date&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›æ—¶é—´æˆ³ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">return_time&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">f64&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">date&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Date&lt;/span>::&lt;span class="n">new_0&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">date&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">get_time&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥ç€ï¼Œåœ¨htmlä¸­è°ƒç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;module&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">import&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">return_time&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;./pkg/hello_wasm.js&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">run&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">await&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;current time: &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">return_time&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">run&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœ€åï¼Œåœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">current time: 1686979932833
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ€»ç»“">æ€»ç»“
&lt;/h2>&lt;p>æœ¬æ–‡ä¸­ï¼Œä¸»è¦è®²è¿°äº†å¦‚ä½•ä½¿ç”¨Rustæ¥å®ç°DOMæ“ä½œï¼Œè¯»è€…å¯ä»¥æ ¹æ®æ–¹æ³•è‡ªå·±å»æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ï¼Œæ¥å®ç°è‡ªå·±çš„åœºæ™¯ã€‚å…¶æ¬¡ï¼Œè¿˜è®²è¿°äº†Rustä¸JSçš„ç±»å‹è½¬æ¢ï¼Œä»åŸºç¡€çš„å„è‡ªç±»å‹çš„æ˜ å°„ï¼Œåˆ°Rustç‹¬æœ‰çš„&lt;code>Result&lt;/code>ï¼Œåˆ°ç›´æ¥å¼•å…¥JSç±»å‹ã€‚å½“ç„¶è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›´æ¥å¼•å…¥JSç±»å‹å’ŒRustçš„åŸºç¡€ç±»å‹æ˜ å°„JSç±»å‹è¿™ä¸¤ç§æ–¹æ³•å°½é‡ä¸è¦æ··ç”¨ï¼Œæ··ç”¨ä¼šå¯¼è‡´éœ€è¦æ‰‹åŠ¨ç±»å‹è½¬æ¢ï¼Œé€ æˆæ€§èƒ½æŸè€—ã€‚&lt;/p>
&lt;p>è‡³æ­¤ï¼Œåˆå‘Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿è¿ˆè¿›äº†ä¸€æ­¥~ğŸ˜¼&lt;/p></description></item><item><title>ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(ä¸€)â€”â€”å¿«é€Ÿå¼€å§‹</title><link>https://hunterji.com/zh-cn/post/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E4%B8%80%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/</link><pubDate>Wed, 14 Jun 2023 17:32:28 +0000</pubDate><guid>https://hunterji.com/zh-cn/post/%E4%BD%BF%E7%94%A8rust%E5%92%8Cwebassembly%E6%95%B4%E8%8A%B1%E6%B4%BB%E5%84%BF%E4%B8%80%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/</guid><description>&lt;img src="https://hunterji.com/img/cover.jpg" alt="Featured image of post ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿(ä¸€)â€”â€”å¿«é€Ÿå¼€å§‹" />&lt;h2 id="å‰è¨€">å‰è¨€
&lt;/h2>&lt;p>&lt;a class="link" href="https://developer.mozilla.org/zh-CN/docs/WebAssembly" target="_blank" rel="noopener"
>WebAssembly&lt;/a> æ˜¯ä¸€ç§æ–°çš„ç¼–ç æ–¹å¼ï¼Œå¯ä»¥åœ¨ç°ä»£çš„ç½‘ç»œæµè§ˆå™¨ä¸­è¿è¡Œ ï¼ å®ƒæ˜¯ä¸€ç§ä½çº§çš„ç±»æ±‡ç¼–è¯­è¨€ï¼Œå…·æœ‰ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¯ä»¥æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½è¿è¡Œï¼Œå¹¶ä¸ºè¯¸å¦‚ C / C ++ç­‰è¯­è¨€æä¾›ä¸€ä¸ªç¼–è¯‘ç›®æ ‡ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥åœ¨ Web ä¸Šè¿è¡Œã€‚å®ƒä¹Ÿè¢«è®¾è®¡ä¸ºå¯ä»¥ä¸ JavaScript å…±å­˜ï¼Œå…è®¸ä¸¤è€…ä¸€èµ·å·¥ä½œã€‚&lt;/p>
&lt;p>ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼Œæ˜¯å…³äºå¦‚ä½•ä½¿ç”¨golangæ¥å¼€å‘WebAssemblyçš„â€”â€”&lt;a class="link" href="https://blog.hunterji.com/p/webassembly--%e6%9c%aa%e6%9d%a5%e5%89%8d%e7%ab%af%e5%bc%80%e5%8f%91%e7%9a%84%e5%bf%85%e5%a4%87%e6%8a%80%e8%83%bd" target="_blank" rel="noopener"
>WebAssemblyï¼šæœªæ¥å‰ç«¯å¼€å‘çš„å¿…å¤‡æŠ€èƒ½&lt;/a>ã€‚&lt;/p>
&lt;p>Rustå’ŒGoéƒ½å¯ä»¥ç”¨æ¥å¼€å‘WebAssemblyï¼Œä½†å®ƒä»¬æœ‰å„è‡ªçš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚&lt;/p>
&lt;p>Rustçš„ä¼˜ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ›´å¿«çš„æ€§èƒ½å’Œæ›´å°çš„äºŒè¿›åˆ¶æ–‡ä»¶&lt;/li>
&lt;li>æ›´å¥½çš„å†…å­˜å®‰å…¨æ€§&lt;/li>
&lt;/ul>
&lt;p>Goçš„ä¼˜ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ›´å®¹æ˜“ä¸Šæ‰‹å’Œå­¦ä¹ &lt;/li>
&lt;li>æ›´å¥½çš„ç”Ÿæ€ç³»ç»Ÿå’Œç¤¾åŒºæ”¯æŒ&lt;/li>
&lt;/ul>
&lt;p>ç»¼åˆæ¥è¯´ï¼Œå¦‚æœä½ æ›´æ³¨é‡æ€§èƒ½å’Œå†…å­˜å®‰å…¨æ€§ï¼Œé‚£ä¹ˆRustå¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚è€Œå¦‚æœä½ æ›´æ³¨é‡å¼€å‘æ•ˆç‡å’Œæ˜“ç”¨æ€§ï¼Œé‚£ä¹ˆGoå¯èƒ½æ›´é€‚åˆä½ ã€‚å½“ç„¶ï¼Œå®é™…æƒ…å†µè¿˜éœ€è¦æ ¹æ®å…·ä½“çš„é¡¹ç›®éœ€æ±‚å’Œå›¢é˜Ÿæƒ…å†µæ¥é€‰æ‹©ã€‚&lt;/p>
&lt;p>å› ä¸ºä¸€äº›å·¥ä½œéœ€æ±‚ï¼Œæœ€è¿‘æ•´äº†äº›rustçš„èŠ±æ´»å„¿ï¼Œè¿™é‡Œç³»ç»Ÿåœ°è®°å½•ä¸€ä¸‹ã€‚å½“ä½ é‡åˆ°æ›´æ³¨é‡æ€§èƒ½å’Œå†…å­˜å®‰å…¨æ€§çš„åœºæ™¯ï¼Œå¸Œæœ›è¿™èƒ½æœ‰å¸®åŠ©ã€‚&lt;/p>
&lt;h2 id="ç¯å¢ƒ">ç¯å¢ƒ
&lt;/h2>&lt;ul>
&lt;li>Rust 1.70.0&lt;/li>
&lt;li>wasm-bindgen 0.2.87&lt;/li>
&lt;/ul>
&lt;h2 id="åˆ›å»ºé¡¹ç›®å¹¶æ·»åŠ ä¾èµ–">åˆ›å»ºé¡¹ç›®å¹¶æ·»åŠ ä¾èµ–
&lt;/h2>&lt;p>æ­¤å¤„é»˜è®¤å·²ç»å®‰è£…Rustï¼Œéœ€è¦å®‰è£…çš„å°ä¼™ä¼´å„¿å¯ä»¥å‚è€ƒ&lt;a class="link" href="https://www.rust-lang.org/tools/install" target="_blank" rel="noopener"
>å®˜ç½‘&lt;/a>ã€‚&lt;/p>
&lt;p>ä½¿ç”¨Cargoåˆ›å»ºä¸€ä¸ªåä¸º&lt;code>hello-wasm&lt;/code>çš„é¡¹ç›®ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cargo new --lib hello-wasm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿›å…¥é¡¹ç›®ï¼Œæ‰“å¼€æ–‡ä»¶&lt;code>Cargo.toml&lt;/code>ï¼Œæ·»åŠ ä¾èµ–ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">lib&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">crate-type&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;cdylib&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">dependencies&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">wasm-bindgen&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.2.87&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ›´æ–°librs">æ›´æ–°lib.rs
&lt;/h2>&lt;p>é»˜è®¤åˆ›å»ºé¡¹ç›®ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªåä¸º&lt;code>lib.rs&lt;/code>çš„æ–‡ä»¶ï¼Œå°†å†…å®¹å…¨éƒ¨æ›¿æ¢æˆï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">wasm_bindgen&lt;/span>::&lt;span class="n">prelude&lt;/span>::&lt;span class="o">*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[wasm_bindgen]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">i32&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ç¼–è¯‘">ç¼–è¯‘
&lt;/h2>&lt;p>è‡³æ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæœ€ç®€å•çš„åŠŸèƒ½â€”â€”ä¸€ä¸ªè¿”å›ä¸¤ä¸ªæ•´æ•°ç›¸åŠ ç»“æœçš„å‡½æ•°ã€‚&lt;/p>
&lt;p>ç„¶åæˆ‘ä»¬å¯ä»¥è¿›è¡Œç¼–è¯‘äº†ï¼Œç¼–è¯‘ä¹‹å‰éœ€è¦å®‰è£…ä¸€ä¸ªå·¥å…·&lt;code>wasm-pack&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cargo install wasm-pack
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶åè¿›è¡Œç¼–è¯‘ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">wasm-pack build --target web
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¼–è¯‘å®Œæˆä¹‹åï¼Œå°†ä¼šå¤šå‡ºæ¥ä¸€ä¸ª&lt;code>pkg&lt;/code>æ–‡ä»¶å¤¹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">pkg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ hello_wasm.d.ts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ hello_wasm.js
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ hello_wasm_bg.wasm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ hello_wasm_bg.wasm.d.ts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â””â”€â”€ package.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è™½ç„¶æ–‡ä»¶å¾ˆå¤šï¼Œä½†æ˜¯é¦–å…ˆæˆ‘ä»¬çœ‹åˆ°äº†æˆ‘ä»¬æ‰€éœ€è¦çš„wasmæ–‡ä»¶ï¼Œå¹¶ä¸”ï¼Œæ ¹æ®goçš„wasmå¼•å…¥æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬æˆ–è®¸ä¼šéœ€è¦ç”¨åˆ°jsæ–‡ä»¶ã€‚&lt;/p>
&lt;h2 id="å‰ç«¯å¼•å…¥">å‰ç«¯å¼•å…¥
&lt;/h2>&lt;p>ä¸ºäº†æ–¹ä¾¿æœ€å¿«æ ¡éªŒï¼Œç›´æ¥åœ¨&lt;code>hello-wasm&lt;/code>é¡¹ç›®ä¸­åˆ›å»º&lt;code>index.html&lt;/code>æ–‡ä»¶ï¼Œæ¥è¿›è¡Œå‰ç«¯å¼•å…¥ã€‚&lt;/p>
&lt;h3 id="åˆ›å»ºindexhtml">åˆ›å»ºindex.html
&lt;/h3>&lt;p>é‚£ä¹ˆï¼Œé¦–å…ˆï¼Œåˆ›å»º&lt;code>index.html&lt;/code>æ–‡ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&amp;lt;!DOCTYPE html&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">html&lt;/span> &lt;span class="na">lang&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;en&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">meta&lt;/span> &lt;span class="na">charset&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">meta&lt;/span> &lt;span class="na">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;viewport&amp;#34;&lt;/span> &lt;span class="na">content&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;width=device-width, initial-scale=1.0&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">body&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Hello, World!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">body&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">html&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ˜¯çš„ï¼Œæ²¡é”™ï¼è¿™æ˜¯ä¸€åœºæ ‡å‡†çš„å¼€å±€ï¼ğŸ˜¼&lt;/p>
&lt;h3 id="å¼•å…¥wasm">å¼•å…¥WASM
&lt;/h3>&lt;p>å…¶å®ä¸åŒäºgoè¯­è¨€çš„wasmå¼•å…¥æ–¹å¼ï¼ŒRustæ›´å¸Œæœ›ç›´æ¥å¼•å…¥jsæ–‡ä»¶ï¼Œè€Œä¸æ˜¯è®©å¼€å‘è€…æ‰‹åŠ¨å¼•å…¥wasmæ–‡ä»¶ã€‚&lt;/p>
&lt;p>è¿™é‡Œä½¿ç”¨jså¼•å…¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;module&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">import&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">add&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;./pkg/hello_wasm.js&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">run&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">await&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`the result from rust is: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">run&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®Œæ•´ä»£ç ">å®Œæ•´ä»£ç 
&lt;/h3>&lt;p>å®Œæ•´çš„htmlä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&amp;lt;!DOCTYPE html&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">html&lt;/span> &lt;span class="na">lang&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;en&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">meta&lt;/span> &lt;span class="na">charset&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">meta&lt;/span> &lt;span class="na">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;viewport&amp;#34;&lt;/span> &lt;span class="na">content&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;width=device-width, initial-scale=1.0&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>ä½¿ç”¨Rustå’ŒWebAssemblyæ•´èŠ±æ´»å„¿&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">body&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Hello, World!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">body&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;module&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">import&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">add&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;./pkg/hello_wasm.js&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">run&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">await&lt;/span> &lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`the result from rust is: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">run&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">html&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="éªŒè¯">éªŒè¯
&lt;/h2>&lt;p>è¿™é‡Œå¯ä»¥å¿«é€Ÿèµ·ä¸€ä¸ªhttp serverï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ä½¿ç”¨&lt;code>http-server&lt;/code>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code>python3 -m http.server&lt;/code>è¿™æ ·çš„æ–¹å¼ï¼Œçœ‹æ€ä¹ˆå„è‡ªçš„ä½¿ç”¨ä¹ æƒ¯ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œå¯åŠ¨http serverï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">http-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®&lt;code>http://localhost:8080&lt;/code>ï¼Œæ‰“å¼€è°ƒè¯•å™¨ï¼Œå³å¯çœ‹åˆ°è¾“å‡º&lt;code>the result from rust is: 3&lt;/code>ï¼Œè¿™å°±æ„å‘³ç€è¿ˆå‡ºäº†æ•´èŠ±æ´»å„¿çš„ç¬¬ä¸€æ­¥ï¼&lt;/p>
&lt;p>&lt;img src="https://user-images.githubusercontent.com/25321169/245747861-4fb71bd2-9f90-41b3-ada8-6e1d930044d4.png"
loading="lazy"
alt="rust_wasm"
>&lt;/p>
&lt;h2 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜
&lt;/h2>&lt;h3 id="å‰ç«¯æŠ¥å“åº”ç±»å‹é”™è¯¯">å‰ç«¯æŠ¥å“åº”ç±»å‹é”™è¯¯
&lt;/h3>&lt;p>è¯¦ç»†æŠ¥é”™å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Failed&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="nb">load&lt;/span> &lt;span class="n">module&lt;/span> &lt;span class="n">script&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">The&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="n">responded&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">non&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">JavaScript&lt;/span> &lt;span class="n">MIME&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="s2">&amp;#34;application/wasm&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Strict&lt;/span> &lt;span class="n">MIME&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="n">checking&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">enforced&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">module&lt;/span> &lt;span class="n">scripts&lt;/span> &lt;span class="n">per&lt;/span> &lt;span class="n">HTML&lt;/span> &lt;span class="n">spec&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“å¼•å…¥WebAssemblyç”Ÿæˆçš„jsæ–‡ä»¶æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™ä¸ªæŠ¥é”™ã€‚æŠ¥é”™ä¹ä¸€çœ‹æ˜¯http serverçš„å“åº”é—®é¢˜ï¼Œæˆ–è€…æœç´¢æ—¶å€™ï¼Œä¹Ÿä¼šæœ‰å¸–å­è¯´è¿™æ˜¯ä¸€ä¸ªresponseé—®é¢˜ã€‚&lt;/p>
&lt;p>å®é™…ä¸Šï¼Œå½“æŒ‰ç…§è¿™ä¸ªæ–‡ç« ä¸€æ­¥æ­¥æ“ä½œæ—¶æ˜¯ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜çš„ï¼Œæ˜¯å› ä¸ºæœ¬æ–‡çš„ç¼–è¯‘å‚æ•°æ˜¯ç›´æ¥è§£å†³äº†è¿™ä¸ªé—®é¢˜çš„ã€‚å½“æˆ‘è‡ªå·±æ‘¸ç´¢çš„æ—¶å€™ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çœŸçš„æ˜¯çœ‹åˆ°äººéƒ½éº»äº†â€¦â€¦&lt;/p>
&lt;p>å…³é”®åœ¨äºç¼–è¯‘å‘½ä»¤çš„å‚æ•°ï¼š&lt;code>--target&lt;/code>ã€‚&lt;/p>
&lt;p>å½“æ²¡æœ‰è®¾ç½®è¿™ä¸ªå‚æ•°æ—¶ï¼Œé»˜è®¤çš„å‚æ•°å…¶å®æ˜¯&lt;code>--target bundler&lt;/code>ï¼Œå…¶æ˜¯ç¼–è¯‘æˆç»™webpackä¹‹ç±»çš„è„šæ‰‹æ¶ä½¿ç”¨çš„ã€‚å› æ­¤è¿™é‡Œä½¿ç”¨&lt;code>â€”target web&lt;/code>ï¼Œåˆ™æ˜¯ä½¿å…¶ç¼–è¯‘æˆå¯ç›´æ¥åœ¨webä¸­ä½¿ç”¨ã€‚&lt;/p>
&lt;p>ç›¸å…³å‚æ•°å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>bundler&lt;/strong>ï¼šç¼–è¯‘æˆç»™webpackä¹‹ç±»çš„è„šæ‰‹æ¶ä½¿ç”¨&lt;/li>
&lt;li>&lt;strong>web&lt;/strong>ï¼šç¼–è¯‘æˆwebå¯ç›´æ¥ä½¿ç”¨&lt;/li>
&lt;li>&lt;strong>nodejs&lt;/strong>ï¼šç¼–è¯‘æˆå¯é€šè¿‡requireæ¥åŠ è½½çš„nodeæ¨¡å—&lt;/li>
&lt;li>&lt;strong>deno&lt;/strong>ï¼šç¼–è¯‘æˆå¯é€šè¿‡importåŠ è½½çš„denoæ¨¡å—&lt;/li>
&lt;li>&lt;strong>no-modules&lt;/strong>ï¼šè·Ÿwebç±»ä¼¼ï¼Œä½†æ˜¯æ›´æ—§ï¼Œä¸”ä¸èƒ½ä½¿ç”¨esæ¨¡å—&lt;/li>
&lt;/ul>
&lt;h3 id="ç›´æ¥å¼•å…¥wasmæ–‡ä»¶">ç›´æ¥å¼•å…¥wasmæ–‡ä»¶
&lt;/h3>&lt;p>è‹¥æ­¤æ—¶å°è¯•ç›´æ¥å¼•å…¥wasmæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æœ¬æ–‡æ‰€è¿°çš„æ–¹å¼ï¼Œé‚£ä¹ˆä½ ä¼šå‘ç°ï¼Œä¹Ÿæ˜¯å¯è¡Œçš„ï¼&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;module&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">WebAssembly&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">instantiateStreaming&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">fetch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;./pkg/hello_wasm_bg.wasm&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="p">{}).&lt;/span>&lt;span class="nx">then&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nx">obj&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;the result from rust is: &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">obj&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">instance&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exports&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ˜¯çš„ï¼Œæ²¡é”™ï¼Œå½“å‰æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å½“å¼•å…¥äº†ä¸€äº›åˆ«çš„æ¯”å¦‚domä¹‹ç±»çš„ï¼Œå°±åèµ·æ¥äº†â€¦â€¦&lt;/p>
&lt;h3 id="æ›´æ–°çš„wasmå¼•å…¥æ–¹å¼">æ›´æ–°çš„wasmå¼•å…¥æ–¹å¼
&lt;/h3>&lt;p>ä¸Šä¸€é—®é¢˜ä¸­ï¼Œä¸”ä¸è¯´æ˜¯å¦å¯ä»¥ç›´æ¥å¼•å…¥wasmæ–‡ä»¶ï¼Œè¿™é‡Œä»…è¯´ä¸€ä¸‹ï¼Œ&lt;code>instantiateStreaming&lt;/code>è¿™ä¸ªæ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªæ›´æ–°çš„æ–¹æ³•ï¼Œæ— éœ€è½¬æˆ&lt;code>arrayBuffer&lt;/code>ï¼Œè¿™ä¹Ÿæ˜¯æ‘¸ç´¢Rustæ•´æ´»å„¿æ—¶å€™å‘ç°çš„ã€‚å¦‚æœåœ¨åˆ«çš„è¯­è¨€å¼•å…¥wasmï¼Œè¯·ä½¿ç”¨è¿™ä¸ª&lt;a class="link" href="https://developer.mozilla.org/en-US/docs/WebAssembly/JavaScript_interface/instantiateStreaming" target="_blank" rel="noopener"
>æ›´æ–°çš„æ–¹æ³•&lt;/a>å§ã€‚&lt;/p></description></item><item><title>å¦‚ä½•ä½¿ç”¨Goæ„å»ºWebAssembly</title><link>https://hunterji.com/zh-cn/post/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8go%E6%9E%84%E5%BB%BAwebassembly/</link><pubDate>Thu, 09 Feb 2023 13:15:34 +0000</pubDate><guid>https://hunterji.com/zh-cn/post/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8go%E6%9E%84%E5%BB%BAwebassembly/</guid><description>&lt;img src="https://hunterji.com/zh-cn/post/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8go%E6%9E%84%E5%BB%BAwebassembly/cover.jpg" alt="Featured image of post å¦‚ä½•ä½¿ç”¨Goæ„å»ºWebAssembly" />&lt;h2 id="å‰è¨€">å‰è¨€
&lt;/h2>&lt;p>&lt;a class="link" href="https://developer.mozilla.org/zh-CN/docs/WebAssembly" target="_blank" rel="noopener"
>WebAssembly&lt;/a> æ˜¯ä¸€ç§æ–°çš„ç¼–ç æ–¹å¼ï¼Œå¯ä»¥åœ¨ç°ä»£çš„ç½‘ç»œæµè§ˆå™¨ä¸­è¿è¡Œ ï¼ å®ƒæ˜¯ä¸€ç§ä½çº§çš„ç±»æ±‡ç¼–è¯­è¨€ï¼Œå…·æœ‰ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¯ä»¥æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½è¿è¡Œï¼Œå¹¶ä¸ºè¯¸å¦‚ C / C ++ç­‰è¯­è¨€æä¾›ä¸€ä¸ªç¼–è¯‘ç›®æ ‡ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥åœ¨ Web ä¸Šè¿è¡Œã€‚å®ƒä¹Ÿè¢«è®¾è®¡ä¸ºå¯ä»¥ä¸ JavaScript å…±å­˜ï¼Œå…è®¸ä¸¤è€…ä¸€èµ·å·¥ä½œã€‚&lt;/p>
&lt;h2 id="å¿«é€Ÿä¸Šæ‰‹">å¿«é€Ÿä¸Šæ‰‹
&lt;/h2>&lt;h3 id="ç”¨goå†™ä¸€ä¸ªhello-world">ç”¨goå†™ä¸€ä¸ªhello world
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello, WebAssembly!&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å°†goæ–‡ä»¶ç¼–è¯‘æˆwasmæ–‡ä»¶">å°†goæ–‡ä»¶ç¼–è¯‘æˆwasmæ–‡ä»¶
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">GOOS&lt;/span>&lt;span class="o">=&lt;/span>js &lt;span class="nv">GOARCH&lt;/span>&lt;span class="o">=&lt;/span>wasm go build -o static/main.wasm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ‹·è´å‡ºwasm_execjs">æ‹·è´å‡ºwasm_exec.js
&lt;/h3>&lt;p>è¯¥æ–‡ä»¶ä¸ºgoçš„wasmçš„jsæ”¯æŒæ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">cp &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>go env GOROOT&lt;span class="k">)&lt;/span>&lt;span class="s2">/misc/wasm/wasm_exec.js&amp;#34;&lt;/span> static
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="htmlæ–‡ä»¶è°ƒç”¨wasmæ–‡ä»¶">htmlæ–‡ä»¶è°ƒç”¨wasmæ–‡ä»¶
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;static/wasm_exec.js&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">go&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Go&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">WebAssembly&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">instantiateStreaming&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">fetch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;static/main.wasm&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">go&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">importObject&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="nx">then&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">go&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">instance&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="éªŒè¯è°ƒç”¨">éªŒè¯è°ƒç”¨
&lt;/h3>&lt;p>æµè§ˆå™¨åŠ è½½htmlæ–‡ä»¶ï¼Œf12æ‰“å¼€æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°wasmçš„æ‰“å°æ¶ˆæ¯ã€‚&lt;/p>
&lt;h2 id="goä¸jsçš„ç±»å‹è½¬æ¢">goä¸jsçš„ç±»å‹è½¬æ¢
&lt;/h2>&lt;h3 id="ç±»å‹æ˜ å°„">ç±»å‹æ˜ å°„
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">| Go | JavaScript |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| ---------------------- | ---------------------- |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| js.Value | [its value] |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| js.Func | function |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| nil | null |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| bool | boolean |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| integers and floats | number |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| string | string |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| []interface{} | new array |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| map[string]interface{} | new object |
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚ä¸Šä¸ºå®˜æ–¹ç»™å‡ºçš„goä¸jsçš„ç±»å‹æ˜ å°„è¡¨ã€‚&lt;/p>
&lt;p>æ¯”å¦‚åœ¨goä¸­è°ƒç”¨jså‡½æ•°ï¼Œå‚æ•°ä¸º&lt;code>array&lt;/code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥å°†goçš„&lt;code>[]interface{}&lt;/code>ç±»å‹çš„å˜é‡ä½œä¸ºå‚æ•°ä½¿ç”¨ã€‚&lt;/p>
&lt;h3 id="å‡½æ•°è½¬æ¢æ•°ç»„">å‡½æ•°è½¬æ¢æ•°ç»„
&lt;/h3>&lt;p>&lt;code>syscall/js&lt;/code>æä¾›äº†ä¸¤ä¸ªå‡½æ•°ï¼š&lt;/p>
&lt;ul>
&lt;li>CopyBytesToGoï¼š&lt;code>func CopyBytesToGo(dst []byte, src Value) int&lt;/code>&lt;/li>
&lt;li>CopyBytesToJSï¼š&lt;code>func CopyBytesToJS(dst Value, src []byte) int&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ä¸¤è€…å¯¹äºgoè€Œè¨€ï¼Œç±»å‹éƒ½æ˜¯&lt;code>[]byte&lt;/code>ï¼Œä½†æ˜¯å¯¹äºjsè€Œè¨€ï¼Œéœ€è¦&lt;code>Uint8Array&lt;/code>æˆ–è€…&lt;code>Uint8ClampedArray&lt;/code>ç±»å‹ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨goä¸­ç”Ÿæˆä¸€ä¸ª&lt;code>Uint8Array&lt;/code>æˆ–è€…&lt;code>Uint8ClampedArray&lt;/code>ç±»å‹çš„å˜é‡å‘¢ï¼Ÿå®˜æ–¹çš„ç±»å‹æ˜ å°„è¡¨ä¹Ÿæ²¡æœ‰å•Š&amp;hellip;é‚£ä¹ˆå°±çœ‹ä¸‹ä¸€æ­¥ã€‚&lt;/p>
&lt;h3 id="å…¶ä½™ç±»å‹">å…¶ä½™ç±»å‹
&lt;/h3>&lt;p>å¯¹äºéå®˜æ–¹ç±»å‹æ˜ å°„è¡¨å†…çš„ç±»å‹ï¼Œå’Œå®˜æ–¹æä¾›çš„ä¸¤ä¸ªæ•°æ®ç±»å‹è½¬æ¢ä¹‹å¤–çš„ç±»å‹ï¼Œå¯ä»¥é€šè¿‡ä¸€ç§é€šç”¨çš„æ–¹å¼æ¥ç”Ÿæˆï¼Œä»¥ä¸Šä¸€æ­¥çš„&lt;code>Uint8Array&lt;/code>ä¸ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Global&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Uint8Array&amp;#34;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">New&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">length&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®é™…ä½¿ç”¨æ¡ˆä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// goData []byte{...}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">jsData&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Global&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Uint8Array&amp;#34;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">New&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">goData&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">CopyBytesToJS&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">jsData&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">goData&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é‚£ä¹ˆï¼Œæ¯”å¦‚jsä¸­çš„&lt;code>Date&lt;/code>ç±»å‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">dateConstructor&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Global&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Date&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">dateConstructor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">New&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2020-10-01&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æç«¯æƒ…å†µ">æç«¯æƒ…å†µ
&lt;/h3>&lt;p>å¥½å§ï¼Œè¿˜æœ‰æœ€åä¸€ä¸ªæ–¹æ¡ˆï¼Œå¦‚æœé‡åˆ°æç«¯æƒ…å†µï¼Œä¸Šè¿°æ–¹æ¡ˆéƒ½æ— æ³•è§£å†³ï¼Œé‚£ä¹ˆè¯·è½¬æ¢æˆå­—ç¬¦ä¸²å§ï¼è®©goå’Œjsç”¨å„è‡ªçš„æ–¹æ³•åˆ†åˆ«å¤„ç†ä¸€æ³¢ï¼Œå¾—åˆ°è‡ªå·±æƒ³è¦çš„ç»“æœæˆ–è€…ç»™å‡ºå„è‡ªæƒ³ç»™çš„æ•°æ®ã€‚&lt;/p>
&lt;h2 id="jsè°ƒç”¨goå‡½æ•°">jsè°ƒç”¨goå‡½æ•°
&lt;/h2>&lt;blockquote>
&lt;p>æ­¤å¤„éœ€è¦åœ¨goä¸­å¼•å…¥&lt;a class="link" href="https://pkg.go.dev/syscall/js" target="_blank" rel="noopener"
>syscall/js&lt;/a>ï¼Œä»¥å®ç°jsç›¸å…³çš„æ“ä½œã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="æ³¨å†Œgoå‡½æ•°">æ³¨å†Œgoå‡½æ•°
&lt;/h3>&lt;p>å°†goçš„å‡½æ•°æ³¨å†Œä¸ºjsçš„å‡½æ•°ï¼Œç”±jsæ¥è¿›è¡Œè°ƒç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;syscall/js&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">handleCount&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">this&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kd">interface&lt;/span>&lt;span class="p">{}&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">count&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nf">Int&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ValueOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">count&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">done&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">chan&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Global&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;HandleEvent&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">FuncOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">handleEvent&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;-&lt;/span>&lt;span class="nx">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>js.Func()&lt;/code> æ¥å—ä¸€ä¸ªå‡½æ•°ç±»å‹ä½œä¸ºå…¶å‚æ•°ï¼Œè¯¥å‡½æ•°çš„å®šä¹‰æ˜¯å›ºå®šçš„ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">this&lt;/span> &lt;span class="nx">Value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kd">interface&lt;/span>&lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// this å³ JavaScript ä¸­çš„ this
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// args æ˜¯åœ¨ JavaScript ä¸­è°ƒç”¨è¯¥å‡½æ•°çš„å‚æ•°åˆ—è¡¨ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è¿”å›å€¼éœ€ç”¨ js.ValueOf æ˜ å°„æˆ JavaScript çš„å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>js.ValueOfè¿”å›ä½œä¸ºjsçš„å€¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">| Go | JavaScript |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| ---------------------- | ---------------------- |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| js.Value | [its value] |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| js.Func | function |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| nil | null |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| bool | boolean |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| integers and floats | number |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| string | string |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| []interface{} | new array |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| map[string]interface{} | new object |
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="jsè°ƒç”¨">jsè°ƒç”¨
&lt;/h3>&lt;p>åœ¨jsä¸­ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•ï¼Œå¼•å…¥wasmæ–‡ä»¶ä¹‹åï¼Œç›´æ¥è°ƒç”¨å‡½æ•°å³å¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;static/wasm_exec.js&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">go&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Go&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">WebAssembly&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">instantiateStreaming&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">fetch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;static/main.wasm&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">go&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">importObject&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="nx">then&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">go&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">instance&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">querySelector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#button&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">addEventListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;click&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">HandleEvent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// ä¼ å…¥å‚æ•°1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="goè°ƒç”¨jså‡½æ•°">goè°ƒç”¨jså‡½æ•°
&lt;/h2>&lt;p>å¦‚æœåœ¨jsä¸­æœ¬èº«å·²ç»å®šä¹‰äº†å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨goä¸­ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨è¯¥å‡½æ•°ï¼Œè¿›è¡Œè¿ç®—ï¼Œå°†å¾—å‡ºçš„ç»“æœåœ¨goä¸­ç»§ç»­ä½¿ç”¨ã€‚&lt;/p>
&lt;h3 id="å®šä¹‰jså‡½æ•°">å®šä¹‰jså‡½æ•°
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">m&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">n&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">m&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">n&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="goä¸­è°ƒç”¨jså‡½æ•°">goä¸­è°ƒç”¨jså‡½æ•°
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;syscall/js&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">result&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Global&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;add&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// æ­¤å¤„è¾“å‡ºç±»å‹ä¸ºjs.Valueï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Int&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// ä½¿ç”¨.Int()å°†å…¶è½¬æ¢ä¸ºgoä¸­çš„ç±»å‹ï¼Œå³å¯ç›´æ¥ä½¿ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å¼•å…¥wasm">å¼•å…¥wasm
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">m&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">n&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">m&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">n&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;static/wasm_exec.js&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">go&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Go&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">WebAssembly&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">instantiateStreaming&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">fetch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;static/main.wasm&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">go&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">importObject&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="nx">then&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">go&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">instance&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç»“æœ">ç»“æœ
&lt;/h3>&lt;p>åœ¨å‰ç«¯è°ƒè¯•å°å¯ä»¥çœ‹åˆ°è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;number: 3&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¬¬ä¸€ä¸ªç»“æœå°±æ˜¯js.Valueçš„å€¼ï¼Œç¬¬äºŒä¸ªç»“æœåˆ™æ˜¯è½¬æ¢æˆgoçš„å€¼ï¼Œå¹¶æŒ‰ç…§é€»è¾‘è¿›è¡Œäº†&lt;code>+1&lt;/code>å¤„ç†ã€‚&lt;/p>
&lt;h2 id="å›è°ƒå‡½æ•°è§£å†³goå‡½æ•°é˜»å¡é—®é¢˜">å›è°ƒå‡½æ•°/è§£å†³goå‡½æ•°é˜»å¡é—®é¢˜
&lt;/h2>&lt;blockquote>
&lt;p>The Go function fn is called with the value of JavaScript&amp;rsquo;s &amp;ldquo;this&amp;rdquo; keyword and the arguments of the invocation. The return value of the invocation is the result of the Go function mapped back to JavaScript according to ValueOf.&lt;/p>
&lt;p>Invoking the wrapped Go function from JavaScript will pause the event loop and spawn a new goroutine. Other wrapped functions which are triggered during a call from Go to JavaScript get executed on the same goroutine.&lt;/p>
&lt;p>As a consequence, if one wrapped function blocks, JavaScript&amp;rsquo;s event loop is blocked until that function returns. Hence, calling any async JavaScript API, which requires the event loop, like fetch (http.Client), will cause an immediate deadlock. Therefore a blocking function should explicitly start a new goroutine.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;code>syscall/js&lt;/code>å®˜æ–¹æ–‡æ¡£è¡¨æ˜ï¼Œå¦‚æœgoåŒ…è£…å‡½æ•°é˜»å¡ï¼Œé‚£ä¹ˆjsçš„äº‹ä»¶å¾ªç¯ä¹Ÿå°†è¢«é˜»å¡ï¼Œç›´åˆ°å‡½æ•°è¿”å›ï¼Œè°ƒç”¨ä»»ä½•éœ€è¦äº‹ä»¶å¾ªç¯ï¼ˆå¦‚fetchï¼‰çš„å¼‚æ­¥js apiéƒ½å¯¼è‡´ç«‹å³æ­»é”ã€‚å› æ­¤ï¼Œä¸€ä¸ªé˜»å¡å‡½æ•°åº”è¯¥æ˜¾å¼åœ°å¯åŠ¨ä¸€ä¸ªæ–°çš„åç¨‹ã€‚&lt;/p>
&lt;p>æ­¤å¤„ï¼Œå¯ä»¥åœ¨goä¸­æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ŒåŠ ä¸Šåç¨‹å®ç°å¼‚æ­¥ï¼Œä¸ä¼šäº§ç”Ÿå µå¡ã€‚&lt;/p>
&lt;h3 id="æ³¨å†Œå‡½æ•°">æ³¨å†Œå‡½æ•°
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;syscall/js&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;time&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">handleRender&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">this&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kd">interface&lt;/span>&lt;span class="p">{}&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">username&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nf">String&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">callback&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">go&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Second&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">callback&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Invoke&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Sprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;hello, %s !&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">username&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;waiting...&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">done&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">chan&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Global&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;HandleRender&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">FuncOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">handleRender&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;-&lt;/span>&lt;span class="nx">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="jsè°ƒç”¨-1">jsè°ƒç”¨
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;static/wasm_exec.js&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">go&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Go&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">WebAssembly&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">instantiateStreaming&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">fetch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;static/main.wasm&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">go&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">importObject&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="nx">then&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">go&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">instance&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">querySelector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#button&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">addEventListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;click&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">HandleRender&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;tom&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">message&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;message: &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">message&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è¾“å‡º">è¾“å‡º
&lt;/h3>&lt;p>åœ¨æµè§ˆå™¨è°ƒè¯•å°ï¼Œå¯ä»¥çœ‹åˆ°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">waiting... // å…ˆè¾“å‡ºäº†waiting...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hello, tom ! // éš”äº†3ç§’ä¹‹åï¼Œè¾“å‡ºäº†å›è°ƒå‡½æ•°çš„å€¼
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="goå®ç°promise">Goå®ç°Promise
&lt;/h2>&lt;p>ä¸Šä¸€æ­¥çš„å›è°ƒå‡½æ•°ï¼Œè§£å†³äº†å‡½æ•°é˜»å¡é—®é¢˜ï¼Œæ­¤å¤„ï¼Œç»“åˆå›è°ƒå‡½æ•°å®ç°promiseï¼Œæ¥ä¸°å¯Œå¼‚æ­¥åœºæ™¯ã€‚&lt;/p>
&lt;p>åœ¨jsä¸­ï¼Œpromiseæ˜¯è¿™æ ·çš„ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">message&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Promise&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">resolve&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reject&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setTimeout&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">resolve&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;hello, world !&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="mi">3000&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨&lt;code>async&lt;/code>å’Œ&lt;code>await&lt;/code>è°ƒç”¨ï¼Œæ‹¿åˆ°ç»“æœï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">async&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">printMessage&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">message&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Promise&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">resolve&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reject&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setTimeout&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">resolve&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;hello, world !&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="mi">3000&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">await&lt;/span> &lt;span class="nx">message&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨goä¸­åˆå¦‚ä½•æ„å»ºpromiseå‘¢ï¼Ÿè¿™é‡Œå¯ä»¥ç”¨åˆ°ä¸Šè¿°goä¸jsçš„ç±»å‹è½¬æ¢ï¼Œåˆ›å»ºä¸€ä¸ªpromiseï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Global&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Promise&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ³¨å†Œå‡½æ•°-1">æ³¨å†Œå‡½æ•°
&lt;/h3>&lt;p>goçš„å®Œæ•´å®ç°å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;syscall/js&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;time&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">document&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Global&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;document&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">handleRender&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">this&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kd">interface&lt;/span>&lt;span class="p">{}&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">handler&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">FuncOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">this&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kd">interface&lt;/span>&lt;span class="p">{}&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">resolve&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">go&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Second&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">resolve&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Invoke&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;hello, world !&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;waiting...&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">promiseConstructor&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Global&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Promise&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">promiseConstructor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">New&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">handler&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">done&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">chan&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Global&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;HandleRender&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">FuncOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">handleRender&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;-&lt;/span>&lt;span class="nx">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="jsè°ƒç”¨-2">jsè°ƒç”¨
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;static/wasm_exec.js&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">go&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Go&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">WebAssembly&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">instantiateStreaming&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">fetch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;static/main.wasm&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">go&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">importObject&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="nx">then&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">go&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">instance&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">querySelector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#button&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">addEventListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;click&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">message&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">await&lt;/span> &lt;span class="nx">HandleRender&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;message: &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">message&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è¾“å‡º-1">è¾“å‡º
&lt;/h3>&lt;p>åœ¨æµè§ˆå™¨è°ƒè¯•å°ï¼Œå¯ä»¥çœ‹åˆ°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">waiting... // å…ˆè¾“å‡ºäº†waiting...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">message: hello, world ! // éš”äº†3ç§’ä¹‹åè¾“å‡º
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ“ä½œdom">æ“ä½œDOM
&lt;/h2>&lt;h3 id="ä½¿ç”¨document">ä½¿ç”¨document
&lt;/h3>&lt;p>å®šä¹‰ä¸€ä¸ªå…¨å±€çš„document&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">docuemnt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">js&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Global&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;document&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è·å–å…ƒç´ ">è·å–å…ƒç´ 
&lt;/h3>&lt;p>è·å–ä¸€ä¸ª&lt;code>id&lt;/code>ä¸º&lt;code>container&lt;/code>çš„&lt;code>div&lt;/code>ï¼Œè®¾ç½®&lt;code>background-color: red&lt;/code>ã€&lt;code>widht: 600&lt;/code>ã€&lt;code>height: 400&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">containerElement&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;getElementById&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;container&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">containerElementStyle&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">container&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;style&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">containerElementStyle&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;background&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;red&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">containerElementStyle&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;width&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;600px&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">containerElementStyle&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;height&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;400px&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åˆ›å»ºå…ƒç´ ">åˆ›å»ºå…ƒç´ 
&lt;/h3>&lt;p>åˆ›å»ºä¸€ä¸ª&lt;code>id&lt;/code>ä¸º&lt;code>image&lt;/code>çš„&lt;code>image&lt;/code>ï¼Œè®¾ç½®&lt;code>width:300&lt;/code>ã€&lt;code>height:200&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">imageElement&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;createElement&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;canvas&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">imageElement&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;width&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">300&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">imageElement&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;width&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ·»åŠ å­å…ƒç´ ">æ·»åŠ å­å…ƒç´ 
&lt;/h3>&lt;p>å°†&lt;code>image&lt;/code>æ·»åŠ ä¸º&lt;code>id&lt;/code>ä¸º&lt;code>container&lt;/code>çš„&lt;code>div&lt;/code>çš„å­å…ƒç´ &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">containerElement&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;appendChild&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">imageElement&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ·»åŠ äº‹ä»¶">æ·»åŠ äº‹ä»¶
&lt;/h3>&lt;p>ç»™&lt;code>image&lt;/code>æ·»åŠ å³å‡»äº‹ä»¶ï¼Œå³å‡»&lt;code>image&lt;/code>åˆ™é˜»æ­¢å³é”®èœå•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å®šä¹‰å“åº”å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">handlePreventEventCallBack&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">this&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kd">interface&lt;/span>&lt;span class="p">{}&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">args&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;preventDefault&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç»™imageæ·»åŠ äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">imageElement&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;addEventListener&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;contextmenu&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">FuncOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">handlePreventEventCallBack&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä¸å†è°ƒç”¨å“åº”äº‹ä»¶å‡½æ•°æ—¶ï¼Œå¿…é¡»è°ƒç”¨Func.Releaseä»¥é‡Šæ”¾èµ„æºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">cb&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Func&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">cb&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">FuncOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">this&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nx">any&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;button clicked&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Release&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1">// å¦‚æœä¸å†å•å‡»è¯¥æŒ‰é’®ï¼Œåˆ™é‡Šæ”¾è¯¥å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Global&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;document&amp;#34;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;getElementById&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;myButton&amp;#34;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;addEventListener&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;click&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">cb&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="canvas">Canvas
&lt;/h2>&lt;p>è¿™é‡Œæ”¾ä¸€æ³¢canvasçš„æ¡ˆä¾‹ï¼ŒåŒ…å«äº†ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒå®Œæˆæ›´å¤šæ“ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;math&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;syscall/js&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">const&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">width&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">400&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">height&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">400&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">radius&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">document&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Global&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;document&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">handleRender&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">this&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kd">interface&lt;/span>&lt;span class="p">{}&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">canvas&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;getElementById&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;canvas&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">canvas&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;width&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">width&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">canvas&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;height&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">height&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">ctx&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">canvas&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;getContext&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;2d&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;beginPath&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;arc&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">width&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">height&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">radius&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">math&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pi&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;fillStyle&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;lightpink&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;fill&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;lineWidth&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;strokeStyle&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;red&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;stroke&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;font&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;20px Comic Sans MS&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;fillStyle&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;blue&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;fillText&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Hello, World !&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">width&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">60&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">height&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">done&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">chan&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Global&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;HandleRender&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">js&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">FuncOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">handleRender&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;-&lt;/span>&lt;span class="nx">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¸²æŸ“ç»“æœï¼š&lt;/p>
&lt;p>&lt;img src="https://user-images.githubusercontent.com/25321169/217725808-5dd94da2-bb43-4129-95a9-27f3f85daba5.png"
loading="lazy"
alt="go_wasm_canvas"
>&lt;/p>
&lt;h2 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://pkg.go.dev/syscall/js" target="_blank" rel="noopener"
>syscall/js&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/golang/go/wiki/WebAssembly" target="_blank" rel="noopener"
>go wiki WebAssembly&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://geektutu.com/post/quick-go-wasm.html" target="_blank" rel="noopener"
>Go WebAssembly (Wasm) ç®€æ˜æ•™ç¨‹&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://withblue.ink/2020/10/03/go-webassembly-http-requests-and-promises.html" target="_blank" rel="noopener"
>Go, WebAssembly, HTTP requests and Promises&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>